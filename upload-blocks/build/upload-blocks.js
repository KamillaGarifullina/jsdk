/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2021 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var yt=Object.defineProperty;var be=(r,t,e)=>t in r?yt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var ve=r=>yt(r,"__esModule",{value:!0});var ye=(r,t)=>{ve(r);for(var e in t)yt(r,e,{get:t[e],enumerable:!0})};var h=(r,t,e)=>(be(r,typeof t!="symbol"?t+"":t,e),e);var Pt={};ye(Pt,{ActivityCaption:()=>ft,ActivityIcon:()=>gt,BlockComponent:()=>c,CameraSource:()=>lt,CloudImageEditor:()=>Dt,ConfirmationDialog:()=>nt,DataOutput:()=>A,DropArea:()=>Rt,EditableCanvas:()=>q,ExternalSource:()=>mt,FileItem:()=>$,Icon:()=>G,MessageBox:()=>et,Modal:()=>st,ProgressBar:()=>ut,SimpleBtn:()=>tt,SourceBtn:()=>W,SourceList:()=>Bt,StartFrom:()=>It,Tabs:()=>J,UploadDetails:()=>ct,UploadList:()=>ot,UrlSource:()=>at});function _e(r){let t=e=>{var i;for(let s in e)((i=e[s])==null?void 0:i.constructor)===Object&&(e[s]=t(e[s]));return{...e}};return t(r)}var y=class{constructor(t){this.uid=Symbol(),this.name=t.name||null,t.schema.constructor===Object?this.store=_e(t.schema):(this._storeIsProxy=!0,this.store=t.schema),this.callbackMap=Object.create(null)}static warn(t,e){console.warn(`Symbiote Data: cannot ${t}. Prop name: `+e)}read(t){return!this._storeIsProxy&&!this.store.hasOwnProperty(t)?(y.warn("read",t),null):this.store[t]}has(t){return this._storeIsProxy?this.store[t]!==void 0:this.store.hasOwnProperty(t)}add(t,e,i=!0){!i&&Object.keys(this.store).includes(t)||(this.store[t]=e,this.callbackMap[t]&&this.callbackMap[t].forEach(s=>{s(this.store[t])}))}pub(t,e){if(!this._storeIsProxy&&!this.store.hasOwnProperty(t)){y.warn("publish",t);return}this.add(t,e)}multiPub(t){for(let e in t)this.pub(e,t[e])}notify(t){this.callbackMap[t]&&this.callbackMap[t].forEach(e=>{e(this.store[t])})}sub(t,e,i=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(t)?(y.warn("subscribe",t),null):(this.callbackMap[t]||(this.callbackMap[t]=new Set),this.callbackMap[t].add(e),i&&e(this.store[t]),{remove:()=>{this.callbackMap[t].delete(e),this.callbackMap[t].size||delete this.callbackMap[t]},callback:e})}remove(){delete y.globalStore[this.uid]}static registerLocalCtx(t){let e=new y({schema:t});return y.globalStore[e.uid]=e,e}static registerNamedCtx(t,e){let i=y.globalStore[t];return i?console.warn('State: context name "'+t+'" already in use'):(i=new y({name:t,schema:e}),y.globalStore[t]=i),i}static clearNamedCtx(t){delete y.globalStore[t]}static getNamedCtx(t,e=!0){return y.globalStore[t]||(e&&console.warn('State: wrong context name - "'+t+'"'),null)}};y.globalStore=Object.create(null);var _=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"}),Nt="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",Ce=Nt.length-1,K=class{static generate(t="XXXXXXXXX-XXX"){let e="";for(let i=0;i<t.length;i++)e+=t[i]==="-"?t[i]:Nt.charAt(Math.random()*Ce);return e}};function we(r,t){if(t.renderShadow)return;let e=[...r.querySelectorAll("slot")];if(t.__initChildren.length&&e.length){let i={};e.forEach(s=>{let n=s.getAttribute("name");n?i[n]={slot:s,fr:document.createDocumentFragment()}:i.__default__={slot:s,fr:document.createDocumentFragment()}}),t.__initChildren.forEach(s=>{var o;let n=(o=s.getAttribute)==null?void 0:o.call(s,"slot");n?(s.removeAttribute("slot"),i[n].fr.appendChild(s)):i.__default__&&i.__default__.fr.appendChild(s)}),Object.values(i).forEach(s=>{s.slot.parentNode.insertBefore(s.fr,s.slot),s.slot.remove()})}else t.innerHTML=""}function xe(r,t){[...r.querySelectorAll(`[${_.EL_REF_ATTR}]`)].forEach(e=>{let i=e.getAttribute(_.EL_REF_ATTR);t.ref[i]=e,e.removeAttribute(_.EL_REF_ATTR)})}function Ae(r,t){[...r.querySelectorAll(`[${_.BIND_ATTR}]`)].forEach(e=>{e.getAttribute(_.BIND_ATTR).split(";").forEach(n=>{if(!n)return;let o=n.split(":").map(g=>g.trim()),l=o[0],a;l.indexOf(_.ATTR_BIND_PRFX)===0&&(a=!0,l=l.replace(_.ATTR_BIND_PRFX,""));let u=o[1].split(",").map(g=>g.trim()),p,d,b,f;if(l.includes(".")){p=!0;let g=l.split(".");f=()=>{d=e,g.forEach((v,w)=>{w<g.length-1?d=d[v]:b=v})},f()}for(let g of u)t.sub(g,v=>{a?(v==null?void 0:v.constructor)===Boolean?v?e.setAttribute(l,""):e.removeAttribute(l):e.setAttribute(l,v):p?d?d[b]=v:window.setTimeout(()=>{f(),d[b]=v}):e[l]=v})}),e.removeAttribute(_.BIND_ATTR)})}var Te=[we,xe,Ae],Ft=0,I=class extends HTMLElement{render(t,e=this.renderShadow){let i;if(t||this.constructor.template){for(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template);this.firstChild;)this.firstChild.remove();if((t==null?void 0:t.constructor)===DocumentFragment)i=t;else if((t==null?void 0:t.constructor)===String){let s=document.createElement("template");s.innerHTML=t,i=s.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let s of this.tplProcessors)s(i,this)}e?(this.shadowRoot||this.attachShadow({mode:"open"}),i&&this.shadowRoot.appendChild(i)):i&&this.appendChild(i)}addTemplateProcessor(t){this.tplProcessors.add(t)}constructor(){super();this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=K.generate(),this.style.setProperty(_.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(_.CSS_CTX_PROP,!0)}get ctxName(){var t;return((t=this.getAttribute(_.CTX_NAME_ATTR))==null?void 0:t.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=y.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return y.getNamedCtx(this.ctxName,!1)||y.registerNamedCtx(this.ctxName,{})}static __parseProp(t,e){let i,s;if(t.startsWith(_.EXT_DATA_CTX_PRFX))i=e.nodeCtx,s=t.replace(_.EXT_DATA_CTX_PRFX,"");else if(t.includes(_.NAMED_DATA_CTX_SPLTR)){let n=t.split(_.NAMED_DATA_CTX_SPLTR);i=y.getNamedCtx(n[0]),s=n[1]}else i=e.localCtx,s=t;return{ctx:i,name:s}}sub(t,e){let i=I.__parseProp(t,this);this.allSubs.add(i.ctx.sub(i.name,e))}notify(t){let e=I.__parseProp(t,this);e.ctx.notify(e.name)}has(t){let e=I.__parseProp(t,this);return e.ctx.has(e.name)}add(t,e){let i=I.__parseProp(t,this);i.ctx.add(i.name,e,!1)}add$(t){for(let e in t)this.add(e,t[e])}get $(){if(!this.__stateProxy){let t=Object.create(null);this.__stateProxy=new Proxy(t,{set:(e,i,s)=>{let n=I.__parseProp(i,this);return n.ctx.pub(n.name,s),!0},get:(e,i)=>{let s=I.__parseProp(i,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(t){for(let e in t)this.$[e]=t[e]}initCallback(){}__initDataCtx(){let t=this.constructor.__attrDesc;if(t)for(let e of Object.values(t))Object.keys(this.init$).includes(e)||(this.init$[e]="");for(let e in this.init$)if(e.startsWith(_.EXT_DATA_CTX_PRFX))this.nodeCtx.add(e.replace(_.EXT_DATA_CTX_PRFX,""),this.init$[e]);else if(e.includes(_.NAMED_DATA_CTX_SPLTR)){let i=e.split(_.NAMED_DATA_CTX_SPLTR),s=i[0].trim(),n=i[1].trim();if(s&&n){let o=y.getNamedCtx(s,!1);o||(o=y.registerNamedCtx(s,{})),o.add(n,this.init$[e])}}else this.localCtx.add(e,this.init$[e]);this.__dataCtxInitialized=!0}connectedCallback(){var t,e;if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(t=this.getAttribute(_.CTX_NAME_ATTR))==null?void 0:t.trim();i&&this.style.setProperty(_.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this.__initChildren=[...this.childNodes];for(let s of Te)this.addTemplateProcessor(s);this.pauseRender||this.render(),(e=this.initCallback)==null||e.call(this)}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),!!this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let t of this.allSubs)t.remove(),this.allSubs.delete(t);for(let t of this.tplProcessors)this.tplProcessors.delete(t)},100))}static reg(t,e=!1){if(t||(Ft++,t=`${_.AUTO_TAG_PRFX}-${Ft}`),this.__tag=t,window.customElements.get(t)){console.warn(`${t} - is already in "customElements" registry`);return}window.customElements.define(t,e?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(t){this.observedAttributes=Object.keys(t),this.__attrDesc=t}attributeChangedCallback(t,e,i){if(e===i)return;let s=this.constructor.__attrDesc[t];s?this.__dataCtxInitialized?this.$[s]=i:this.init$[s]=i:this[t]=i}getCssData(t,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(t)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(t).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[t]=JSON.parse(i)}catch(s){!e&&console.warn(`CSS Data error: ${t}`),this.__cssDataCache[t]=null}}return this.__cssDataCache[t]}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(t,e,i){let s="__"+t;this[s]=this[t],Object.defineProperty(this,t,{set:n=>{this[s]=n,i?window.setTimeout(()=>{e==null||e(n)}):e==null||e(n)},get:()=>this[s]}),this[t]=this[s]}},Vt="[Typed State] Wrong property name: ",Ee="[Typed State] Wrong property type: ",zt=class{constructor(t,e){this.__typedSchema=t,this.__ctxId=e||K.generate(),this.__schema=Object.keys(t).reduce((i,s)=>(i[s]=t[s].value,i),{}),this.__state=y.registerNamedCtx(this.__ctxId,this.__schema)}setValue(t,e){if(!this.__typedSchema.hasOwnProperty(t)){console.warn(Vt+t);return}if((e==null?void 0:e.constructor)!==this.__typedSchema[t].type){console.warn(Ee+t);return}this.__state.pub(t,e)}setMultipleValues(t){for(let e in t)this.setValue(e,t[e])}getValue(t){if(!this.__typedSchema.hasOwnProperty(t)){console.warn(Vt+t);return}return this.__state.read(t)}subscribe(t,e){return this.__state.sub(t,e)}remove(){this.__state.remove()}},_t=class{constructor(t){this.__typedSchema=t.typedSchema,this.__ctxId=t.ctxName||K.generate(),this.__state=y.registerNamedCtx(this.__ctxId,{}),this.__watchList=t.watchList||[],this.__handler=t.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let e=Object.create(null);this.__notifyObservers=(i,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[i]||(e[i]=new Set),e[i].add(s),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(n=>{n({...e})}),e=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var t;(t=this.__handler)==null||t.call(this,[...this.__items])})}add(t){let e=new zt(this.__typedSchema);for(let i in t)e.setValue(i,t[i]);return this.__state.add(e.__ctxId,e),this.__watchList.forEach(i=>{this.__subsMap[e.__ctxId]||(this.__subsMap[e.__ctxId]=[]),this.__subsMap[e.__ctxId].push(e.subscribe(i,()=>{this.__notifyObservers(i,e.__ctxId)}))}),this.__items.add(e.__ctxId),this.notify(),e}read(t){return this.__state.read(t)}readProp(t,e){return this.read(t).getValue(e)}publishProp(t,e,i){this.read(t).setValue(e,i)}remove(t){this.__items.delete(t),this.notify(),this.__state.pub(t,null),delete this.__subsMap[t]}clearAll(){this.__items.forEach(t=>{this.remove(t)})}observe(t){this.__observers.add(t)}unobserve(t){this.__observers.delete(t)}findItems(t){let e=[];return this.__items.forEach(i=>{let s=this.read(i);t(s)&&e.push(i)}),e}items(){return[...this.__items]}destroy(){this.__state.remove(),this.__observers=null;for(let t in this.__subsMap)this.__subsMap[t].forEach(e=>{e.remove()}),delete this.__subsMap[t]}},D=class{static _print(t){console.warn(t)}static setDefaultTitle(t){this.defaultTitle=t}static setRoutingMap(t){Object.assign(this.appMap,t);for(let e in this.appMap)!this.defaultRoute&&this.appMap[e].default===!0?this.defaultRoute=e:!this.errorRoute&&this.appMap[e].error===!0&&(this.errorRoute=e)}static set routingEventName(t){this.__routingEventName=t}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let t={route:null,options:{}};return window.location.search.split(this.separator).forEach(i=>{if(i.includes("?"))t.route=i.replace("?","");else if(i.includes("=")){let s=i.split("=");t.options[s[0]]=decodeURI(s[1])}else t.options[i]=!0}),t}static notify(){let t=this.readAddressBar(),e=this.appMap[t.route];if(e&&e.title&&(document.title=e.title),t.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!e&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!e){this._print(`Route "${t.route}" not found...`);return}let i=new CustomEvent(D.routingEventName,{detail:{route:t.route,options:Object.assign(e||{},t.options)}});window.dispatchEvent(i)}static reflect(t,e={}){let i=this.appMap[t];if(!i){this._print("Wrong route: "+t);return}let s="?"+t;for(let o in e)e[o]===!0?s+=this.separator+o:s+=this.separator+o+`=${e[o]}`;let n=i.title||this.defaultTitle||"";window.history.pushState(null,n,s),document.title=n}static applyRoute(t,e={}){this.reflect(t,e),this.notify()}static setSeparator(t){this._separator=t}static get separator(){return this._separator||"&"}static createRouterData(t,e){this.setRoutingMap(e);let i=y.registerNamedCtx(t,{route:null,options:null,title:null});return window.addEventListener(this.routingEventName,s=>{var n;i.multiPub({route:s.detail.route,options:s.detail.options,title:((n=s.detail.options)==null?void 0:n.title)||this.defaultTitle||""})}),D.notify(),i}};D.appMap=Object.create(null);window.onpopstate=()=>{D.notify()};function X(r,t){for(let e in t)e.includes("-")?r.style.setProperty(e,t[e]):r.style[e]=t[e]}function R(r,t){for(let e in t)t[e].constructor===Boolean?t[e]?r.setAttribute(e,""):r.removeAttribute(e):r.setAttribute(e,t[e])}function H(r={tag:"div"}){let t=document.createElement(r.tag);if(r.attributes&&R(t,r.attributes),r.styles&&X(t,r.styles),r.properties)for(let e in r.properties)t[e]=r.properties[e];return r.processors&&r.processors.forEach(e=>{e(t)}),r.children&&r.children.forEach(e=>{let i=H(e);t.appendChild(i)}),t}var Xt="idb-store-ready",Se="symbiote-db",ke="symbiote-idb-update_",Ht=class{_notifyWhenReady(t=null){window.dispatchEvent(new CustomEvent(Xt,{detail:{dbName:this.name,storeName:this.storeName,event:t}}))}get _updEventName(){return ke+this.name}_getUpdateEvent(t){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:t}})}_notifySubscribers(t){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,t),window.dispatchEvent(this._getUpdateEvent(t))}constructor(t,e){this.name=t,this.storeName=e,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=i=>{this.db=i.target.result,this.objStore=this.db.createObjectStore(e,{keyPath:"_key"}),this.objStore.transaction.oncomplete=s=>{this._notifyWhenReady(s)}},this.request.onsuccess=i=>{this.db=i.target.result,this._notifyWhenReady(i)},this.request.onerror=i=>{console.error(i)},this._subscribtionsMap={},this._updateHandler=i=>{i.key===this.name&&this._subscribtionsMap[i.newValue]&&this._subscribtionsMap[i.newValue].forEach(async n=>{n(await this.read(i.newValue))})},this._localUpdateHandler=i=>{this._updateHandler(i.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(t){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(t);return new Promise((s,n)=>{i.onsuccess=o=>{var l;((l=o.target.result)==null?void 0:l._value)?s(o.target.result._value):(s(null),console.warn(`IDB: cannot read "${t}"`))},i.onerror=o=>{n(o)}})}write(t,e,i=!1){let s={_key:t,_value:e},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise((l,a)=>{o.onsuccess=u=>{i||this._notifySubscribers(t),l(u.target.result)},o.onerror=u=>{a(u)}})}delete(t,e=!1){let s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(t);return new Promise((n,o)=>{s.onsuccess=l=>{e||this._notifySubscribers(t),n(l)},s.onerror=l=>{o(l)}})}getAll(){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((i,s)=>{e.onsuccess=n=>{let o=n.target.result;i(o.map(l=>l._value))},e.onerror=n=>{s(n)}})}subscribe(t,e){this._subscribtionsMap[t]||(this._subscribtionsMap[t]=new Set);let i=this._subscribtionsMap[t];return i.add(e),{remove:()=>{i.delete(e),i.size||delete this._subscribtionsMap[t]}}}stop(){window.removeEventListener("storage",this._updateHandler),this.__subscribtionsMap=null,Ct.clear(this.name)}},Ct=class{static get readyEventName(){return Xt}static open(t=Se,e="store"){let i=`${t}/${e}`;return this._reg[i]||(this._reg[i]=new Ht(t,e)),this._reg[i]}static clear(t){window.indexedDB.deleteDatabase(t);for(let e in this._reg)e.split("/")[0]===t&&delete this._reg[e]}};Ct._reg=Object.create(null);function Gt(r,t){[...r.querySelectorAll("[l10n]")].forEach(e=>{let i=e.getAttribute("l10n"),s="textContent";if(i.includes(":")){let o=i.split(":");s=o[0],i=o[1]}let n="l10n:"+i;t.__l10nKeys.push(n),t.add(n,i),t.sub(n,o=>{e[s]=t.l10n(o)}),e.removeAttribute("l10n")})}var T=class extends Error{constructor(t,e,i,s,n){super();this.name="UploadClientError",this.message=t,this.code=e,this.request=i,this.response=s,this.headers=n,Object.setPrototypeOf(this,T.prototype)}},wt=(r="Request canceled")=>{let t=new T(r);return t.isCancel=!0,t},Q=(r,t)=>{r&&(r.aborted?Promise.resolve().then(t):r.addEventListener("abort",()=>t(),{once:!0}))},B=({method:r,url:t,data:e,headers:i={},signal:s,onProgress:n})=>new Promise((o,l)=>{let a=new XMLHttpRequest,u=(r==null?void 0:r.toUpperCase())||"GET",p=!1;a.open(u,t),i&&Object.entries(i).forEach(d=>{let[b,f]=d;typeof f!="undefined"&&!Array.isArray(f)&&a.setRequestHeader(b,f)}),a.responseType="text",Q(s,()=>{p=!0,a.abort(),l(wt())}),a.onload=()=>{if(a.status!=200)l(new Error(`Error ${a.status}: ${a.statusText}`));else{let d={method:u,url:t,data:e,headers:i||void 0,signal:s,onProgress:n},b=a.getAllResponseHeaders().trim().split(/[\r\n]+/),f={};b.forEach(function(w){let m=w.split(": "),x=m.shift(),O=m.join(": ");x&&typeof x!="undefined"&&(f[x]=O)});let g=a.response,v=a.status;o({request:d,data:g,headers:f,status:v})}},a.onerror=()=>{p||l(new Error("Network error"))},n&&typeof n=="function"&&(a.upload.onprogress=d=>{n({value:d.loaded/d.total})}),e?a.send(e):a.send()});function $e(r){return r}var Ie=$e,Ue=()=>new FormData,Le=r=>r[0]==="file";function xt(r){let t=Ue();for(let e of r)if(Array.isArray(e[1]))e[1].forEach(i=>i&&t.append(e[0]+"[]",`${i}`));else if(Le(e)){let i=e[2],s=Ie(e[1]);t.append(e[0],s,i)}else e[1]!=null&&t.append(e[0],`${e[1]}`);return t}var Wt=(r,t)=>typeof t!="undefined"?`${r}=${encodeURIComponent(t)}`:null,Re=r=>Object.entries(r).reduce((t,[e,i])=>t.concat(Array.isArray(i)?i.map(s=>Wt(`${e}[]`,s)):Wt(e,i)),[]).filter(t=>!!t).join("&"),P=(r,t,e)=>[r,t,e&&Object.keys(e).length>0?"?":"",e&&Re(e)].filter(Boolean).join(""),C={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,multipartMaxAttempts:3,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Be="application/octet-stream",qt="original",Me="2.1.0";function N({userAgent:r,publicKey:t="",integration:e=""}={}){let i="UploadcareUploadClient",s=Me,n="JavaScript";if(typeof r=="string")return r;if(typeof r=="function")return r({publicKey:t,libraryName:i,libraryVersion:s,languageName:n,integration:e});let o=[i,s,t].filter(Boolean).join("/"),l=[n,e].filter(Boolean).join("; ");return`${o} (${l})`}var Oe=/\W|_/g;function je(r){return r.split(Oe).map((t,e)=>t.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+t.slice(1)).join("")}function U(r){return!r||typeof r!="object"?r:Object.keys(r).reduce((t,e)=>(t[je(e)]=typeof r[e]=="object"?U(r[e]):r[e],t),{})}var De=r=>new Promise(t=>setTimeout(t,r)),Pe={factor:2,time:100};function Jt(r,t=Pe){let e=0;function i(s){let n=Math.round(t.time*Math.pow(t.factor,e));return s({attempt:e,retry:l=>De(l!=null?l:n).then(()=>(e+=1,i(s)))})}return i(r)}var Ne="RequestThrottledError",Fe=15e3;function Ve(r){let{headers:t}=r||{};return t&&Number.parseInt(t["x-throttle-wait-seconds"])*1e3||Fe}function F(r,t){return Jt(({attempt:e,retry:i})=>r().catch(s=>{if("response"in s&&(s==null?void 0:s.code)===Ne&&e<t)return i(Ve(s));throw s}))}function ze(r,{publicKey:t,fileName:e,baseURL:i=C.baseURL,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u="local",integration:p,userAgent:d,retryThrottledRequestMaxTimes:b=C.retryThrottledRequestMaxTimes}){return F(()=>{var f;return B({method:"POST",url:P(i,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":N({publicKey:t,integration:p,userAgent:d})},data:xt([["file",r,(f=e!=null?e:r.name)!==null&&f!==void 0?f:qt],["UPLOADCARE_PUB_KEY",t],["UPLOADCARE_STORE",typeof o=="undefined"?"auto":o?1:0],["signature",s],["expire",n],["source",u]]),signal:l,onProgress:a}).then(({data:g,headers:v,request:w})=>{let m=U(JSON.parse(g));if("error"in m)throw new T(m.error.content,m.error.errorCode,w,m,v);return m})},b)}var At;(function(r){r.Token="token",r.FileInfo="file_info"})(At||(At={}));function Xe(r,{publicKey:t,baseURL:e=C.baseURL,store:i,fileName:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,source:u="url",signal:p,integration:d,userAgent:b,retryThrottledRequestMaxTimes:f=C.retryThrottledRequestMaxTimes}){return F(()=>B({method:"POST",headers:{"X-UC-User-Agent":N({publicKey:t,integration:d,userAgent:b})},url:P(e,"/from_url/",{jsonerrors:1,pub_key:t,source_url:r,store:typeof i=="undefined"?"auto":i?1:void 0,filename:s,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:l,expire:a,source:u}),signal:p}).then(({data:g,headers:v,request:w})=>{let m=U(JSON.parse(g));if("error"in m)throw new T(m.error.content,m.error.errorCode,w,m,v);return m}),f)}var E;(function(r){r.Unknown="unknown",r.Waiting="waiting",r.Progress="progress",r.Error="error",r.Success="success"})(E||(E={}));var He=r=>"status"in r&&r.status===E.Error;function Ge(r,{publicKey:t,baseURL:e=C.baseURL,signal:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o=C.retryThrottledRequestMaxTimes}={}){return F(()=>B({method:"GET",headers:t?{"X-UC-User-Agent":N({publicKey:t,integration:s,userAgent:n})}:void 0,url:P(e,"/from_url/status/",{jsonerrors:1,token:r}),signal:i}).then(({data:l,headers:a,request:u})=>{let p=U(JSON.parse(l));if("error"in p&&!He(p))throw new T(p.error.content,void 0,u,p,a);return p}),o)}function Zt(r,{publicKey:t,baseURL:e=C.baseURL,signal:i,source:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:l=C.retryThrottledRequestMaxTimes}){return F(()=>B({method:"GET",headers:{"X-UC-User-Agent":N({publicKey:t,integration:n,userAgent:o})},url:P(e,"/info/",{jsonerrors:1,pub_key:t,file_id:r,source:s}),signal:i}).then(({data:a,headers:u,request:p})=>{let d=U(JSON.parse(a));if("error"in d)throw new T(d.error.content,d.error.errorCode,p,d,u);return d}),l)}function We(r,{publicKey:t,contentType:e,fileName:i,multipartChunkSize:s=C.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:l,store:a,signal:u,source:p="local",integration:d,userAgent:b,retryThrottledRequestMaxTimes:f=C.retryThrottledRequestMaxTimes}){return F(()=>B({method:"POST",url:P(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":N({publicKey:t,integration:d,userAgent:b})},data:xt([["filename",i!=null?i:qt],["size",r],["content_type",e!=null?e:Be],["part_size",s],["UPLOADCARE_STORE",a?"":"auto"],["UPLOADCARE_PUB_KEY",t],["signature",o],["expire",l],["source",p]]),signal:u}).then(({data:g,headers:v,request:w})=>{let m=U(JSON.parse(g));if("error"in m)throw new T(m.error.content,m.error.errorCode,w,m,v);return m.parts=Object.keys(m.parts).map(x=>m.parts[x]),m}),f)}function qe(r,t,{signal:e,onProgress:i}){return B({method:"PUT",url:t,data:r,onProgress:i,signal:e}).then(s=>(i&&i({value:1}),s)).then(({status:s})=>({code:s}))}function Je(r,{publicKey:t,baseURL:e=C.baseURL,source:i="local",signal:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:l=C.retryThrottledRequestMaxTimes}){return F(()=>B({method:"POST",url:P(e,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":N({publicKey:t,integration:n,userAgent:o})},data:xt([["uuid",r],["UPLOADCARE_PUB_KEY",t],["source",i]]),signal:s}).then(({data:a,headers:u,request:p})=>{let d=U(JSON.parse(a));if("error"in d)throw new T(d.error.content,d.error.errorCode,p,d,u);return d}),l)}var M=class{constructor(t,{baseCDN:e,defaultEffects:i,fileName:s}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.cdnUrlModifiers=null,this.originalUrl=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null;let{uuid:n,s3Bucket:o}=t,l=o?`https://${o}.s3.amazonaws.com/${n}/${t.filename}`:`${e}/${n}/`,a=i?`-/${i}`:null,u=`${l}${a||""}`,p=n?l:null;this.uuid=n,this.name=s||t.filename,this.size=t.size,this.isStored=t.isStored,this.isImage=t.isImage,this.mimeType=t.mimeType,this.cdnUrl=u,this.cdnUrlModifiers=a,this.originalUrl=p,this.originalFilename=t.originalFilename,this.imageInfo=U(t.imageInfo),this.videoInfo=U(t.videoInfo)}},Ze=500,Yt=({check:r,interval:t=Ze,signal:e})=>new Promise((i,s)=>{let n;Q(e,()=>{n&&clearTimeout(n),s(wt("Poll cancelled"))});let o=()=>{try{Promise.resolve(r(e)).then(l=>{l?i(l):n=setTimeout(o,t)}).catch(l=>s(l))}catch(l){s(l)}};n=setTimeout(o,0)});function Tt({file:r,publicKey:t,baseURL:e,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,signal:l,onProgress:a}){return Yt({check:u=>Zt(r,{publicKey:t,baseURL:e,signal:u,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o}).then(p=>p.isReady?p:(a&&a({value:1}),!1)),signal:l})}var Ye=(r,{publicKey:t,fileName:e,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,baseCDN:f})=>ze(r,{publicKey:t,fileName:e,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b}).then(({file:g})=>Tt({file:g,publicKey:t,baseURL:i,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,onProgress:a,signal:l})).then(g=>new M(g,{baseCDN:f})),{AbortController:Ke,AbortSignal:$i}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0,Qe=(r,{signal:t}={})=>{let e=null,i=null,s=r.map(()=>new Ke),n=o=>()=>{i=o,s.forEach((l,a)=>a!==o&&l.abort())};return Q(t,()=>{s.forEach(o=>o.abort())}),Promise.all(r.map((o,l)=>{let a=n(l);return Promise.resolve().then(()=>o({stopRace:a,signal:s[l].signal})).then(u=>(a(),u)).catch(u=>(e=u,null))})).then(o=>{if(i===null)throw e;return o[i]})},ti=window.WebSocket,Kt=class{constructor(){this.events=Object.create({})}emit(t,e){var i;(i=this.events[t])===null||i===void 0||i.forEach(s=>s(e))}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){e?this.events[t]=this.events[t].filter(i=>i!==e):this.events[t]=[]}},ei=(r,t)=>Object.assign(r==="success"?{status:E.Success}:r==="progress"?{status:E.Progress}:{status:E.Error},t),Qt=class{constructor(t,e=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Kt,this.disconnectTimeoutId=null,this.key=t,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let t=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new ti(t),this.ws.addEventListener("error",e=>{this.emmitter.emit("error",new Error(e.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(e=>this.send(e.event,e.data)),this.queue=[]}),this.ws.addEventListener("message",e=>{let i=JSON.parse(e.data.toString());switch(i.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(i.channel,ei(i.event,JSON.parse(i.data)))}})}}disconnect(){let t=()=>{var e;(e=this.ws)===null||e===void 0||e.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{t()},this.disconnectTime):t()}send(t,e){var i;let s=JSON.stringify({event:t,data:e});(i=this.ws)===null||i===void 0||i.send(s)}subscribe(t,e){this.subscribers+=1,this.connect();let i=`task-status-${t}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,e),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(t){this.subscribers-=1;let e=`task-status-${t}`,i={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter(s=>s.data.channel!==e),this.subscribers===0&&this.disconnect()}onError(t){return this.emmitter.on("error",t),()=>this.emmitter.off("error",t)}},Et=null,St=r=>{if(!Et){let t=typeof window=="undefined"?0:3e4;Et=new Qt(r,t)}return Et},ii=r=>{St(r).connect()};function si({token:r,publicKey:t,baseURL:e,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,onProgress:o,signal:l}){return Yt({check:a=>Ge(r,{publicKey:t,baseURL:e,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,signal:a}).then(u=>{switch(u.status){case E.Error:return new T(u.error,u.errorCode);case E.Waiting:return!1;case E.Unknown:return new T(`Token "${r}" was not found.`);case E.Progress:return o&&o({value:u.done/u.total}),!1;case E.Success:return o&&o({value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:l})}var ri=({token:r,pusherKey:t,signal:e,onProgress:i})=>new Promise((s,n)=>{let o=St(t),l=o.onError(n),a=()=>{l(),o.unsubscribe(r)};Q(e,()=>{a(),n(wt("pusher cancelled"))}),o.subscribe(r,u=>{switch(u.status){case E.Progress:{i&&i({value:u.done/u.total});break}case E.Success:{a(),i&&i({value:u.done/u.total}),s(u);break}case E.Error:a(),n(new T(u.msg,u.error_code))}})}),ni=(r,{publicKey:t,fileName:e,baseURL:i,baseCDN:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,store:u,signal:p,onProgress:d,source:b,integration:f,userAgent:g,retryThrottledRequestMaxTimes:v,pusherKey:w=C.pusherKey})=>Promise.resolve(ii(w)).then(()=>Xe(r,{publicKey:t,fileName:e,baseURL:i,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,store:u,signal:p,source:b,integration:f,userAgent:g,retryThrottledRequestMaxTimes:v})).catch(m=>{let x=St(w);return x==null||x.disconnect(),Promise.reject(m)}).then(m=>m.type===At.FileInfo?m:Qe([({signal:x})=>si({token:m.token,publicKey:t,baseURL:i,integration:f,userAgent:g,retryThrottledRequestMaxTimes:v,onProgress:d,signal:x}),({signal:x})=>ri({token:m.token,pusherKey:w,signal:x,onProgress:d})],{signal:p})).then(m=>{if(m instanceof T)throw m;return m}).then(m=>Tt({file:m.uuid,publicKey:t,baseURL:i,integration:f,userAgent:g,retryThrottledRequestMaxTimes:v,onProgress:d,signal:p})).then(m=>new M(m,{baseCDN:s})),oi=(r,{publicKey:t,fileName:e,baseURL:i,signal:s,onProgress:n,source:o,integration:l,userAgent:a,retryThrottledRequestMaxTimes:u,baseCDN:p})=>Zt(r,{publicKey:t,baseURL:i,signal:s,source:o,integration:l,userAgent:a,retryThrottledRequestMaxTimes:u}).then(d=>new M(d,{baseCDN:p,fileName:e})).then(d=>(n&&n({value:1}),d)),kt=r=>r!==void 0&&(typeof Blob!="undefined"&&r instanceof Blob||typeof File!="undefined"&&r instanceof File||typeof Buffer!="undefined"&&r instanceof Buffer),ai=r=>{let t="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",e=new RegExp(t);return!kt(r)&&e.test(r)},li=r=>{let t="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",e=new RegExp(t);return!kt(r)&&e.test(r)},te=r=>r.length||r.size,ci=(r,t=C.multipartMinFileSize)=>r>=t,ui=(r,t,e,i)=>{let s=i*t,n=Math.min(s+i,e);return r.slice(s,n)};function hi(r,t,e){return i=>ui(r,i,t,e)}var di=(r,t)=>new Promise((e,i)=>{let s=[],n=!1,o=t.length,l=[...t],a=()=>{let u=t.length-l.length,p=l.shift();p&&p().then(d=>{n||(s[u]=d,o-=1,o?a():e(s))}).catch(d=>{n=!0,i(d)})};for(let u=0;u<r;u++)a()}),pi=(r,t,{publicKey:e,onProgress:i,signal:s,integration:n,multipartMaxAttempts:o})=>Jt(({attempt:l,retry:a})=>qe(r,t,{publicKey:e,onProgress:i,signal:s,integration:n}).catch(u=>{if(l<o)return a();throw u})),mi=(r,{publicKey:t,fileName:e,fileSize:i,baseURL:s,secureSignature:n,secureExpire:o,store:l,signal:a,onProgress:u,source:p,integration:d,userAgent:b,retryThrottledRequestMaxTimes:f,contentType:g,multipartChunkSize:v=C.multipartChunkSize,maxConcurrentRequests:w=C.maxConcurrentRequests,multipartMaxAttempts:m=C.multipartMaxAttempts,baseCDN:x})=>{let O=i||te(r),j,bt=(k,Z)=>{if(!u)return;j||(j=Array(k).fill(0));let vt=z=>z.reduce((Y,ge)=>Y+ge,0);return({value:z})=>{j[Z]=z,u({value:vt(j)/k})}};return We(O,{publicKey:t,contentType:g,fileName:e!=null?e:r.name,baseURL:s,secureSignature:n,secureExpire:o,store:l,signal:a,source:p,integration:d,userAgent:b,retryThrottledRequestMaxTimes:f}).then(({uuid:k,parts:Z})=>{let vt=hi(r,O,v);return Promise.all([k,di(w,Z.map((z,Y)=>()=>pi(vt(Y),z,{publicKey:t,onProgress:bt(Z.length,Y),signal:a,integration:d,multipartMaxAttempts:m})))])}).then(([k])=>Je(k,{publicKey:t,baseURL:s,source:p,integration:d,userAgent:b,retryThrottledRequestMaxTimes:f})).then(k=>k.isReady?k:Tt({file:k.uuid,publicKey:t,baseURL:s,source:p,integration:d,userAgent:b,retryThrottledRequestMaxTimes:f,onProgress:u,signal:a})).then(k=>new M(k,{baseCDN:x}))};function ee(r,{publicKey:t,fileName:e,baseURL:i=C.baseURL,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,contentType:f,multipartChunkSize:g,multipartMaxAttempts:v,maxConcurrentRequests:w,baseCDN:m=C.baseCDN,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:O,pusherKey:j}){if(kt(r)){let bt=te(r);return ci(bt)?mi(r,{publicKey:t,contentType:f,multipartChunkSize:g,multipartMaxAttempts:v,fileName:e,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,maxConcurrentRequests:w,retryThrottledRequestMaxTimes:b,baseCDN:m}):Ye(r,{publicKey:t,fileName:e,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,baseCDN:m})}if(li(r))return ni(r,{publicKey:t,fileName:e,baseURL:i,baseCDN:m,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:O,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,pusherKey:j});if(ai(r))return oi(r,{publicKey:t,fileName:e,baseURL:i,signal:l,onProgress:a,source:u,integration:p,userAgent:d,retryThrottledRequestMaxTimes:b,baseCDN:m});throw new TypeError(`File uploading from "${r}" is not supported`)}var ie=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadErrorMsg:{type:String,value:null},validationErrorMsg:{type:String,value:null},ctxName:{type:String,value:null},transformationsUrl:{type:String,value:null},fileInfo:{type:M,value:null}});var se="active",re="uc-",fi="css-src",$t=document.readyState==="complete";$t||window.addEventListener("load",()=>{$t=!0});var c=class extends I{l10n(t){return this.getCssData("--l10n-"+t,!0)||t}constructor(){super();this.activityType=null,this.addTemplateProcessor(Gt),this.__l10nKeys=[],this.__l10nUpdate=()=>{this.dropCssDataCache();for(let t of this.__l10nKeys)this.notify(t)},window.addEventListener("uc-l10n-update",this.__l10nUpdate)}applyL10nKey(t,e){this.$["l10n:"+t]=e}historyBack(){let t=this.$["*history"];t.pop();let e=t.pop();this.$["*currentActivity"]=e,t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.$["*history"]=t}addFiles(t){t.forEach(e=>{this.uploadCollection.add({file:e,isImage:e.type.includes("image"),mimeType:e.type,fileName:e.name,fileSize:e.size})})}openSystemDialog(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.cfg("multiple"),this.fileInput.max=this.cfg("max-files"),this.fileInput.accept=this.cfg("accept"),this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=c.activities.UPLOAD_LIST,this.cfg("confirm-upload")||(this.$["*currentActivity"]=""),this.fileInput.value="",this.fileInput=null}}connectedCallback(){let t=()=>{$t?this.connected():window.addEventListener("load",()=>{this.connected()})},e=this.getAttribute(fi);if(e){this.renderShadow=!0,this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.onload=()=>{window.requestAnimationFrame(()=>{t()})},this.shadowRoot.appendChild(i)}else t()}connected(){this.__connectedOnce?super.connectedCallback():(c._ctxConnectionsList.includes(this.ctxName)||(this.add$({"*currentActivity":"","*currentActivityParams":{},"*history":[],"*commonProgress":0,"*uploadList":[],"*outputData":null}),c._ctxConnectionsList.push(this.ctxName)),super.connectedCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{var i,s;let e=t?this.ctxName+t:"";if(!t||this.activityType!==t)this.removeAttribute(se);else{let n=this.$["*history"];t&&n[n.length-1]!==t&&n.push(t),this.setAttribute(se,"");let o=c._activityRegistry[e];if(o&&((i=o.activateCallback)==null||i.call(o),c._lastActivity)){let l=c._activityRegistry[c._lastActivity];l&&((s=l.deactivateCallback)==null||s.call(l))}}c._lastActivity=e})),this.__connectedOnce=!0)}get doneActivity(){return this.getAttribute("done-activity")}get cancelActivity(){return this.getAttribute("cancel-activity")}registerActivity(t,e,i){c._activityRegistry||(c._activityRegistry=Object.create(null));let s=this.ctxName+t;c._activityRegistry[s]={activateCallback:e,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get uploadCollection(){if(!this.has("*uploadCollection")){let t=new _t({typedSchema:ie,watchList:["uploadProgress","uuid"],handler:e=>{this.$["*uploadList"]=e}});t.observe(e=>{if(e.uploadProgress){let i=0,s=t.findItems(n=>!n.getValue("uploadErrorMsg"));s.forEach(n=>{i+=t.readProp(n,"uploadProgress")}),this.$["*commonProgress"]=i/s.length}}),this.add("*uploadCollection",t)}return this.$["*uploadCollection"]}cfg(t){return this.getCssData("--cfg-"+t,!0)}fileSizeFmt(t,e=2){let i=["B","KB","MB","GB","TB"],s=a=>this.getCssData("--l10n-unit-"+a.toLowerCase(),!0)||a;if(t===0)return`0 ${s(i[0])}`;let n=1024,o=e<0?0:e,l=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/n**l).toFixed(o))+" "+s(i[l])}output(){let t=[];this.uploadCollection.items().forEach(i=>{let n=y.getNamedCtx(i).store.fileInfo;t.push(n)}),this.$["*outputData"]=t}destroyCallback(){window.removeEventListener("uc-l10n-update",this.__l10nUpdate),this.__l10nKeys=null}static reg(t){super.reg(t.startsWith(re)?t:re+t)}};c._activityRegistry=Object.create(null);c._lastActivity="";c._ctxConnectionsList=[];c.activities=Object.freeze({SOURCE_SELECT:"source-select",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});c.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});c.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...c.extSrcList});var G=class extends c{constructor(){super(...arguments);h(this,"init$",{path:""})}initCallback(){this.defineAccessor("name",t=>{!t||(this.$.path=this.getCssData(`--icon-${t}`))})}};G.template=`
<svg
  viewBox="0 0 24 24"
  xmlns="http://www.w3.org/2000/svg">
  <path set="@d: path"></path>
</svg>
`;G.bindAttributes({name:null});var tt=class extends c{constructor(){super(...arguments);h(this,"init$",{"*simpleButtonText":""})}initCallback(){this.$["*simpleButtonText"]=this.cfg("multiple")?this.l10n("upload-files"):this.l10n("upload-file"),this.onclick=()=>{var t;this.$["*modalActive"]=!0,((t=this.$["*uploadList"])==null?void 0:t.length)?this.set$({"*currentActivity":c.activities.UPLOAD_LIST}):this.set$({"*currentActivity":c.activities.SOURCE_SELECT})}}};tt.template=`
<button>
  <uc-icon name="upload"></uc-icon>
  <span set="textContent: *simpleButtonText"></span>
  <slot></slot>
</button>`;var It=class extends c{constructor(){super(...arguments);h(this,"activityType","source-select")}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({"*modalCaption":this.l10n("select-file-source"),"*modalIcon":"default"})})}};function gi(r){return new Promise(t=>{typeof window.FileReader!="function"&&t(!1);try{let e=new FileReader;e.onerror=()=>{t(!0)};let i=s=>{s.type!=="loadend"&&e.abort(),t(!1)};e.onloadend=i,e.onprogress=i,e.readAsDataURL(r)}catch(e){t(!1)}})}function bi(r){return new Promise((t,e)=>{let i=0,s=[],n=l=>{l||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),l.isFile?(i++,l.file(a=>{i--,s.push(a),i===0&&t(s)})):l.isDirectory&&o(l.createReader())},o=l=>{i++,l.readEntries(a=>{i--;for(let u of a)n(u);i===0&&t(s)})};n(r)})}function ne(r){let t=[],e=[];for(let i=0;i<r.items.length;i++){let s=r.items[i];if(s&&s.kind==="file"){if(typeof s.webkitGetAsEntry=="function"||typeof s.getAsEntry=="function"){let o=typeof s.webkitGetAsEntry=="function"?s.webkitGetAsEntry():s.getAsEntry();e.push(bi(o).then(l=>{t.push(...l)}));continue}let n=s.getAsFile();e.push(gi(n).then(o=>{o||t.push(n)}))}}return Promise.all(e).then(()=>t)}var S={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Ut=["dragleave","dragexit","dragend","drop","mouseleave","mouseout"],vi=100,Lt=new Map;function yi(r,t){let e=Math.max(Math.min(r[0],t.x+t.width),t.x),i=Math.max(Math.min(r[1],t.y+t.height),t.y);return Math.sqrt((r[0]-e)*(r[0]-e)+(r[1]-i)*(r[1]-i))}function oe(r){let t=new Set,e=a=>t.add(a),i=S.INACTIVE,s=a=>{i!==a&&t.forEach(u=>u(a)),i=a},n=a=>{let{clientX:u,clientY:p}=a,d=document.body.getBoundingClientRect(),b=a.type==="drop",f=["dragleave","dragexit","dragend"].includes(a.type)&&u===0&&p===0,g=["mouseleave","mouseout"].includes(a.type)&&(u<0||u>d.width||p<0||p>d.height);(b||f||g)&&s(S.INACTIVE),a.preventDefault()};e(a=>r.onChange(a)),e(a=>{a===S.ACTIVE&&Ut.forEach(u=>{window.addEventListener(u,n,!1)})}),e(a=>{a===S.INACTIVE&&Ut.forEach(u=>{window.removeEventListener(u,n,!1)})});let o=a=>{a.preventDefault(),i===S.INACTIVE&&s(S.ACTIVE);let u=[a.x,a.y],p=r.element.getBoundingClientRect(),d=Math.floor(yi(u,p)),b=d<vi,f=a.composedPath().includes(r.element);Lt.set(r.element,d);let g=Math.min(...Lt.values())===d;s(f&&g?S.OVER:b&&g?S.NEAR:S.ACTIVE)};window.addEventListener("dragover",o,!1);let l=async a=>{a.preventDefault();let u=await ne(a.dataTransfer);r.onFiles(u),s(S.INACTIVE)};return r.element.addEventListener("drop",l),()=>{Lt.delete(r.element),window.removeEventListener("dragover",o,!1),r.element.removeEventListener("drop",l),Ut.forEach(a=>{window.removeEventListener(a,n,!1)})}}var Rt=class extends c{constructor(){super(...arguments);h(this,"init$",{state:S.INACTIVE})}initCallback(){this._destroyDropzone=oe({element:this,onChange:t=>{this.$.state=t},onFiles:t=>{t.forEach(e=>{this.uploadCollection.add({file:e,isImage:e.type.includes("image"),mimeType:e.type,fileName:e.name,fileSize:e.size})}),this.set$({"*currentActivity":c.activities.UPLOAD_LIST})}}),this.sub("state",t=>{var i;let e=(i=Object.entries(S).find(([,s])=>s===t))==null?void 0:i[0].toLowerCase();e&&this.setAttribute("drag-state",e)})}destroyCallback(){var t;(t=this._destroyDropzone)==null||t.call(this)}};var _i="src-type-",W=class extends c{constructor(){super(...arguments);h(this,"_registeredTypes",{});h(this,"init$",{iconName:"default"})}initTypes(){this.registerType({type:c.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:c.sourceTypes.URL,activity:c.activities.URL,textKey:"from-url"}),this.registerType({type:c.sourceTypes.CAMERA,activity:c.activities.CAMERA}),this.registerType({type:"draw",activity:c.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(c.extSrcList))this.registerType({type:t,activity:c.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",t=>{!t||this.applyType(t)})}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){let e=this._registeredTypes[t],{textKey:i=t,icon:s=t,activity:n,onClick:o,activityParams:l={}}=e;this.applyL10nKey("src-type",`${_i}${i}`),this.$.iconName=s,this.onclick=a=>{n&&this.set$({"*currentActivityParams":l,"*currentActivity":n}),o&&o(a)}}};W.template=`
<uc-icon set="@name: iconName"></uc-icon>
<div class="txt" l10n="src-type"></div>
`;W.bindAttributes({type:null});var Bt=class extends c{initCallback(){let t=this.cfg("source-list");if(!t)return;let e=t.split(",").map(s=>s.trim()),i="";e.forEach(s=>{i+=`<uc-source-btn type="${s}"></uc-source-btn>`}),this.hasAttribute("wrap")?this.innerHTML=i:this.outerHTML=i}};function ae(r,t=40){let e=document.createElement("canvas"),i=e.getContext("2d"),s=new Image,n=new Promise((o,l)=>{s.onload=()=>{let a=s.height/s.width;a>1?(e.width=t,e.height=t*a):(e.height=t,e.width=t/a),i.fillStyle="rgb(240, 240, 240)",i.fillRect(0,0,e.width,e.height),i.drawImage(s,0,0,e.width,e.height),e.toBlob(u=>{let p=URL.createObjectURL(u);o(p)},"image/png")},s.onerror=a=>{console.warn("Resize error..."),l(a)}});return s.src=URL.createObjectURL(r),n}var Mt=class{constructor(){h(this,"caption","");h(this,"text","");h(this,"iconName","");h(this,"isError",!1)}},et=class extends c{constructor(){super(...arguments);h(this,"init$",{iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){this.sub("*message",t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption,msgTxt:t.text,iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};et.template=`
<div class="heading">
  <uc-icon set="@name: iconName"></uc-icon>
  <div class="caption" set="textContent: captionTxt"></div>
  <button set="onclick: onClose">
    <uc-icon name="close"></uc-icon>
  </button>
</div>
<div class="msg" set="textContent: msgTxt"></div>
`;function Ot(r){let t=new Blob([r],{type:"image/svg+xml"});return URL.createObjectURL(t)}function le(r="#fff",t="rgba(0, 0, 0, .1)"){return Ot(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="0" width="20" height="20" fill="${r}" />
    <rect x="0" y="0" width="10" height="10" fill="${t}" />
    <rect x="10" y="10" width="10" height="10" fill="${t}" />
  </svg>`)}function ce(r="rgba(0, 0, 0, .1)"){return Ot(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg">
    <line x1="0" y1="10" x2="10" y2="0" stroke="${r}" />
  </svg>`)}function it(r="hsl(0, 0%, 100%)",t=36,e=36){return Ot(`
  <svg width="${t}" height="${e}" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z" fill="black" fill-opacity="0.06"/>
    <path d="M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z" fill="black" fill-opacity="0.06"/>
    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="${r}"/>
    <path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="url(#paint0_linear_2735_2136)"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z" fill="url(#paint1_radial_2735_2136)"/>
    <path d="M21 8L26 13V14H20V8H21Z" fill="black" fill-opacity="0.03"/>
    <path d="M21 8L26 13V13.5H20.5V8H21Z" fill="black" fill-opacity="0.08"/>
    <path d="M21 8L26 13H21V8Z" fill="${r}"/>
    <path d="M21 8L26 13H21V8Z" fill="url(#paint2_linear_2735_2136)"/>
    <path d="M21 8L26 13H21V8Z" fill="url(#paint3_linear_2735_2136)"/>
    <path d="M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z" fill="url(#paint4_linear_2735_2136)"/>
    <defs>
      <linearGradient id="paint0_linear_2735_2136" x1="18" y1="8" x2="18" y2="28.0027" gradientUnits="userSpaceOnUse">
        <stop stop-color="white" stop-opacity="0.06"/>
        <stop offset="1" stop-color="white" stop-opacity="0"/>
      </linearGradient>
      <radialGradient id="paint1_radial_2735_2136" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10 11) rotate(53.7462) scale(18.6011 18.0323)">
        <stop stop-color="white" stop-opacity="0.12"/>
        <stop offset="1" stop-color="white" stop-opacity="0"/>
      </radialGradient>
      <linearGradient id="paint2_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">
        <stop offset="0.40625" stop-opacity="0"/>
        <stop offset="1" stop-opacity="0.04"/>
      </linearGradient>
      <linearGradient id="paint3_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">
        <stop stop-color="white" stop-opacity="0.16"/>
        <stop offset="1" stop-color="white" stop-opacity="0.06"/>
      </linearGradient>
      <linearGradient id="paint4_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse">
        <stop stop-color="white" stop-opacity="0.15"/>
        <stop offset="1" stop-color="white" stop-opacity="0"/>
      </linearGradient>
    </defs>
</svg>
  `)}var $=class extends c{constructor(){super(...arguments);h(this,"pauseRender",!0);h(this,"init$",{itemName:"",thumb:"",thumbUrl:"",progressWidth:0,progressOpacity:1,notImage:!0,badgeIcon:"check","*focusedEntry":null,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this.entry,"*currentActivity":c.activities.DETAILS})},onRemove:()=>{this.uploadCollection.remove(this.uid)},onUpload:()=>{this.upload()}})}_observerCallback(t){let[e]=t;e.intersectionRatio===0?(clearTimeout(this._thumbTimeoutId),this._thumbTimeoutId=void 0):this._thumbTimeoutId||(this._thumbTimeoutId=setTimeout(()=>this._generateThumbnail(),100))}_generateThumbnail(){var t;if(!this.$.thumbUrl)if((t=this.file)==null?void 0:t.type.includes("image"))ae(this.file,this.cfg("thumb-size")||76).then(e=>{this.$.thumbUrl=`url(${e})`});else{let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");this.$.thumbUrl=`url(${it(e)})`}}_revokeThumbUrl(){var t;((t=this.$.thumbUrl)==null?void 0:t.startsWith("blob:"))&&URL.revokeObjectURL(this.$.thumbUrl)}initCallback(){this.defineAccessor("entry-id",t=>{var e;!t||(this.uid=t,this.entry=(e=this.uploadCollection)==null?void 0:e.read(t),this.entry.subscribe("fileName",i=>{this.$.itemName=i||this.externalUrl||this.l10n("file-no-name")}),this.entry.subscribe("externalUrl",i=>{this.$.itemName=this.entry.getValue("fileName")||i||this.l10n("file-no-name")}),this.entry.subscribe("uuid",i=>{if(!!i&&(this._observer.unobserve(this),this.setAttribute("loaded",""),this.entry.getValue("isImage"))){let s=`https://ucarecdn.com/${i}/`;this._revokeThumbUrl();let n=this.cfg("thumb-size")||76;this.$.thumbUrl=`url(${s}-/scale_crop/${n}x${n}/center/)`}}),this.entry.subscribe("transformationsUrl",i=>{if(!!i&&this.entry.getValue("isImage")){this._revokeThumbUrl();let s=this.cfg("thumb-size")||76;this.$.thumbUrl=`url(${i}-/scale_crop/${s}x${s}/center/)`}}),this.file=this.entry.getValue("file"),this.externalUrl=this.entry.getValue("externalUrl"),this.cfg("confirm-upload")||this.upload(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this))}),this.$["*uploadTrigger"]=null,$.activeInstances.add(this),this.sub("*uploadTrigger",t=>{!t||!this.isConnected||this.upload()}),this.onclick=()=>{$.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})}}destroyCallback(){$.activeInstances.delete(this),this._observer.unobserve(this),clearTimeout(this._thumbTimeoutId)}async upload(){var i;if(this.hasAttribute("loaded")||this.entry.getValue("uuid"))return;this.$.progressWidth=0,this.$.progressOpacity=1,this.removeAttribute("focused"),this.removeAttribute("error"),this.setAttribute("uploading","");let t={},e=this.cfg("store");e!==null&&(t.store=!!e);try{let s=await ee(this.file||this.externalUrl,{...t,publicKey:this.cfg("pubkey"),onProgress:n=>{let o=n.value*100;this.$.progressWidth=o+"%",this.entry.setValue("uploadProgress",o)}});this.$.progressOpacity=0,this.setAttribute("loaded",""),this.removeAttribute("uploading"),this.$.badgeIcon="badge-success",this.entry.setMultipleValues({fileInfo:s,uploadProgress:100,fileName:s.name,fileSize:s.size,isImage:s.isImage,mimeType:s.mimeType,uuid:s.uuid})}catch(s){this.$.progressOpacity=0,this.$.progressWidth=0,this.setAttribute("error",""),this.removeAttribute("uploading");let n=new Mt;n.caption=this.l10n("upload-error")+": "+(((i=this.file)==null?void 0:i.name)||this.externalUrl),n.text=s,n.isError=!0,this.set$({badgeIcon:"badge-error","*message":n}),this.entry.setValue("uploadErrorMsg",s)}}};$.template=`
<div
  class="thumb"
  set="style.backgroundImage: thumbUrl">
  <div class="badge">
    <uc-icon set="@name: badgeIcon"></uc-icon>
  </div>
</div>
<div class="file-name-wrapper">
  <span class="file-name" set="textContent: itemName; @title: itemName"></span>
</div>
<button class="edit-btn" set="onclick: onEdit;">
  <uc-icon name="edit-file"></uc-icon>
</button>
<button class="remove-btn" set="onclick: onRemove;">
  <uc-icon name="remove-file"></uc-icon>
</button>
<button class="upload-btn" set="onclick: onUpload;">
  <uc-icon name="upload"></uc-icon>
</button>
<div
  class="progress"
  set="style.width: progressWidth; style.opacity: progressOpacity">
</div>
`;$.activeInstances=new Set;$.bindAttributes({"entry-id":null});var st=class extends c{constructor(){super(...arguments);h(this,"init$",{"*modalActive":!1,"*modalHeaderHidden":!1,closeClicked:()=>{this.$["*modalActive"]=!1}})}initCallback(){this.sub("*modalActive",t=>{t?this.setAttribute("active",""):this.removeAttribute("active"),t&&this.hasAttribute("block-body-scrolling")?document.body.style.overflow="hidden":document.body.style.overflow=null}),this.hasAttribute("strokes")&&(this.style.backgroundImage=`url(${ce()})`)}};st.template=`
<div class="dialog">
  <div class="heading" set="@hidden: *modalHeaderHidden">
    <slot name="heading"></slot>
    <button
      class="close-btn"
      set="onclick: closeClicked">
      <uc-icon name="close"></uc-icon>
    </button>
  </div>
  <div class="content">
    <slot></slot>
  </div>
</div>
`;var rt=class{constructor(){h(this,"captionL10nStr","confirm-your-action");h(this,"messageL10Str","are-you-sure");h(this,"confirmL10nStr","yes");h(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},nt=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.CONFIRMATION);h(this,"_defaults",new rt);h(this,"init$",{messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",t=>{!t||this.set$({"*modalHeaderHidden":!0,"*currentActivity":c.activities.CONFIRMATION,"*modalCaption":this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,t.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,t.confirmAction()}})})}};nt.template=`
<div
  class="message"
  set="textContent: messageTxt">
</div>
<div class="toolbar">
  <button
    class="deny-btn secondary-btn"
    set="textContent: denyBtnTxt; onclick: onDeny">
  </button>
  <button
    class="confirm-btn primary-btn"
    set="textContent: confirmBtnTxt; onclick: onConfirm">
  </button>
</div>
`;var ot=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.UPLOAD_LIST);h(this,"init$",{doneBtnHidden:!0,uploadBtnHidden:!1,uploadBtnDisabled:!1,hasFiles:!1,moreBtnDisabled:!0,onAdd:()=>{this.$["*currentActivity"]=c.activities.SOURCE_SELECT},onUpload:()=>{this.set$({"*uploadTrigger":{}})},onDone:()=>{this.set$({"*currentActivity":this.doneActivity||"","*modalActive":!1}),this.output()},onCancel:()=>{let t=new rt;t.confirmAction=()=>{this.set$({"*currentActivity":this.cancelActivity||"","*modalActive":!1}),this.uploadCollection.clearAll(),this.output()},t.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=t}});h(this,"_renderMap",Object.create(null))}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({"*modalCaption":this.l10n("selected"),"*modalIcon":"local"})}),this.$.moreBtnDisabled=!this.cfg("multiple"),this.uploadCollection.observe(()=>{let t=this.uploadCollection.findItems(n=>!n.getValue("uuid")),e=this.uploadCollection.findItems(n=>!n.getValue("uuid")&&n.getValue("uploadProgress")>0),i=t.length===0,s=e.length>0;this.set$({uploadBtnHidden:i,uploadBtnDisabled:s,doneBtnHidden:!i}),!this.cfg("confirm-upload")&&i&&this.$.onDone()}),this.sub("*uploadList",t=>{if(t&&t.length===0&&!this.cfg("show-empty-list")){this.$["*currentActivity"]=c.activities.SOURCE_SELECT;return}this.set$({uploadBtnDisabled:!t.length,hasFiles:t.length>0}),t.forEach(i=>{if(!this._renderMap[i]){let s=new $;this._renderMap[i]=s}});for(let i in this._renderMap)t.includes(i)||(this._renderMap[i].remove(),delete this._renderMap[i]);let e=document.createDocumentFragment();Object.values(this._renderMap).forEach(i=>e.appendChild(i)),this.ref.files.replaceChildren(e),Object.entries(this._renderMap).forEach(([i,s])=>{setTimeout(()=>{s["entry-id"]=i,s.render()})})})}};ot.template=`
<div class="no-files" set="@hidden: hasFiles">
  <slot name="empty"><span l10n="no-files"></span></slot>
</div>
<div class="files" ref="files"></div>
<div class="toolbar">
  <button
    class="cancel-btn secondary-btn"
    set="onclick: onCancel;"
    l10n="clear"></button>
  <div></div>
  <button
    class="add-more-btn secondary-btn"
    set="onclick: onAdd; @disabled: moreBtnDisabled"
    l10n="add-more"></button>
  <button
    class="upload-btn primary-btn"
    set="@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled"
    l10n="upload"></button>
  <button
    class="done-btn primary-btn"
    set="@hidden: doneBtnHidden; onclick: onDone"
    l10n="done"></button>
</div>
`;var at=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.URL);h(this,"init$",{onUpload:()=>{let t=this.ref.input.value;this.uploadCollection.add({externalUrl:t}),this.$["*currentActivity"]=c.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":c.activities.SOURCE_SELECT})}})}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({"*modalCaption":this.l10n("caption-from-url"),"*modalIcon":"url"})})}};at.template=`
<input placeholder="https://..." .url-input type="text" ref="input" />
<button
  class="url-upload-btn primary-btn "
  set="onclick: onUpload">
</button>
<button
  class="cancel-btn secondary-btn"
  set="onclick: onCancel"
  l10n="cancel">
</button>
`;var lt=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.CAMERA);h(this,"init$",{video:null,videoTransformCss:null,onCancel:()=>{this.set$({"*currentActivity":c.activities.SOURCE_SELECT})},onShot:()=>{this._shot()}})}async _init(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._stream=await navigator.mediaDevices.getUserMedia(t),this.$.video=this._stream,this._initialized=!0}_deInit(){var t;this._initialized&&((t=this._stream)==null||t.getTracks()[0].stop(),this.$.video=null,this._initialized=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),e=`camera-${t}.png`;this._canvas.toBlob(i=>{let s=new File([i],e,{lastModified:t,type:"image/png"});this.uploadCollection.add({file:s,fileName:e,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":c.activities.UPLOAD_LIST})})}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({videoTransformCss:this.cfg("camera-mirror")?"scaleX(-1)":null,"*modalCaption":this.l10n("caption-camera"),"*modalIcon":"camera"}),this._init()}),this.sub("*currentActivity",t=>{t!==this.activityType&&this._deInit()})}};lt.template=`
<video
  autoplay
  playsinline
  set="srcObject: video; style.transform: videoTransformCss"
  ref="video">
</video>

<div class="toolbar">
  <button
    class="cancel-btn secondary-btn"
    set="onclick: onCancel"
    l10n="cancel">
  </button>
  <button
    class="shot-btn primary-btn"
    set="onclick: onShot"
    l10n="camera-shot">
  </button>
</div>
`;var ct=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.DETAILS);h(this,"init$",{checkerboard:!1,localImageEditDisabled:!0,fileSize:null,fileName:"",notUploaded:!0,cdnUrl:"",errorTxt:"",editBtnHidden:!0,onNameInput:null,"*focusedEntry":null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.__ctxId),this.historyBack()},onEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=c.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),e=it(t,108,108);this.eCanvas.setImageUrl(e),this.set$({checkerboard:!1})}initCallback(){this.$.localImageEditDisabled=!this.cfg("use-local-image-editor"),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,()=>{this.set$({"*modalCaption":this.l10n("caption-edit-file")})}),this.eCanvas=this.ref.canvas,this.sub("*focusedEntry",t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach(s=>{this._entrySubs.delete(s),s.remove()}):this._entrySubs=new Set,this.entry=t;let e=t.getValue("file");if(this.eCanvas.clear(),e){this._file=e;let s=this._file.type.includes("image");s&&!t.getValue("transformationsUrl")&&(this.eCanvas.setImageFile(this._file),this.set$({checkerboard:!0,editBtnHidden:!this.cfg("use-local-image-editor")&&!this.cfg("use-cloud-image-editor")})),s||this.showNonImageThumb()}let i=(s,n)=>{this._entrySubs.add(this.entry.subscribe(s,n))};i("fileName",s=>{this.$.fileName=s,this.$.onNameInput=()=>{Object.defineProperty(this._file,"name",{writable:!0,value:this.ref.file_name_input.value})}}),i("fileSize",s=>{this.$.fileSize=Number.isFinite(s)?this.fileSizeFmt(s):this.l10n("file-size-unknown")}),i("uuid",s=>{s?(this.eCanvas.clear(),this.set$({cdnUrl:`https://ucarecdn.com/${s}/`,notUploaded:!1}),this.eCanvas.setImageUrl(this.$.cdnUrl)):this.$.cdnUrl="Not uploaded yet..."}),i("uploadErrorMsg",s=>{this.$.errorTxt=s}),i("externalUrl",s=>{!s||this.entry.getValue("uuid")||this.showNonImageThumb()}),i("transformationsUrl",s=>{!s||this.entry.getValue("isImage")&&this.eCanvas.setImageUrl(s)})})}};ct.template=`
<uc-tabs
  tab-list="tab-view, tab-details">

  <div
    tab-ctx="tab-details"
    class="details">

    <div class="info-block">
      <div class="info-block_name" l10n="file-name"></div>
      <input
        name="name-input"
        ref="file_name_input"
        set="value: fileName; oninput: onNameInput"
        type="text" />
    </div>

    <div class="info-block">
      <div class="info-block_name" l10n="file-size"></div>
      <div set="textContent: fileSize"></div>
    </div>

    <div class="info-block">
      <div class="info-block_name" l10n="cdn-url"></div>
      <a
        target="_blank"
        set="textContent: cdnUrl; @href: cdnUrl; @disabled: notUploaded"></a>
    </div>

    <div set="textContent: errorTxt;"></div>

  </div>

  <uc-editable-canvas
    tab-ctx="tab-view"
    set="@disabled: localImageEditDisabled; @checkerboard: checkerboard;"
    ref="canvas">
  </uc-editable-canvas>
</uc-tabs>

<div class="toolbar" set="@edit-disabled: editBtnHidden">
  <button
    class="edit-btn secondary-btn"
    set="onclick: onEdit; @hidden: editBtnHidden;">
    <uc-icon name="edit"></uc-icon>
    <span l10n="edit-image"></span>
  </button>
  <button
    class="remove-btn secondary-btn"
    set="onclick: onRemove">
    <uc-icon name="remove"></uc-icon>
    <span l10n="remove-from-list"></span>
  </button>
  <div></div>
  <button
    class="back-btn primary-btn"
    set="onclick: onBack">
    <span l10n="done"></span>
  </button>
</div>
`;var ut=class extends c{constructor(){super(...arguments);h(this,"init$",{cssWidth:0,"*commonProgress":0})}initCallback(){this.sub("*commonProgress",t=>{t===0||t===100?this.removeAttribute("active"):this.setAttribute("active",""),this.$.cssWidth=t+"%"})}};ut.template=`
<div
  class="bar"
  set="style.width: cssWidth">
</div>
`;var ue="http://www.w3.org/2000/svg",V=class{_syncSvgSize(){let t=this.svgGroupEl.getBoundingClientRect();R(this.svgEl,{viewBox:`0, 0, ${t.width}, ${t.height}`,width:t.width,height:t.height})}_syncCanvas(){return new Promise((t,e)=>{let i=URL.createObjectURL(new Blob([this.svgEl.outerHTML],{type:"image/svg+xml"}));this.vImg.onload=()=>{this.can.height=this.vImg.height,this.can.width=this.vImg.width,this.ctx.drawImage(this.vImg,0,0,this.vImg.width,this.vImg.height),t()},this.vImg.onerror=()=>{e()},this.vImg.src=i})}_backSyncSvg(){return this.svgGroupEl.style.transform=null,this.svgGroupEl.style.filter=null,R(this.svgEl,{viewBox:`0, 0, ${this.can.width}, ${this.can.height}`,width:this.can.width,height:this.can.height}),R(this.svgImgEl,{href:this.can.toDataURL("image/png"),width:this.can.width,height:this.can.height}),this._addedObjects.forEach(t=>{t.remove()}),new Promise((t,e)=>{this.svgImgEl.onload=()=>{t()},this.svgImgEl.onerror=()=>{e()}})}async _syncAll(){this._syncSvgSize(),await this._syncCanvas(),await this._backSyncSvg()}constructor(t){this.can=t.canvas,this.svgEl=t.svg,this.svgGroupEl=t.svgGroup,this.svgImgEl=t.svgImg,this.vImg=new Image,this.ctx=t.canvCtx,this.currentColor=V.defaultColor,this._addedObjects=new Set,window.setTimeout(()=>{this._backSyncSvg()},100)}applyCss(t){X(this.svgGroupEl,t)}getImg(){let t=new Image;return t.src=this.can.toDataURL("image/png"),new Promise((e,i)=>{t.onload=()=>{e(t)},t.onerror=()=>{i(t)}})}rotate(){this.applyCss({"transform-origin":"0 0",transform:`rotate(90deg) translateY(-${this.can.height}px)`}),this._syncAll()}flip(t){this.applyCss({"transform-origin":"50% 50%",transform:`scale(${t==="vertical"?"1, -1":"-1, 1"})`}),this._syncAll()}brightness(t){this.applyCss({filter:`brightness(${t}%)`})}contrast(t){this.applyCss({filter:`contrast(${t}%)`})}saturate(t){this.applyCss({filter:`saturate(${t}%)`})}setColor(t){this.currentColor=t}startText(){let t=e=>{let i=document.createElementNS(ue,"text");R(i,{fill:this.currentColor,x:e.offsetX,y:e.offsetY}),i.textContent="TEXT",this.svgGroupEl.appendChild(i),this._addedObjects.add(i),i.focus(),this.svgEl.removeEventListener("mousedown",t)};this.svgEl.addEventListener("mousedown",t)}stopText(){this.bake()}startDraw(){this.svgEl.addEventListener("mousedown",t=>{let e=document.createElementNS(ue,"polyline");R(e,{fill:"none",stroke:this.currentColor,"stroke-width":"4px"}),this.svgGroupEl.appendChild(e),this._addedObjects.add(e);let i=[];this.svgEl.onmousemove=s=>{i.push(`${s.offsetX},${s.offsetY}`),e.setAttribute("points",i.join(" "))}}),window.addEventListener("mouseup",()=>{this.svgEl.onmousemove=null,this.bake()}),window.addEventListener("mouseleave",()=>{this.svgEl.onmousemove=null,this.bake()})}removeMode(t){}resize(){}crop(){}bake(){this._syncAll()}restore(){}};V.defaultColor="#f00";var ht=class extends c{constructor(){super(...arguments);h(this,"init$",{cssLeft:"50%",caption:"CAPTION",barActive:!1,"*rangeValue":100,onChange:()=>{this.$["*rangeValue"]=this.ref.range.value}})}initCallback(){[...this.attributes].forEach(t=>{["style","ref"].includes(t.name)||this.ref.range.setAttribute(t.name,t.value)}),this.sub("*rangeValue",t=>{let e=t/this.ref.range.max*100;this.$.cssLeft=`${e}%`})}};ht.template=`
<datalist id="range-values">
  <option value="0" label="min"></option>
  <option value="100" label="0"></option>
  <option value="200" label="max"></option>
</datalist>
<div class="track">
  <div class="bar" set="style.width: cssLeft; @active: barActive"></div>
  <div class="slider" set="style.left: cssLeft"></div>
  <div class="center"></div>
  <div class="caption" set="textContent: caption; @text: caption"></div>
</div>
<input 
  type="range"
  ref="range"
  list="range-values" 
  set="@value: *rangeValue; oninput: onChange">
`;var dt=class extends c{constructor(){super(...arguments);h(this,"init$",{inputOpacity:0,"*selectedColor":"#f00",onChange:()=>{this.$["*selectedColor"]=this.ref.input.value}})}};dt.template=`
<input 
  ref="input"
  type="color" 
  set="oninput: onChange; style.opacity: inputOpacity">
<div 
  class="current-color"
  set="style.backgroundColor: *selectedColor">
</div>
`;var Ci=[{action:"fullscreen",icon:"",l10n_name:"toggle-fullscreen",set:"@name: fsIcon"},{action:"rotate_cw",icon:"edit-rotate",l10n_name:"rotate",set:""},{action:"flip_v",icon:"edit-flip-v",l10n_name:"flip-vertical",set:""},{action:"flip_h",icon:"edit-flip-h",l10n_name:"flip-horizontal",set:""},{action:"brightness",icon:"edit-brightness",l10n_name:"brightness",set:""},{action:"contrast",icon:"edit-contrast",l10n_name:"contrast",set:""},{action:"saturation",icon:"edit-saturation",l10n_name:"saturation",set:""},{clr:!0},{action:"text",icon:"edit-text",l10n_name:"text",set:""},{action:"draw",icon:"edit-draw",l10n_name:"draw",set:""},{action:"cancel",icon:"close",l10n_name:"cancel-edit",set:""}];function wi(r){return`<button 
  action="${r.action}" 
  ref="${r.ref}"
  l10n="title:${r.l10n_name}">
  <uc-icon
    set="${r.set}" 
    name="${r.icon}">
  </uc-icon>
</button>`.trim()}var xi=`<uc-color 
  ref="color" 
  action="color"
  set="onchange: onColor" 
  l10n="title:select-color"></uc-color>`;function he(){return Ci.reduce((r,t)=>r+=t.clr?xi:wi(t),"")}ht.reg("range");dt.reg("color");var jt={FS:"fullscreen",EXIT:"fullscreen-exit"},pt=class extends c{constructor(){super(...arguments);h(this,"init$",{fsIcon:jt.FS,rangeActive:!1,rangeCaption:"",onBtnClick:t=>{this.canMan.stopText(),this.rangeCtx=null,this.set$({rangeActive:!1,rangeCaption:"","*rangeValue":100});let e=t.target.closest("[action]");e&&(this.buttons.add(e),this.buttons.forEach(s=>{s===e?s.setAttribute("current",""):s.removeAttribute("current","")}));let i=e.getAttribute("action");console.log(i),!!i&&this.actionsMap[i]()}});h(this,"buttons",new Set);h(this,"editor",null)}get actionsMap(){return{fullscreen:()=>{document.fullscreenElement===this.rMap.parent?(document.exitFullscreen(),this.$.fsIcon=jt.FS):(this.rMap.parent.requestFullscreen(),this.$.fsIcon=jt.EXIT)},rotate_cw:()=>{this.canMan.rotate()},flip_v:()=>{this.canMan.flip("vertical")},flip_h:()=>{this.canMan.flip("horizontal")},brightness:()=>{this.rangeCtx="brightness",this.set$({rangeActive:!0,rangeCaption:this.l10n("brightness")})},contrast:()=>{this.rangeCtx="contrast",this.set$({rangeActive:!0,rangeCaption:this.l10n("contrast")})},saturation:()=>{this.rangeCtx="saturate",this.set$({rangeActive:!0,rangeCaption:this.l10n("saturation")})},resize:()=>{this.canMan.resize()},crop:()=>{this.canMan.crop()},color:()=>{this.ref.color.dispatchEvent(new MouseEvent("click"))},text:()=>{this.canMan.startText()},draw:()=>{this.canMan.startDraw()},cancel:()=>{this.canMan.restore()}}}initCallback(){this.defineAccessor("refMap",t=>{!t||(this.rMap=t,this.canMan=new V(t))}),this.sub("*rangeValue",t=>{var e,i;(i=(e=this.canMan)==null?void 0:e[this.rangeCtx])==null||i.call(e,t)}),this.sub("*selectedColor",t=>{var e;(e=this.canMan)==null||e.setColor(t)})}};pt.template=`
<div 
  class="btns"
  ref="btns" 
  set="onclick: onBtnClick">${he()}</div>
<uc-range 
  min="0" 
  max="200" 
  ref="range"
  set="@visible: rangeActive; $.caption: rangeCaption">
</uc-range>
`;pt.reg("editor-toolbar");var q=class extends c{constructor(){super();h(this,"init$",{refMap:null,disabled:!0,toolbarHidden:!0,checkerboard:!1});X(this,{display:"flex",justifyContent:"center",alignItems:"center"})}initCallback(){this.sub("disabled",()=>{this.$.toolbarHidden=this.hasAttribute("disabled")&&this.getAttribute("disabled")!=="false"}),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${le()})`:"unset"}),this.canvas=this.ref.cvs,this.canvCtx=this.canvas.getContext("2d"),this.$.refMap={parent:this,canvas:this.canvas,canvCtx:this.canvCtx,svg:this.ref.svg,svgGroup:this.ref.svg_g,svgImg:this.ref.svg_img}}setImage(t){t.height&&t.width?(this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)):t.onload=()=>{this.canvas.height=t.height,this.canvas.width=t.width,this.canvCtx.drawImage(t,0,0,t.width,t.height)}}setImageFile(t){let e=new Image,i=URL.createObjectURL(t);e.src=i,this.setImage(e)}setImageUrl(t){let e=new Image;e.src=t,this.setImage(e)}clear(){this.canvCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}};q.template=`
<canvas class="img-view" ref="cvs"></canvas>
<svg class="img-view" xmlns="http://www.w3.org/2000/svg" ref="svg">
  <g ref="svg_g">
    <image ref="svg_img" x="0" y="0"></image>
  </g>
</svg>
<uc-editor-toolbar
  set="refMap: refMap; @hidden: toolbarHidden">
</uc-editor-toolbar>
`;q.bindAttributes({disabled:"disabled",checkerboard:"checkerboard"});var Ai="https://ucarecdn.com/libs/editor/0.0.1-alpha.0.9/uploadcare-editor.js",Dt=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.CLOUD_IMG_EDIT);h(this,"init$",{uuid:null})}loadScript(){let t=document.createElement("script");t.src=Ai,t.setAttribute("type","module"),document.body.appendChild(t)}initCallback(){this.style.display="flex",this.style.position="relative",this.loadScript(),this.sub("*currentActivity",t=>{t===c.activities.CLOUD_IMG_EDIT?this.mountEditor():this.unmountEditor()}),this.sub("*focusedEntry",t=>{!t||(this.entry=t,this.entry.subscribe("uuid",e=>{e&&(this.$.uuid=e)}))})}handleApply(t){let e=t.detail,{transformationsUrl:i}=e;this.entry.setValue("transformationsUrl",i),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=window.customElements.get("uc-editor"),e=new t,i=this.$.uuid,s=this.cfg("pubkey");e.setAttribute("uuid",i),e.setAttribute("public-key",s),e.addEventListener("apply",n=>this.handleApply(n)),e.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.style.width="600px",this.style.height="400px",this.appendChild(e)}unmountEditor(){this.style.width="0px",this.style.height="0px",this.innerHTML=""}};var L={};window.addEventListener("message",r=>{let t;try{t=JSON.parse(r.data)}catch(e){return}if((t==null?void 0:t.type)in L){let e=L[t.type];for(let[i,s]of e)r.source===i&&s(t)}});var de=function(r,t,e){r in L||(L[r]=[]),L[r].push([t,e])},pe=function(r,t){r in L&&(L[r]=L[r].filter(e=>e[0]!==t))};var Ti=r=>Object.keys(r).reduce((e,i)=>{let s=r[i],n=Object.keys(s).reduce((o,l)=>{let a=s[l];return o+`${l}: ${a};`},"");return e+`${i}{${n}}`},"");function me({textColor:r,backgroundColor:t,linkColor:e,linkColorHover:i,shadeColor:s}){let n=`solid 1px ${s}`;return Ti({body:{color:r,"background-color":t},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:s},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:e},".bread-crumbs a:hover":{color:i},".main-content.loading":{background:`${t} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${s}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:e},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:i},".side-bar-menu a":{color:e},".side-bar-menu a:hover":{color:i},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:i},".source-vk .side-bar-menu a":{color:e},".source-vk .side-bar-menu a:hover":{color:i,background:"none"}})}var mt=class extends c{constructor(){super(...arguments);h(this,"activityType",c.activities.EXTERNAL);h(this,"init$",{counter:0,onDone:()=>{this.$["*currentActivity"]=c.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":c.activities.SOURCE_SELECT})}});h(this,"_iframe",null)}initCallback(){this.registerActivity(this.activityType,()=>{let{externalSourceType:t}=this.activityParams;this.set$({"*modalCaption":`${t[0].toUpperCase()}${t.slice(1)}`,"*modalIcon":t}),this.$.counter=0,this.mountIframe()}),this.sub("*currentActivity",t=>{t!==this.activityType&&this.unmountIframe()})}sendMessage(t){this._iframe.contentWindow.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){this.$.counter=this.$.counter+1;let{url:e,filename:i}=t;this.uploadCollection.add({externalUrl:e,fileName:i})}handleIframeLoad(t){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:me(t)})}remoteUrl(){let t=this.cfg("pubkey"),e="3.11.3",i=(!1).toString(),{externalSourceType:s}=this.activityParams;return`https://social.uploadcare.com/window3/${s}?lang=en&public_key=${t}&widget_version=${e}&images_only=${i}&pass_window_open=false`}mountIframe(){console.log("IFRAME");let t=H({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),de("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t}unmountIframe(){this._iframe&&pe("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}};mt.template=`
<div
  ref="iframeWrapper"
  class="iframe-wrapper">
</div>
<div class="toolbar">
  <button
    class="cancel-btn secondary-btn"
    set="onclick: onCancel"
    l10n="cancel">
  </button>
  <div></div>
  <div class="selected-counter">
    <span l10n="selected-count"></span>
    <span set="textContent: counter"></span>
  </div>
  <button class="done-btn primary-btn" set="onclick: onDone">
    <uc-icon name="check"></uc-icon>
  </button>
</div>
`;var J=class extends c{setCurrentTab(t){if(!t)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(i=>{i.getAttribute("tab-ctx")===t?i.removeAttribute("hidden"):i.setAttribute("hidden","")});for(let i in this._tabMap)i===t?this._tabMap[i].setAttribute("current",""):this._tabMap[i].removeAttribute("current")}initCallback(){this._tabMap={},this.defineAccessor("tab-list",t=>{if(!t)return;t.split(",").map(i=>i.trim()).forEach(i=>{let s=H({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(i)}}});s.textContent=this.l10n(i),this.ref.row.appendChild(s),this._tabMap[i]=s})}),this.defineAccessor("default",t=>{this.setCurrentTab(t)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};J.bindAttributes({"tab-list":null,default:null});J.template=`
<div ref="row" class="tabs-row"></div>
<div ref="context" class="tabs-context">
  <slot></slot>
</div>
`;var A=class extends c{initCallback(){let t=this.getAttribute("from");this.sub(t||A.defaultFrom,e=>{if(!e){this.innerHTML="";return}if(this.hasAttribute(A.fireEventAttrName)&&this.dispatchEvent(new CustomEvent(A.outputEventName,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(A.templateAttrName)){let i=this.getAttribute(A.templateAttrName),s="";e.forEach(n=>{let o=i;for(let l in n)o=o.split(`{{${l}}}`).join(n[l]);s+=o}),this.innerHTML=s}this.value=e,this.hasAttribute(A.formValueAttrName)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this.appendChild(this._input)),this._input.value=JSON.stringify(e)),this.hasAttribute(A.consoleAttrName)&&console.log(e)})}};A.outputEventName="data-output";A.templateAttrName="item-template";A.fireEventAttrName="fire-event";A.consoleAttrName="console";A.formValueAttrName="form-value";A.defaultFrom="*outputData";var ft=class extends c{constructor(){super(...arguments);h(this,"init$",{"*modalCaption":void 0})}};ft.template=`
<div
  class="caption"
  set="textContent: *modalCaption">
</div>
`;var gt=class extends c{constructor(){super(...arguments);h(this,"init$",{"*modalIcon":"default"})}};gt.template=`
<uc-icon set="@name: *modalIcon"></uc-icon>
`;function fe(r){var t,e;for(let i in r){let s=[...i].reduce((n,o)=>(o.toUpperCase()===o&&(o="-"+o.toLowerCase()),n+=o),"");s.startsWith("-")&&(s=s.replace("-","")),(e=(t=r[i]).reg)==null||e.call(t,s)}}typeof window!="undefined"&&fe(Pt);export{Pt as UC};
