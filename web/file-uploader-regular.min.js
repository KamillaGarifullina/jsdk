/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2021 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var $i=Object.defineProperty;var Si=(r,e,t)=>e in r?$i(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var p=(r,e,t)=>(Si(r,typeof e!="symbol"?e+"":e,t),t);function Ai(r){let e=t=>{var i;for(let s in t)((i=t[s])==null?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}};return e(r)}var v=class{constructor(e){this.uid=Symbol(),this.name=e.name||null,e.schema.constructor===Object?this.store=Ai(e.schema):(this._storeIsProxy=!0,this.store=e.schema),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(v.warn("read",e),null):this.store[e]}has(e){return this._storeIsProxy?this.store[e]!==void 0:this.store.hasOwnProperty(e)}add(e,t,i=!0){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.callbackMap[e]&&this.callbackMap[e].forEach(s=>{s(this.store[e])}))}pub(e,t){if(!this._storeIsProxy&&!this.store.hasOwnProperty(e)){v.warn("publish",e);return}this.add(e,t)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach(t=>{t(this.store[e])})}sub(e,t,i=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(v.warn("subscribe",e),null):(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t})}remove(){delete v.globalStore[this.uid]}static registerLocalCtx(e){let t=new v({schema:e});return v.globalStore[t.uid]=t,t}static registerNamedCtx(e,t){let i=v.globalStore[e];return i?console.warn('State: context name "'+e+'" already in use'):(i=new v({name:e,schema:t}),v.globalStore[e]=i),i}static clearNamedCtx(e){delete v.globalStore[e]}static getNamedCtx(e,t=!0){return v.globalStore[e]||(t&&console.warn('State: wrong context name - "'+e+'"'),null)}};v.globalStore=Object.create(null);var y=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"});var Et="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",ki=Et.length-1,F=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+=e[i]==="-"?e[i]:Et.charAt(Math.random()*ki);return t}};function Ii(r,e){if(e.shadowRoot)return;let t=[...r.querySelectorAll("slot")];if(e.initChildren.length&&t.length){let i={};t.forEach(s=>{let n=s.getAttribute("name");n?i[n]={slot:s,fr:document.createDocumentFragment()}:i.__default__={slot:s,fr:document.createDocumentFragment()}}),e.initChildren.forEach(s=>{var o;let n=(o=s.getAttribute)==null?void 0:o.call(s,"slot");n?(s.removeAttribute("slot"),i[n].fr.appendChild(s)):i.__default__&&i.__default__.fr.appendChild(s)}),Object.values(i).forEach(s=>{s.slot.parentNode.insertBefore(s.fr,s.slot),s.slot.remove()})}}function Ri(r,e){[...r.querySelectorAll(`[${y.EL_REF_ATTR}]`)].forEach(t=>{let i=t.getAttribute(y.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(y.EL_REF_ATTR)})}function Li(r,e){[...r.querySelectorAll(`[${y.BIND_ATTR}]`)].forEach(t=>{t.getAttribute(y.BIND_ATTR).split(";").forEach(n=>{if(!n)return;let o=n.split(":").map(_=>_.trim()),a=o[0],l;a.indexOf(y.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(y.ATTR_BIND_PRFX,""));let c=o[1].split(",").map(_=>_.trim()),u,h,m,f;if(a.includes(".")){u=!0;let _=a.split(".");f=()=>{h=t,_.forEach((b,x)=>{x<_.length-1?h=h[b]:m=b})},f()}for(let _ of c)e.sub(_,b=>{l?(b==null?void 0:b.constructor)===Boolean?b?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,b):u?h?h[m]=b:window.setTimeout(()=>{f(),h[m]=b}):t[a]=b})}),t.removeAttribute(y.BIND_ATTR)})}var we="{{",he="}}",Oi="skip-text";function Pi(r){let e,t=[],i=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var n;return!((n=s.parentElement)!=null&&n.hasAttribute(Oi))&&s.textContent.includes(we)&&s.textContent.includes(he)&&1}});for(;e=i.nextNode();)t.push(e);return t}var Ni=function(r,e){Pi(r).forEach(i=>{let s=[],n;for(;i.textContent.includes(he);)i.textContent.startsWith(we)?(n=i.textContent.indexOf(he)+he.length,i.splitText(n),s.push(i)):(n=i.textContent.indexOf(we),i.splitText(n)),i=i.nextSibling;s.forEach(o=>{let a=o.textContent.replace(we,"").replace(he,"");e.sub(a,l=>{o.textContent=l})})})},$t=[Ii,Ri,Li,Ni];var St=0,z=class extends HTMLElement{initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,(e=this.initCallback)==null||e.call(this))}render(e,t=this.renderShadow){let i;if((t||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.processInnerHtml)for(let n of this.tplProcessors)n(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(e==null?void 0:e.constructor)===DocumentFragment)i=e;else if((e==null?void 0:e.constructor)===String){let n=document.createElement("template");n.innerHTML=e,i=n.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let n of this.tplProcessors)n(i,this)}let s=()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let n=document.createElement("link");n.rel="stylesheet",n.href=this.constructor.__shadowStylesUrl,n.onload=s,this.shadowRoot.prepend(n)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}constructor(){super();this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=F.generate(),this.style.setProperty(y.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(y.CSS_CTX_PROP,!0)}get ctxName(){var e;return((e=this.getAttribute(y.CTX_NAME_ATTR))==null?void 0:e.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=v.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return v.getNamedCtx(this.ctxName,!1)||v.registerNamedCtx(this.ctxName,{})}static __parseProp(e,t){let i,s;if(e.startsWith(y.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(y.EXT_DATA_CTX_PRFX,"");else if(e.includes(y.NAMED_DATA_CTX_SPLTR)){let n=e.split(y.NAMED_DATA_CTX_SPLTR);i=v.getNamedCtx(n[0]),s=n[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t){let i=z.__parseProp(e,this);this.allSubs.add(i.ctx.sub(i.name,t))}notify(e){let t=z.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=z.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t){let i=z.__parseProp(e,this);i.ctx.add(i.name,t,!1)}add$(e){for(let t in e)this.add(t,e[t])}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(t,i,s)=>{let n=z.__parseProp(i,this);return n.ctx.pub(n.name,s),!0},get:(t,i)=>{let s=z.__parseProp(i,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(e){for(let t in e)this.$[t]=e[t]}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let t in this.init$)if(t.startsWith(y.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(y.EXT_DATA_CTX_PRFX,""),this.init$[t]);else if(t.includes(y.NAMED_DATA_CTX_SPLTR)){let i=t.split(y.NAMED_DATA_CTX_SPLTR),s=i[0].trim(),n=i[1].trim();if(s&&n){let o=v.getNamedCtx(s,!1);o||(o=v.registerNamedCtx(s,{})),o.add(n,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=(e=this.getAttribute(y.CTX_NAME_ATTR))==null?void 0:e.trim();t&&this.style.setProperty(y.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this.initChildren=[...this.childNodes];for(let i of $t)this.addTemplateProcessor(i);this.pauseRender?this.__initCallback():this.render()}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e)},100))}static reg(e,t=!1){if(e||(St++,e=`${y.AUTO_TAG_PRFX}-${St}`),this.__tag=e,window.customElements.get(e)){console.warn(`${e} - is already in "customElements" registry`);return}window.customElements.define(e,t?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){if(t===i)return;let s=this.constructor.__attrDesc[e];s?this.__dataCtxInitialized?this.$[s]=i:this.init$[s]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[e]=JSON.parse(i)}catch{!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}bindCssData(e,t=!0){let i=(t?y.EXT_DATA_CTX_PRFX:"")+e;return this.add(i,this.getCssData(e,!0)),i}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:n=>{this[s]=n,i?window.setTimeout(()=>{t==null||t(n)}):t==null||t(n)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}},de=z;p(de,"template");var At="[Typed State] Wrong property name: ",Ui="[Typed State] Wrong property type: ",xe=class{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||F.generate(),this.__schema=Object.keys(e).reduce((i,s)=>(i[s]=e[s].value,i),{}),this.__data=v.registerNamedCtx(this.__ctxId,this.__schema)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(At+e);return}let i=this.__typedSchema[e];if((t==null?void 0:t.constructor)===i.type||i.nullable&&t===null){this.__data.pub(e,t);return}console.warn(Ui+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(At+e);return}return this.__data.read(e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){this.__data.remove()}};var Ce=class{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||F.generate(),this.__data=v.registerNamedCtx(this.__ctxId,{}),this.__watchList=e.watchList||[],this.__handler=e.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let t=Object.create(null);this.__notifyObservers=(i,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[i]||(t[i]=new Set),t[i].add(s),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(n=>{n({...t})}),t=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var e;(e=this.__handler)==null||e.call(this,[...this.__items])})}add(e){let t=new xe(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__watchList.forEach(i=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(i,()=>{this.__notifyObservers(i,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach(e=>{this.remove(e)})}observe(e){this.__observers.add(e)}unobserve(e){this.__observers.delete(e)}findItems(e){let t=[];return this.__items.forEach(i=>{let s=this.read(i);e(s)&&t.push(i)}),t}items(){return[...this.__items]}destroy(){this.__data.remove(),this.__observers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach(t=>{t.remove()}),delete this.__subsMap[e]}};var W=class{static _print(e){console.warn(e)}static setDefaultTitle(e){this.defaultTitle=e}static setRoutingMap(e){Object.assign(this.appMap,e);for(let t in this.appMap)!this.defaultRoute&&this.appMap[t].default===!0?this.defaultRoute=t:!this.errorRoute&&this.appMap[t].error===!0&&(this.errorRoute=t)}static set routingEventName(e){this.__routingEventName=e}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let e={route:null,options:{}};return window.location.search.split(this.separator).forEach(i=>{if(i.includes("?"))e.route=i.replace("?","");else if(i.includes("=")){let s=i.split("=");e.options[s[0]]=decodeURI(s[1])}else e.options[i]=!0}),e}static notify(){let e=this.readAddressBar(),t=this.appMap[e.route];if(t&&t.title&&(document.title=t.title),e.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!t&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t){this._print(`Route "${e.route}" not found...`);return}let i=new CustomEvent(W.routingEventName,{detail:{route:e.route,options:Object.assign(t||{},e.options)}});window.dispatchEvent(i)}static reflect(e,t={}){let i=this.appMap[e];if(!i){this._print("Wrong route: "+e);return}let s="?"+e;for(let o in t)t[o]===!0?s+=this.separator+o:s+=this.separator+o+`=${t[o]}`;let n=i.title||this.defaultTitle||"";window.history.pushState(null,n,s),document.title=n}static applyRoute(e,t={}){this.reflect(e,t),this.notify()}static setSeparator(e){this._separator=e}static get separator(){return this._separator||"&"}static createRouterData(e,t){this.setRoutingMap(t);let i=v.registerNamedCtx(e,{route:null,options:null,title:null});return window.addEventListener(this.routingEventName,s=>{var n;i.multiPub({route:s.detail.route,options:s.detail.options,title:((n=s.detail.options)==null?void 0:n.title)||this.defaultTitle||""})}),W.notify(),i}};W.appMap=Object.create(null);window.onpopstate=()=>{W.notify()};function Te(r,e){for(let t in e)t.includes("-")?r.style.setProperty(t,e[t]):r.style[t]=e[t]}function kt(r,e){for(let t in e)e[t].constructor===Boolean?e[t]?r.setAttribute(t,""):r.removeAttribute(t):r.setAttribute(t,e[t])}function ie(r={tag:"div"}){let e=document.createElement(r.tag);if(r.attributes&&kt(e,r.attributes),r.styles&&Te(e,r.styles),r.properties)for(let t in r.properties)e[t]=r.properties[t];return r.processors&&r.processors.forEach(t=>{t(e)}),r.children&&r.children.forEach(t=>{let i=ie(t);e.appendChild(i)}),e}function It(r,e){[...r.querySelectorAll("[l10n]")].forEach(t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let o=i.split(":");s=o[0],i=o[1]}let n="l10n:"+i;e.__l10nKeys.push(n),e.add(n,i),e.sub(n,o=>{t[s]=e.l10n(o)}),t.removeAttribute("l10n")})}var $=class extends Error{constructor(e,t,i,s,n){super();this.name="UploadClientError",this.message=e,this.code=t,this.request=i,this.response=s,this.headers=n,Object.setPrototypeOf(this,$.prototype)}},je=(r="Request canceled")=>{let e=new $(r);return e.isCancel=!0,e},Ee=(r,e)=>{r&&(r.aborted?Promise.resolve().then(e):r.addEventListener("abort",()=>e(),{once:!0}))},q=({method:r,url:e,data:t,headers:i={},signal:s,onProgress:n})=>new Promise((o,a)=>{let l=new XMLHttpRequest,c=(r==null?void 0:r.toUpperCase())||"GET",u=!1;l.open(c,e),i&&Object.entries(i).forEach(h=>{let[m,f]=h;typeof f!="undefined"&&!Array.isArray(f)&&l.setRequestHeader(m,f)}),l.responseType="text",Ee(s,()=>{u=!0,l.abort(),a(je())}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{let h={method:c,url:e,data:t,headers:i||void 0,signal:s,onProgress:n},m=l.getAllResponseHeaders().trim().split(/[\r\n]+/),f={};m.forEach(function(x){let g=x.split(": "),E=g.shift(),Q=g.join(": ");E&&typeof E!="undefined"&&(f[E]=Q)});let _=l.response,b=l.status;o({request:h,data:_,headers:f,status:b})}},l.onerror=()=>{u||a(new Error("Network error"))},n&&typeof n=="function"&&(l.upload.onprogress=h=>{h.lengthComputable?n({isComputable:!0,value:h.loaded/h.total}):n({isComputable:!1})}),t?l.send(t):l.send()});function Bi(r){return r}var Mi=Bi,Di=()=>new FormData,Fi=r=>r[0]==="file";function Xe(r){let e=Di();for(let t of r)if(Array.isArray(t[1]))t[1].forEach(i=>i&&e.append(t[0]+"[]",`${i}`));else if(Fi(t)){let i=t[2],s=Mi(t[1]);e.append(t[0],s,i)}else t[1]!=null&&e.append(t[0],`${t[1]}`);return e}var Rt=(r,e)=>typeof e!="undefined"?`${r}=${encodeURIComponent(e)}`:null,zi=r=>Object.entries(r).reduce((e,[t,i])=>e.concat(Array.isArray(i)?i.map(s=>Rt(`${t}[]`,s)):Rt(t,i)),[]).filter(e=>!!e).join("&"),se=(r,e,t)=>[r,e,t&&Object.keys(t).length>0?"?":"",t&&zi(t)].filter(Boolean).join(""),T={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,multipartMaxAttempts:3,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Vi="application/octet-stream",Lt="original",Hi="3.0.0";function re({userAgent:r,publicKey:e="",integration:t=""}={}){let i="UploadcareUploadClient",s=Hi,n="JavaScript";if(typeof r=="string")return r;if(typeof r=="function")return r({publicKey:e,libraryName:i,libraryVersion:s,languageName:n,integration:t});let o=[i,s,e].filter(Boolean).join("/"),a=[n,t].filter(Boolean).join("; ");return`${o} (${a})`}var ji=/\W|_/g;function Xi(r){return r.split(ji).map((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1)).join("")}function M(r){return!r||typeof r!="object"?r:Object.keys(r).reduce((e,t)=>(e[Xi(t)]=typeof r[t]=="object"?M(r[t]):r[t],e),{})}var Gi=r=>new Promise(e=>setTimeout(e,r)),Wi={factor:2,time:100};function Ot(r,e=Wi){let t=0;function i(s){let n=Math.round(e.time*Math.pow(e.factor,t));return s({attempt:t,retry:a=>Gi(a!=null?a:n).then(()=>(t+=1,i(s)))})}return i(r)}var qi="RequestThrottledError",Zi=15e3;function Ki(r){let{headers:e}=r||{};return e&&Number.parseInt(e["x-throttle-wait-seconds"])*1e3||Zi}function ne(r,e){return Ot(({attempt:t,retry:i})=>r().catch(s=>{if("response"in s&&(s==null?void 0:s.code)===qi&&t<e)return i(Ki(s));throw s}))}function Yi(r,{publicKey:e,fileName:t,baseURL:i=T.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c="local",integration:u,userAgent:h,retryThrottledRequestMaxTimes:m=T.retryThrottledRequestMaxTimes}){return ne(()=>{var f;return q({method:"POST",url:se(i,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":re({publicKey:e,integration:u,userAgent:h})},data:Xe([["file",r,(f=t!=null?t:r.name)!==null&&f!==void 0?f:Lt],["UPLOADCARE_PUB_KEY",e],["UPLOADCARE_STORE",typeof o=="undefined"?"auto":o?1:0],["signature",s],["expire",n],["source",c]]),signal:a,onProgress:l}).then(({data:_,headers:b,request:x})=>{let g=M(JSON.parse(_));if("error"in g)throw new $(g.error.content,g.error.errorCode,x,g,b);return g})},m)}var He;(function(r){r.Token="token",r.FileInfo="file_info"})(He||(He={}));function Ji(r,{publicKey:e,baseURL:t=T.baseURL,store:i,fileName:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:c="url",signal:u,integration:h,userAgent:m,retryThrottledRequestMaxTimes:f=T.retryThrottledRequestMaxTimes}){return ne(()=>q({method:"POST",headers:{"X-UC-User-Agent":re({publicKey:e,integration:h,userAgent:m})},url:se(t,"/from_url/",{jsonerrors:1,pub_key:e,source_url:r,store:typeof i=="undefined"?"auto":i?1:void 0,filename:s,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:c}),signal:u}).then(({data:_,headers:b,request:x})=>{let g=M(JSON.parse(_));if("error"in g)throw new $(g.error.content,g.error.errorCode,x,g,b);return g}),f)}var A;(function(r){r.Unknown="unknown",r.Waiting="waiting",r.Progress="progress",r.Error="error",r.Success="success"})(A||(A={}));var Qi=r=>"status"in r&&r.status===A.Error;function es(r,{publicKey:e,baseURL:t=T.baseURL,signal:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o=T.retryThrottledRequestMaxTimes}={}){return ne(()=>q({method:"GET",headers:e?{"X-UC-User-Agent":re({publicKey:e,integration:s,userAgent:n})}:void 0,url:se(t,"/from_url/status/",{jsonerrors:1,token:r}),signal:i}).then(({data:a,headers:l,request:c})=>{let u=M(JSON.parse(a));if("error"in u&&!Qi(u))throw new $(u.error.content,void 0,c,u,l);return u}),o)}function Pt(r,{publicKey:e,baseURL:t=T.baseURL,signal:i,source:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes}){return ne(()=>q({method:"GET",headers:{"X-UC-User-Agent":re({publicKey:e,integration:n,userAgent:o})},url:se(t,"/info/",{jsonerrors:1,pub_key:e,file_id:r,source:s}),signal:i}).then(({data:l,headers:c,request:u})=>{let h=M(JSON.parse(l));if("error"in h)throw new $(h.error.content,h.error.errorCode,u,h,c);return h}),a)}function ts(r,{publicKey:e,contentType:t,fileName:i,multipartChunkSize:s=T.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:l,signal:c,source:u="local",integration:h,userAgent:m,retryThrottledRequestMaxTimes:f=T.retryThrottledRequestMaxTimes}){return ne(()=>q({method:"POST",url:se(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":re({publicKey:e,integration:h,userAgent:m})},data:Xe([["filename",i!=null?i:Lt],["size",r],["content_type",t!=null?t:Vi],["part_size",s],["UPLOADCARE_STORE",l?"":"auto"],["UPLOADCARE_PUB_KEY",e],["signature",o],["expire",a],["source",u]]),signal:c}).then(({data:_,headers:b,request:x})=>{let g=M(JSON.parse(_));if("error"in g)throw new $(g.error.content,g.error.errorCode,x,g,b);return g.parts=Object.keys(g.parts).map(E=>g.parts[E]),g}),f)}function is(r,e,{signal:t,onProgress:i}){return q({method:"PUT",url:e,data:r,onProgress:i,signal:t}).then(s=>(i&&i({isComputable:!0,value:1}),s)).then(({status:s})=>({code:s}))}function ss(r,{publicKey:e,baseURL:t=T.baseURL,source:i="local",signal:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes}){return ne(()=>q({method:"POST",url:se(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":re({publicKey:e,integration:n,userAgent:o})},data:Xe([["uuid",r],["UPLOADCARE_PUB_KEY",e],["source",i]]),signal:s}).then(({data:l,headers:c,request:u})=>{let h=M(JSON.parse(l));if("error"in h)throw new $(h.error.content,h.error.errorCode,u,h,c);return h}),a)}var Z=class{constructor(e,{baseCDN:t,defaultEffects:i,fileName:s}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.cdnUrlModifiers=null,this.originalUrl=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null;let{uuid:n,s3Bucket:o}=e,a=o?`https://${o}.s3.amazonaws.com/${n}/${e.filename}`:`${t}/${n}/`,l=i?`-/${i}`:null,c=`${a}${l||""}`,u=n?a:null;this.uuid=n,this.name=s||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=c,this.cdnUrlModifiers=l,this.originalUrl=u,this.originalFilename=e.originalFilename,this.imageInfo=M(e.imageInfo),this.videoInfo=M(e.videoInfo)}},rs=500,Nt=({check:r,interval:e=rs,signal:t})=>new Promise((i,s)=>{let n;Ee(t,()=>{n&&clearTimeout(n),s(je("Poll cancelled"))});let o=()=>{try{Promise.resolve(r(t)).then(a=>{a?i(a):n=setTimeout(o,e)}).catch(a=>s(a))}catch(a){s(a)}};n=setTimeout(o,0)});function Ge({file:r,publicKey:e,baseURL:t,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,signal:a,onProgress:l}){return Nt({check:c=>Pt(r,{publicKey:e,baseURL:t,signal:c,source:i,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o}).then(u=>u.isReady?u:(l&&l({isComputable:!0,value:1}),!1)),signal:a})}var ns=(r,{publicKey:e,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,baseCDN:f})=>Yi(r,{publicKey:e,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m}).then(({file:_})=>Ge({file:_,publicKey:e,baseURL:i,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,onProgress:l,signal:a})).then(_=>new Z(_,{baseCDN:f})),{AbortController:os,AbortSignal:Er}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0,as=(r,{signal:e}={})=>{let t=null,i=null,s=r.map(()=>new os),n=o=>()=>{i=o,s.forEach((a,l)=>l!==o&&a.abort())};return Ee(e,()=>{s.forEach(o=>o.abort())}),Promise.all(r.map((o,a)=>{let l=n(a);return Promise.resolve().then(()=>o({stopRace:l,signal:s[a].signal})).then(c=>(l(),c)).catch(c=>(t=c,null))})).then(o=>{if(i===null)throw t;return o[i]})},ls=window.WebSocket,Ut=class{constructor(){this.events=Object.create({})}emit(e,t){var i;(i=this.events[e])===null||i===void 0||i.forEach(s=>s(t))}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){t?this.events[e]=this.events[e].filter(i=>i!==t):this.events[e]=[]}},cs=(r,e)=>Object.assign(r==="success"?{status:A.Success}:r==="progress"?{status:A.Progress}:{status:A.Error},e),Bt=class{constructor(e,t=3e4){this.ws=void 0,this.queue=[],this.isConnected=!1,this.subscribers=0,this.emmitter=new Ut,this.disconnectTimeoutId=null,this.key=e,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let e=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new ls(e),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let i=JSON.parse(t.data.toString());switch(i.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(i.channel,cs(i.event,JSON.parse(i.data)))}})}}disconnect(){let e=()=>{var t;(t=this.ws)===null||t===void 0||t.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{e()},this.disconnectTime):e()}send(e,t){var i;let s=JSON.stringify({event:e,data:t});(i=this.ws)===null||i===void 0||i.send(s)}subscribe(e,t){this.subscribers+=1,this.connect();let i=`task-status-${e}`,s={event:"pusher:subscribe",data:{channel:i}};this.emmitter.on(i,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(e){this.subscribers-=1;let t=`task-status-${e}`,i={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(i.event,i.data):this.queue=this.queue.filter(s=>s.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(e){return this.emmitter.on("error",e),()=>this.emmitter.off("error",e)}},Ve=null,We=r=>{if(!Ve){let e=typeof window=="undefined"?0:3e4;Ve=new Bt(r,e)}return Ve},hs=r=>{We(r).connect()};function ds({token:r,publicKey:e,baseURL:t,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,onProgress:o,signal:a}){return Nt({check:l=>es(r,{publicKey:e,baseURL:t,integration:i,userAgent:s,retryThrottledRequestMaxTimes:n,signal:l}).then(c=>{switch(c.status){case A.Error:return new $(c.error,c.errorCode);case A.Waiting:return!1;case A.Unknown:return new $(`Token "${r}" was not found.`);case A.Progress:return o&&(c.total==="unknown"?o({isComputable:!1}):o({isComputable:!0,value:c.done/c.total})),!1;case A.Success:return o&&o({isComputable:!0,value:c.done/c.total}),c;default:throw new Error("Unknown status")}}),signal:a})}var us=({token:r,pusherKey:e,signal:t,onProgress:i})=>new Promise((s,n)=>{let o=We(e),a=o.onError(n),l=()=>{a(),o.unsubscribe(r)};Ee(t,()=>{l(),n(je("pusher cancelled"))}),o.subscribe(r,c=>{switch(c.status){case A.Progress:{i&&(c.total==="unknown"?i({isComputable:!1}):i({isComputable:!0,value:c.done/c.total}));break}case A.Success:{l(),i&&i({isComputable:!0,value:c.done/c.total}),s(c);break}case A.Error:l(),n(new $(c.msg,c.error_code))}})}),ps=(r,{publicKey:e,fileName:t,baseURL:i,baseCDN:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:u,onProgress:h,source:m,integration:f,userAgent:_,retryThrottledRequestMaxTimes:b,pusherKey:x=T.pusherKey})=>Promise.resolve(hs(x)).then(()=>Ji(r,{publicKey:e,fileName:t,baseURL:i,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:c,signal:u,source:m,integration:f,userAgent:_,retryThrottledRequestMaxTimes:b})).catch(g=>{let E=We(x);return E==null||E.disconnect(),Promise.reject(g)}).then(g=>g.type===He.FileInfo?g:as([({signal:E})=>ds({token:g.token,publicKey:e,baseURL:i,integration:f,userAgent:_,retryThrottledRequestMaxTimes:b,onProgress:h,signal:E}),({signal:E})=>us({token:g.token,pusherKey:x,signal:E,onProgress:h})],{signal:u})).then(g=>{if(g instanceof $)throw g;return g}).then(g=>Ge({file:g.uuid,publicKey:e,baseURL:i,integration:f,userAgent:_,retryThrottledRequestMaxTimes:b,onProgress:h,signal:u})).then(g=>new Z(g,{baseCDN:s})),ms=(r,{publicKey:e,fileName:t,baseURL:i,signal:s,onProgress:n,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c,baseCDN:u})=>Pt(r,{publicKey:e,baseURL:i,signal:s,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:c}).then(h=>new Z(h,{baseCDN:u,fileName:t})).then(h=>(n&&n({isComputable:!0,value:1}),h)),qe=r=>r!==void 0&&(typeof Blob!="undefined"&&r instanceof Blob||typeof File!="undefined"&&r instanceof File||typeof Buffer!="undefined"&&r instanceof Buffer),fs=r=>{let e="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(e);return!qe(r)&&t.test(r)},gs=r=>{let e="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(e);return!qe(r)&&t.test(r)},Mt=r=>r.length||r.size,_s=(r,e=T.multipartMinFileSize)=>r>=e,bs=(r,e,t,i)=>{let s=i*e,n=Math.min(s+i,t);return r.slice(s,n)};function vs(r,e,t){return i=>bs(r,i,e,t)}var ys=(r,e)=>new Promise((t,i)=>{let s=[],n=!1,o=e.length,a=[...e],l=()=>{let c=e.length-a.length,u=a.shift();u&&u().then(h=>{n||(s[c]=h,o-=1,o?l():t(s))}).catch(h=>{n=!0,i(h)})};for(let c=0;c<r;c++)l()}),ws=(r,e,{publicKey:t,onProgress:i,signal:s,integration:n,multipartMaxAttempts:o})=>Ot(({attempt:a,retry:l})=>is(r,e,{publicKey:t,onProgress:i,signal:s,integration:n}).catch(c=>{if(a<o)return l();throw c})),xs=(r,{publicKey:e,fileName:t,fileSize:i,baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:c,source:u,integration:h,userAgent:m,retryThrottledRequestMaxTimes:f,contentType:_,multipartChunkSize:b=T.multipartChunkSize,maxConcurrentRequests:x=T.maxConcurrentRequests,multipartMaxAttempts:g=T.multipartMaxAttempts,baseCDN:E})=>{let Q=i||Mt(r),ee,Fe=(R,ve)=>{if(!c)return;ee||(ee=Array(R).fill(0));let ze=te=>te.reduce((ye,Ei)=>ye+Ei,0);return te=>{!te.isComputable||(ee[ve]=te.value,c({isComputable:!0,value:ze(ee)/R}))}};return ts(Q,{publicKey:e,contentType:_,fileName:t!=null?t:r.name,baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:l,source:u,integration:h,userAgent:m,retryThrottledRequestMaxTimes:f}).then(({uuid:R,parts:ve})=>{let ze=vs(r,Q,b);return Promise.all([R,ys(x,ve.map((te,ye)=>()=>ws(ze(ye),te,{publicKey:e,onProgress:Fe(ve.length,ye),signal:l,integration:h,multipartMaxAttempts:g})))])}).then(([R])=>ss(R,{publicKey:e,baseURL:s,source:u,integration:h,userAgent:m,retryThrottledRequestMaxTimes:f})).then(R=>R.isReady?R:Ge({file:R.uuid,publicKey:e,baseURL:s,source:u,integration:h,userAgent:m,retryThrottledRequestMaxTimes:f,onProgress:c,signal:l})).then(R=>new Z(R,{baseCDN:E}))};function Dt(r,{publicKey:e,fileName:t,baseURL:i=T.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,contentType:f,multipartChunkSize:_,multipartMaxAttempts:b,maxConcurrentRequests:x,baseCDN:g=T.baseCDN,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:Q,pusherKey:ee}){if(qe(r)){let Fe=Mt(r);return _s(Fe)?xs(r,{publicKey:e,contentType:f,multipartChunkSize:_,multipartMaxAttempts:b,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,maxConcurrentRequests:x,retryThrottledRequestMaxTimes:m,baseCDN:g}):ns(r,{publicKey:e,fileName:t,baseURL:i,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,baseCDN:g})}if(gs(r))return ps(r,{publicKey:e,fileName:t,baseURL:i,baseCDN:g,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:Q,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,pusherKey:ee});if(fs(r))return ms(r,{publicKey:e,fileName:t,baseURL:i,signal:a,onProgress:l,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:m,baseCDN:g});throw new TypeError(`File uploading from "${r}" is not supported`)}var Ft=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:$,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},transformationsUrl:{type:String,value:null},fileInfo:{type:Z,value:null},isUploading:{type:Boolean,value:!1}});var zt="active",ue="___ACTIVITY_IS_ACTIVE___",Vt="uc-",Cs="css-src",Ze=document.readyState==="complete";Ze||window.addEventListener("load",()=>{Ze=!0});var P=class extends de{l10n(e){return this.getCssData("--l10n-"+e,!0)||e}constructor(){super();this.activityType=null,this.addTemplateProcessor(It),this.__l10nKeys=[],this.__l10nUpdate=()=>{this.dropCssDataCache();for(let e of this.__l10nKeys)this.notify(e)},window.addEventListener("uc-l10n-update",this.__l10nUpdate)}applyL10nKey(e,t){this.$["l10n:"+e]=t}historyBack(){let e=this.$["*history"];e.pop();let t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e}addFiles(e){e.forEach(t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})})}connectedCallback(){let e=()=>{Ze?this.connected():window.addEventListener("load",()=>{this.connected()})},t=this.getAttribute(Cs);if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame(()=>{e()})},this.shadowRoot.appendChild(i)}else e()}__bindBasicCssData(){P._cssDataBindingsList.includes(this.ctxName)||(["pubkey","store","multiple","max-files","accept","confirm-upload"].forEach(t=>{this.bindCssData(`--cfg-${t}`)}),P._cssDataBindingsList.push(this.ctxName))}initCallback(){this.__bindBasicCssData()}connected(){this.__connectedOnce?super.connectedCallback():(P._ctxConnectionsList.includes(this.ctxName)||(this.add$({"*currentActivity":"","*currentActivityParams":{},"*history":[],"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null}),P._ctxConnectionsList.push(this.ctxName)),super.connectedCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{var s,n;let t=this.ctxName+this.activityType,i=P._activityRegistry[t];if(this.activityType!==e&&this[ue])this[ue]=!1,this.removeAttribute(zt),(s=i==null?void 0:i.deactivateCallback)==null||s.call(i);else if(this.activityType===e&&!this[ue]){this[ue]=!0,this.setAttribute(zt,""),(n=i==null?void 0:i.activateCallback)==null||n.call(i);let o=this.$["*history"];o.length>10&&(o=o.slice(o.length-11,o.length-1)),o.push(this.activityType),this.$["*history"]=o}})),this.__connectedOnce=!0)}openSystemDialog(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.$["*--cfg-multiple"],this.fileInput.max=this.$["*--cfg-max-files"],this.fileInput.accept=this.$["*--cfg-accept"],this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=P.activities.UPLOAD_LIST,this.fileInput.value="",this.fileInput=null}}get doneActivity(){return this.getAttribute("done-activity")}get cancelActivity(){return this.getAttribute("cancel-activity")}get isActivityActive(){return this[ue]}registerActivity(e,t,i){P._activityRegistry||(P._activityRegistry=Object.create(null));let s=this.ctxName+e;P._activityRegistry[s]={activateCallback:t,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get uploadCollection(){if(!this.has("*uploadCollection")){let e=new Ce({typedSchema:Ft,watchList:["uploadProgress","uuid"],handler:t=>{this.$["*uploadList"]=t}});e.observe(t=>{if(t.uploadProgress){let i=0,s=e.findItems(n=>!n.getValue("uploadError"));s.forEach(n=>{i+=e.readProp(n,"uploadProgress")}),this.$["*commonProgress"]=i/s.length}}),this.add("*uploadCollection",e)}return this.$["*uploadCollection"]}fileSizeFmt(e,t=2){let i=["B","KB","MB","GB","TB"],s=l=>this.getCssData("--l10n-unit-"+l.toLowerCase(),!0)||l;if(e===0)return`0 ${s(i[0])}`;let n=1024,o=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/n**a).toFixed(o))+" "+s(i[a])}output(){let e=[];this.uploadCollection.items().forEach(i=>{let n=v.getNamedCtx(i).store.fileInfo;e.push(n)}),this.$["*outputData"]=e}destroyCallback(){window.removeEventListener("uc-l10n-update",this.__l10nUpdate),this.__l10nKeys=null}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(Vt)?e:Vt+e)}},d=P;p(d,"_activityRegistry",Object.create(null)),p(d,"_ctxConnectionsList",[]),p(d,"_cssDataBindingsList",[]);d.activities=Object.freeze({SOURCE_SELECT:"source-select",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});d.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});d.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...d.extSrcList});var $e=class extends d{constructor(){super(...arguments);p(this,"init$",{name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)}),this.sub("path",e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path d="${e}"></path>`)}),this.sub("size",e=>{this.$.viewBox=`0 0 ${e} ${e}`})}};$e.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;$e.bindAttributes({name:"name",size:"size"});var Ke=class extends d{constructor(){super(...arguments);p(this,"init$",{"*simpleButtonText":""})}initCallback(){let e=this.bindCssData("--cfg-multiple");this.sub(e,t=>{this.$["*simpleButtonText"]=t?this.l10n("upload-files"):this.l10n("upload-file")}),this.onclick=()=>{var t;this.$["*modalActive"]=!0,(t=this.$["*uploadList"])!=null&&t.length?this.set$({"*currentActivity":d.activities.UPLOAD_LIST}):this.set$({"*currentActivity":d.activities.SOURCE_SELECT})}}};Ke.template=`<button><uc-icon name="upload"></uc-icon><span>{{*simpleButtonText}}</span><slot></slot></button>`;var Ht=class extends d{constructor(){super(...arguments);p(this,"activityType","source-select")}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({"*activityCaption":this.l10n("select-file-source"),"*activityIcon":"default"})})}};function Ts(r){return new Promise(e=>{typeof window.FileReader!="function"&&e(!1);try{let t=new FileReader;t.onerror=()=>{e(!0)};let i=s=>{s.type!=="loadend"&&t.abort(),e(!1)};t.onloadend=i,t.onprogress=i,t.readAsDataURL(r)}catch{e(!1)}})}function Es(r){return new Promise((e,t)=>{let i=0,s=[],n=a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),a.isFile?(i++,a.file(l=>{i--,s.push(l),i===0&&e(s)})):a.isDirectory&&o(a.createReader())},o=a=>{i++,a.readEntries(l=>{i--;for(let c of l)n(c);i===0&&e(s)})};n(r)})}function jt(r){let e=[],t=[];for(let i=0;i<r.items.length;i++){let s=r.items[i];if(s&&s.kind==="file"){if(typeof s.webkitGetAsEntry=="function"||typeof s.getAsEntry=="function"){let o=typeof s.webkitGetAsEntry=="function"?s.webkitGetAsEntry():s.getAsEntry();t.push(Es(o).then(a=>{e.push(...a)}));continue}let n=s.getAsFile();t.push(Ts(n).then(o=>{o||e.push(n)}))}}return Promise.all(t).then(()=>e)}var k={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Ye=["dragleave","dragexit","dragend","drop","mouseleave","mouseout"],$s=100,Je=new Map;function Ss(r,e){let t=Math.max(Math.min(r[0],e.x+e.width),e.x),i=Math.max(Math.min(r[1],e.y+e.height),e.y);return Math.sqrt((r[0]-t)*(r[0]-t)+(r[1]-i)*(r[1]-i))}function Xt(r){let e=new Set,t=l=>e.add(l),i=k.INACTIVE,s=l=>{i!==l&&e.forEach(c=>c(l)),i=l},n=l=>{let{clientX:c,clientY:u}=l,h=document.body.getBoundingClientRect(),m=l.type==="drop",f=["dragleave","dragexit","dragend"].includes(l.type)&&c===0&&u===0,_=["mouseleave","mouseout"].includes(l.type)&&(c<0||c>h.width||u<0||u>h.height);(m||f||_)&&s(k.INACTIVE),l.preventDefault()};t(l=>r.onChange(l)),t(l=>{l===k.ACTIVE&&Ye.forEach(c=>{window.addEventListener(c,n,!1)})}),t(l=>{l===k.INACTIVE&&Ye.forEach(c=>{window.removeEventListener(c,n,!1)})});let o=l=>{l.preventDefault(),i===k.INACTIVE&&s(k.ACTIVE);let c=[l.x,l.y],u=r.element.getBoundingClientRect(),h=Math.floor(Ss(c,u)),m=h<$s,f=l.composedPath().includes(r.element);Je.set(r.element,h);let _=Math.min(...Je.values())===h;s(f&&_?k.OVER:m&&_?k.NEAR:k.ACTIVE)};window.addEventListener("dragover",o,!1);let a=async l=>{l.preventDefault();let c=await jt(l.dataTransfer);r.onFiles(c),s(k.INACTIVE)};return r.element.addEventListener("drop",a),()=>{Je.delete(r.element),window.removeEventListener("dragover",o,!1),r.element.removeEventListener("drop",a),Ye.forEach(l=>{window.removeEventListener(l,n,!1)})}}var Gt=class extends d{constructor(){super(...arguments);p(this,"init$",{state:k.INACTIVE})}initCallback(){this._destroyDropzone=Xt({element:this,onChange:e=>{this.$.state=e},onFiles:e=>{e.forEach(t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})}),this.set$({"*currentActivity":d.activities.UPLOAD_LIST})}}),this.sub("state",e=>{var i;let t=(i=Object.entries(k).find(([,s])=>s===e))==null?void 0:i[0].toLowerCase();t&&this.setAttribute("drag-state",t)})}destroyCallback(){var e;(e=this._destroyDropzone)==null||e.call(this)}};var As="src-type-",Se=class extends d{constructor(){super(...arguments);p(this,"_registeredTypes",{});p(this,"init$",{iconName:"default"})}initTypes(){this.registerType({type:d.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:d.sourceTypes.URL,activity:d.activities.URL,textKey:"from-url"}),this.registerType({type:d.sourceTypes.CAMERA,activity:d.activities.CAMERA}),this.registerType({type:"draw",activity:d.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(d.extSrcList))this.registerType({type:e,activity:d.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",e=>{!e||this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){let t=this._registeredTypes[e],{textKey:i=e,icon:s=e,activity:n,onClick:o,activityParams:a={}}=t;this.applyL10nKey("src-type",`${As}${i}`),this.$.iconName=s,this.onclick=l=>{n&&this.set$({"*currentActivityParams":a,"*currentActivity":n}),o&&o(l)}}};Se.template=`<uc-icon set="@name: iconName"></uc-icon><div class="txt" l10n="src-type"></div>`;Se.bindAttributes({type:null});var Wt=class extends d{initCallback(){this.bindCssData("--cfg-source-list"),this.sub("*--cfg-source-list",e=>{if(!e)return;let t=e.split(",").map(s=>s.trim()),i="";t.forEach(s=>{i+=`<uc-source-btn type="${s}"></uc-source-btn>`}),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=i:this.outerHTML=i})}};function qt(r,e=40){let t=document.createElement("canvas"),i=t.getContext("2d"),s=new Image,n=new Promise((o,a)=>{s.onload=()=>{let l=s.height/s.width;l>1?(t.width=e,t.height=e*l):(t.height=e,t.width=e/l),i.fillStyle="rgb(240, 240, 240)",i.fillRect(0,0,t.width,t.height),i.drawImage(s,0,0,t.width,t.height),t.toBlob(c=>{let u=URL.createObjectURL(c);o(u)},"image/png")},s.onerror=l=>{console.warn("Resize error..."),a(l)}});return s.src=URL.createObjectURL(r),n}var Qe=class{constructor(){p(this,"caption","");p(this,"text","");p(this,"iconName","");p(this,"isError",!1)}},et=class extends d{constructor(){super(...arguments);p(this,"init$",{iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){this.sub("*message",e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption,msgTxt:e.text,iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};et.template=`<div class="heading"><uc-icon set="@name: iconName"></uc-icon><div class="caption">{{captionTxt}}</div><button set="onclick: onClose"><uc-icon name="close"></uc-icon></button></div><div class="msg">{{msgTxt}}</div>`;function tt(r){let e=new Blob([r],{type:"image/svg+xml"});return URL.createObjectURL(e)}function Zt(r="#fff",e="rgba(0, 0, 0, .1)"){return tt(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="20" height="20" fill="${r}" /><rect x="0" y="0" width="10" height="10" fill="${e}" /><rect x="10" y="10" width="10" height="10" fill="${e}" /></svg>`)}function Kt(r="rgba(0, 0, 0, .1)"){return tt(`<svg height="10" width="10" viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><line x1="0" y1="10" x2="10" y2="0" stroke="${r}" /></svg>`)}function Ae(r="hsl(0, 0%, 100%)",e=36,t=36){return tt(`<svg width="${e}" height="${t}" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z" fill="black" fill-opacity="0.06"/><path d="M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z" fill="black" fill-opacity="0.06"/><path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="${r}"/><path d="M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z" fill="url(#paint0_linear_2735_2136)"/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z" fill="url(#paint1_radial_2735_2136)"/><path d="M21 8L26 13V14H20V8H21Z" fill="black" fill-opacity="0.03"/><path d="M21 8L26 13V13.5H20.5V8H21Z" fill="black" fill-opacity="0.08"/><path d="M21 8L26 13H21V8Z" fill="${r}"/><path d="M21 8L26 13H21V8Z" fill="url(#paint2_linear_2735_2136)"/><path d="M21 8L26 13H21V8Z" fill="url(#paint3_linear_2735_2136)"/><path d="M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z" fill="url(#paint4_linear_2735_2136)"/><defs><linearGradient id="paint0_linear_2735_2136" x1="18" y1="8" x2="18" y2="28.0027" gradientUnits="userSpaceOnUse"><stop stop-color="white" stop-opacity="0.06"/><stop offset="1" stop-color="white" stop-opacity="0"/></linearGradient><radialGradient id="paint1_radial_2735_2136" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(10 11) rotate(53.7462) scale(18.6011 18.0323)"><stop stop-color="white" stop-opacity="0.12"/><stop offset="1" stop-color="white" stop-opacity="0"/></radialGradient><linearGradient id="paint2_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse"><stop offset="0.40625" stop-opacity="0"/><stop offset="1" stop-opacity="0.04"/></linearGradient><linearGradient id="paint3_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse"><stop stop-color="white" stop-opacity="0.16"/><stop offset="1" stop-color="white" stop-opacity="0.06"/></linearGradient><linearGradient id="paint4_linear_2735_2136" x1="21" y1="13" x2="23.5" y2="10.5" gradientUnits="userSpaceOnUse"><stop stop-color="white" stop-opacity="0.15"/><stop offset="1" stop-color="white" stop-opacity="0"/></linearGradient></defs></svg>`)}var Yt="0.0.6",Jt="@uploadcare/uc-blocks";function Qt(r){return`${r}`.replace(new RegExp(/[-_]+/,"g")," ").replace(new RegExp(/[^\w\s]/,"g"),"").replace(new RegExp(/\s+(.)(\w*)/,"g"),(e,t,i)=>`${t.toUpperCase()+i.toLowerCase()}`).replace(new RegExp(/\w/),e=>e.toUpperCase())}function ei({publicKey:r,languageName:e}){return`${Qt(Jt)}/${Yt}/${r} (${e})`}var N=class extends d{constructor(){super(...arguments);p(this,"pauseRender",!0);p(this,"init$",{itemName:"",thumb:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,notImage:!0,badgeIcon:"check","*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this.entry,"*currentActivity":d.activities.DETAILS})},onRemove:()=>{this.uploadCollection.remove(this.uid)},onUpload:()=>{this.upload()}})}_observerCallback(e){let[t]=e;t.intersectionRatio===0?(clearTimeout(this._thumbTimeoutId),this._thumbTimeoutId=void 0):this._thumbTimeoutId||(this._thumbTimeoutId=window.setTimeout(()=>this._generateThumbnail(),100))}_generateThumbnail(){var e;if(!this.$.thumbUrl)if((e=this.file)!=null&&e.type.includes("image"))qt(this.file,this.$["*--cfg-thumb-size"]||76).then(t=>{this.$.thumbUrl=`url(${t})`});else{let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");this.$.thumbUrl=`url(${Ae(t)})`}}_revokeThumbUrl(){var e;(e=this.$.thumbUrl)!=null&&e.startsWith("blob:")&&URL.revokeObjectURL(this.$.thumbUrl)}initCallback(){this.bindCssData("--cfg-thumb-size"),this.defineAccessor("entry-id",e=>{var t;!e||(this.uid=e,this.entry=(t=this.uploadCollection)==null?void 0:t.read(e),this.entry&&(this.entry.subscribe("isUploading",i=>{this.$.progressVisible=i}),this.entry.subscribe("uploadProgress",i=>{this.$.progressValue=i}),this.entry.subscribe("fileName",i=>{this.$.itemName=i||this.externalUrl||this.l10n("file-no-name")}),this.entry.subscribe("externalUrl",i=>{this.$.itemName=this.entry.getValue("fileName")||i||this.l10n("file-no-name")}),this.entry.subscribe("uuid",i=>{if(!!i&&(this._observer.unobserve(this),this.setAttribute("loaded",""),this.entry.getValue("isImage"))){let s=`https://ucarecdn.com/${i}/`;this._revokeThumbUrl();let n=this.$["*--cfg-thumb-size"]||76;this.$.thumbUrl=`url(${s}-/scale_crop/${n}x${n}/center/)`}}),this.entry.subscribe("transformationsUrl",i=>{if(!!i&&this.entry.getValue("isImage")){this._revokeThumbUrl();let s=this.$["*--cfg-thumb-size"]||76;this.$.thumbUrl=`url(${i}-/scale_crop/${s}x${s}/center/)`}}),this.file=this.entry.getValue("file"),this.externalUrl=this.entry.getValue("externalUrl"),this.$["*--cfg-confirm-upload"]||this.upload(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)))}),this.$["*uploadTrigger"]=null,N.activeInstances.add(this),this.sub("*uploadTrigger",e=>{!e||!this.isConnected||this.upload()}),this.onclick=()=>{N.activeInstances.forEach(e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")})}}destroyCallback(){N.activeInstances.delete(this),this._observer.unobserve(this),clearTimeout(this._thumbTimeoutId)}async upload(){var i;if(this.hasAttribute("loaded")||this.entry.getValue("uuid"))return;this.entry.setValue("isUploading",!0),this.entry.setValue("uploadError",null),this.removeAttribute("focused"),this.removeAttribute("error"),this.setAttribute("uploading","");let e={},t=this.$["*--cfg-store"];t!==null&&(e.store=!!t),!this.file&&this.externalUrl&&(this.$.progressUnknown=!0);try{let s=await Dt(this.file||this.externalUrl,{...e,publicKey:this.$["*--cfg-pubkey"],userAgent:ei,fileName:this.entry.getValue("fileName"),onProgress:n=>{if(n.isComputable){let o=n.value*100;this.entry.setValue("uploadProgress",o)}this.$.progressUnknown=!n.isComputable}});this.entry.setValue("isUploading",!1),this.setAttribute("loaded",""),this.removeAttribute("uploading"),this.$.badgeIcon="badge-success",this.entry.setMultipleValues({fileInfo:s,uploadProgress:100,fileName:s.name,fileSize:s.size,isImage:s.isImage,mimeType:s.mimeType,uuid:s.uuid})}catch(s){this.entry.setValue("isUploading",!1),this.$.progressValue=0,this.setAttribute("error",""),this.removeAttribute("uploading");let n=new Qe;n.caption=this.l10n("upload-error")+": "+(((i=this.file)==null?void 0:i.name)||this.externalUrl),n.text=s,n.isError=!0,this.set$({badgeIcon:"badge-error","*message":n}),this.entry.setValue("uploadProgress",0),this.entry.setValue("uploadError",s)}}};N.template=`<div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><uc-icon set="@name: badgeIcon"></uc-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span></div><button class="edit-btn" set="onclick: onEdit;"><uc-icon name="edit-file"></uc-icon></button><button class="remove-btn" set="onclick: onRemove;"><uc-icon name="remove-file"></uc-icon></button><button class="upload-btn" set="onclick: onUpload;"><uc-icon name="upload"></uc-icon></button><uc-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible; unknown: progressUnknown"></uc-progress-bar>`;N.activeInstances=new Set;N.bindAttributes({"entry-id":null});var it=class extends d{constructor(){super(...arguments);p(this,"init$",{"*modalActive":!1,"*modalHeaderHidden":!1,closeClicked:()=>{this.set$({"*modalActive":!1,"*currentActivity":""})}})}initCallback(){this.sub("*modalActive",e=>{e?this.setAttribute("active",""):this.removeAttribute("active"),e&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null}),this.getCssData("--cfg-modal-backdrop-strokes")&&(this.style.backgroundImage=`url(${Kt()})`)}};it.template=`<div class="dialog"><div class="heading" set="@hidden: *modalHeaderHidden"><slot name="heading"></slot><button class="close-btn" set="onclick: closeClicked"><uc-icon name="close"></uc-icon></button></div><div class="content"><slot></slot></div></div>`;var ke=class{constructor(){p(this,"captionL10nStr","confirm-your-action");p(this,"messageL10Str","are-you-sure");p(this,"confirmL10nStr","yes");p(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},st=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.CONFIRMATION);p(this,"_defaults",new ke);p(this,"init$",{messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",e=>{!e||this.set$({"*modalHeaderHidden":!0,"*currentActivity":d.activities.CONFIRMATION,"*activityCaption":this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{this.$["*modalHeaderHidden"]=!1,e.denyAction()},onConfirm:()=>{this.$["*modalHeaderHidden"]=!1,e.confirmAction()}})})}};st.template=`<div class="message">{{messageTxt}}</div><div class="toolbar"><button class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button><button class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button></div>`;var rt=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.UPLOAD_LIST);p(this,"init$",{doneBtnHidden:!0,uploadBtnHidden:!1,uploadBtnDisabled:!1,hasFiles:!1,moreBtnDisabled:!0,onAdd:()=>{this.$["*currentActivity"]=d.activities.SOURCE_SELECT},onUpload:()=>{this.set$({uploadBtnHidden:!1,doneBtnHidden:!0,uploadBtnDisabled:!0,"*uploadTrigger":{}})},onDone:()=>{this.set$({"*currentActivity":this.doneActivity||"","*modalActive":!1}),this.output()},onCancel:()=>{let e=new ke;e.confirmAction=()=>{this.set$({"*currentActivity":this.cancelActivity||"","*modalActive":!1}),this.uploadCollection.clearAll(),this.output()},e.denyAction=()=>{this.historyBack()},this.$["*confirmation"]=e}});p(this,"_renderMap",Object.create(null))}updateButtonsState(){let e=this.uploadCollection.items(),t={total:e.length,uploaded:0,uploading:0};for(let s of e){let n=this.uploadCollection.read(s);n.getValue("uuid")?t.uploaded+=1:n.getValue("isUploading")&&(t.uploading+=1)}let i=t.total===t.uploaded;this.set$({uploadBtnHidden:i,doneBtnHidden:!i,uploadBtnDisabled:t.uploading>0}),!this.$["*--cfg-confirm-upload"]&&i&&this.$.onDone()}initCallback(){this.bindCssData("--cfg-show-empty-list"),this.registerActivity(this.activityType,()=>{this.set$({"*activityCaption":this.l10n("selected"),"*activityIcon":"local"})}),this.sub("*--cfg-multiple",e=>{this.$.moreBtnDisabled=!e}),this.uploadCollection.observe(()=>{this.updateButtonsState()}),this.sub("*uploadList",e=>{if(e&&e.length===0&&!this.$["*--cfg-show-empty-list"]){this.$["*currentActivity"]=d.activities.SOURCE_SELECT;return}this.updateButtonsState(),this.set$({hasFiles:e.length>0}),e.forEach(i=>{if(!this._renderMap[i]){let s=new N;this._renderMap[i]=s}});for(let i in this._renderMap)e.includes(i)||(this._renderMap[i].remove(),delete this._renderMap[i]);let t=document.createDocumentFragment();Object.values(this._renderMap).forEach(i=>t.appendChild(i)),this.ref.files.replaceChildren(t),Object.entries(this._renderMap).forEach(([i,s])=>{setTimeout(()=>{s["entry-id"]=i,s.render()})})})}};rt.template=`<div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" ref="files"></div><div class="toolbar"><button class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div></div><button class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: moreBtnDisabled" l10n="add-more"></button><button class="upload-btn primary-btn" set="@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled" l10n="upload"></button><button class="done-btn primary-btn" set="@hidden: doneBtnHidden; onclick: onDone" l10n="done"></button></div>`;var nt=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.URL);p(this,"init$",{importDisabled:!0,onUpload:()=>{let e=this.ref.input.value;this.uploadCollection.add({externalUrl:e}),this.$["*currentActivity"]=d.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":d.activities.SOURCE_SELECT})},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}})}initCallback(){this.registerActivity(this.activityType,()=>{this.set$({"*activityCaption":this.l10n("caption-from-url"),"*activityIcon":"url"})})}};nt.template=`<input placeholder="https://..." .url-input type="text" ref="input" set="oninput: onInput"/><button class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled"></button><button class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>`;var ot=()=>typeof navigator.permissions!="undefined";function ti(r,e){let t,i=(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)};return i.cancel=()=>{clearTimeout(t)},i}var at=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.CAMERA);p(this,"_unsubPermissions",null);p(this,"init$",{video:null,videoTransformCss:null,shotBtnDisabled:!1,videoHidden:!1,messageHidden:!0,requestBtnHidden:ot(),l10nMessage:null,onCancel:()=>{this.set$({"*currentActivity":d.activities.SOURCE_SELECT})},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});p(this,"_onActivate",()=>{this.set$({"*activityCaption":this.l10n("caption-camera"),"*activityIcon":"camera"}),ot()&&this._subscribePermissions(),this._capture()});p(this,"_onDeactivate",()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()});p(this,"_handlePermissionsChange",()=>{this._capture()});p(this,"_setPermissionsState",ti(e=>{e==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):e==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch{this._setPermissionsState("denied")}}_stopCapture(){var e;this._capturing&&((e=this.$.video)==null||e.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob(i=>{let s=new File([i],t,{lastModified:e,type:"image/png"});this.uploadCollection.add({file:s,fileName:t,fileSize:s.size,isImage:!0,mimeType:s.type}),this.set$({"*currentActivity":d.activities.UPLOAD_LIST})})}initCallback(){this.registerActivity(this.activityType,this._onActivate,this._onDeactivate);let e=this.bindCssData("--cfg-camera-mirror");this.sub(e,t=>{!this.isActivityActive||(this.$.videoTransformCss=t?"scaleX(-1)":null)})}};at.template=`<div class="content"><video autoplay playsinline set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden" ref="video"></video><div class="message-box" set="@hidden: messageHidden"><span>{{l10nMessage}}</span><button set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request"></button></div></div><div class="toolbar"><button class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><button class="shot-btn primary-btn" set="onclick: onShot; @disabled: shotBtnDisabled" l10n="camera-shot"></button></div>`;var lt=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.DETAILS);p(this,"init$",{checkerboard:!1,localImageEditDisabled:!0,cloudImageEditDisabled:!0,fileSize:null,fileName:"",notUploaded:!0,imageUrl:"",errorTxt:"",editBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=d.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),t=Ae(e,108,108);this.eCanvas.setImageUrl(t),this.set$({checkerboard:!1})}initCallback(){this.bindCssData("--cfg-use-local-image-editor"),this.sub("*--cfg-use-local-image-editor",e=>{this.$.localImageEditDisabled=!e}),this.bindCssData("--cfg-use-cloud-image-editor"),this.sub("*--cfg-use-cloud-image-editor",e=>{this.$.cloudImageEditDisabled=!e}),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,()=>{this.set$({"*activityCaption":this.l10n("caption-edit-file")})}),this.eCanvas=this.ref.canvas,this.sub("*focusedEntry",e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach(s=>{this._entrySubs.delete(s),s.remove()}):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(this.eCanvas.clear(),t){this._file=t;let s=this._file.type.includes("image");s&&!e.getValue("transformationsUrl")&&(this.eCanvas.setImageFile(this._file),this.set$({checkerboard:!0,editBtnHidden:!this.$["*--cfg-use-local-image-editor"]&&!this.$["*--cfg-use-cloud-image-editor"]})),s||this.showNonImageThumb()}let i=(s,n)=>{this._entrySubs.add(this.entry.subscribe(s,n))};i("fileName",s=>{this.$.fileName=s,this.$.onNameInput=()=>{let n=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:n}),this.entry.setValue("fileName",n)}}),i("fileSize",s=>{this.$.fileSize=Number.isFinite(s)?this.fileSizeFmt(s):this.l10n("file-size-unknown")}),i("uuid",s=>{s&&!e.getValue("transformationsUrl")?(this.eCanvas.clear(),this.set$({imageUrl:`https://ucarecdn.com/${s}/`,notUploaded:!1}),this.eCanvas.setImageUrl(this.$.imageUrl)):this.$.imageUrl="Not uploaded yet..."}),i("uploadError",s=>{this.$.errorTxt=s==null?void 0:s.message}),i("externalUrl",s=>{!s||this.entry.getValue("uuid")||this.showNonImageThumb()}),i("transformationsUrl",s=>{!s||this.entry.getValue("isImage")&&this.eCanvas.setImageUrl(s)})})}};lt.template=`<uc-tabs tab-list="tab-view, tab-details"><div tab-ctx="tab-details" class="details"><div class="info-block"><div class="info-block_name" l10n="file-name"></div><input name="name-input" ref="file_name_input" set="value: fileName; oninput: onNameInput" type="text" /></div><div class="info-block"><div class="info-block_name" l10n="file-size"></div><div>{{fileSize}}</div></div><div class="info-block"><div class="info-block_name" l10n="cdn-url"></div><a target="_blank" set="@href: imageUrl; @disabled: notUploaded">{{imageUrl}}</a></div><div>{{errorTxt}}</div></div><uc-editable-canvas tab-ctx="tab-view" set="@disabled: localImageEditDisabled; @checkerboard: checkerboard;" ref="canvas"></uc-editable-canvas></uc-tabs><div class="toolbar" set="@edit-disabled: editBtnHidden"><button class="edit-btn secondary-btn" set="onclick: onEdit; @hidden: editBtnHidden;"><uc-icon name="edit"></uc-icon><span l10n="edit-image"></span></button><button class="remove-btn secondary-btn" set="onclick: onRemove"><uc-icon name="remove"></uc-icon><span l10n="remove-from-list"></span></button><div></div><button class="back-btn primary-btn" set="onclick: onBack"><span l10n="done"></span></button></div>`;var ct=class extends d{constructor(){super(...arguments);p(this,"init$",{visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){this.uploadCollection.observe(()=>{let e=this.uploadCollection.items().some(t=>this.uploadCollection.read(t).getValue("isUploading"));this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}};ct.template=`<uc-progress-bar set="visible: visible; unknown: unknown; value: value"></uc-progress-bar>`;var ht=class extends d{constructor(){super(...arguments);p(this,"_value",0);p(this,"_unknownMode",!1);p(this,"init$",{width:0,opacity:0})}initCallback(){this.defineAccessor("value",e=>{e!==void 0&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",e=>{this.ref.line.classList.toggle("progress--hidden",!e)}),this.defineAccessor("unknown",e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)})}};ht.template=`<div ref="line" class="progress"></div>`;var Ie=class extends d{constructor(){super();p(this,"init$",{refMap:null,disabled:!0,toolbarHidden:!0,checkerboard:!1});Te(this,{display:"flex",justifyContent:"center",alignItems:"center"})}initCallback(){this.sub("disabled",()=>{this.$.toolbarHidden=this.hasAttribute("disabled")&&this.getAttribute("disabled")!=="false"}),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${Zt()})`:"unset"}),this.canvas=this.ref.cvs,this.canvCtx=this.canvas.getContext("2d"),this.$.refMap={parent:this,canvas:this.canvas,canvCtx:this.canvCtx,svg:this.ref.svg,svgGroup:this.ref.svg_g,svgImg:this.ref.svg_img}}setImage(e){e.height&&e.width?(this.canvas.height=e.height,this.canvas.width=e.width,this.canvCtx.drawImage(e,0,0,e.width,e.height)):(this.clear(),e.onload=()=>{this.canvas.height=e.height,this.canvas.width=e.width,this.canvCtx.drawImage(e,0,0,e.width,e.height)})}setImageFile(e){let t=new Image,i=URL.createObjectURL(e);t.src=i,this.setImage(t)}setImageUrl(e){let t=new Image;t.src=e,this.setImage(t)}clear(){this.canvCtx.clearRect(0,0,this.canvas.width,this.canvas.height)}};Ie.template=`<canvas class="img-view" ref="cvs"></canvas><svg class="img-view" xmlns="http://www.w3.org/2000/svg" ref="svg"><g ref="svg_g"><image ref="svg_img" x="0" y="0"></image></g></svg><editable-canvas-toolbar set="refMap: refMap; @hidden: toolbarHidden"></editable-canvas-toolbar>`;Ie.bindAttributes({disabled:"disabled",checkerboard:"checkerboard"});function ii(...r){return r.reduce((e,t)=>{if(typeof t=="string")return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}function w(...r){let e=ii(...r);return Object.keys(e).reduce((t,i)=>(e[i]&&t.push(i),t),[]).join(" ")}function si(r,...e){let t=ii(...e);for(let i of Object.keys(t))r.classList.toggle(i,t[i])}function D(r,e){let t,i=(...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),e)};return i.cancel=()=>{clearTimeout(t)},i}var V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function K(r){let e=new Image;return{promise:new Promise((s,n)=>{e.src=r,e.onload=s,e.onerror=n}),image:e,cancel:()=>{e.naturalWidth===0&&(e.src=V)}}}function pe(r){let e=[];for(let n of r){let o=K(n);e.push(o)}let t=e.map(n=>n.image);return{promise:Promise.allSettled(e.map(n=>n.promise)),images:t,cancel:()=>{e.forEach(n=>{n.cancel()})}}}var I={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function ks(r,e){if(typeof e=="number")return I[r]!==e?`${r}/${e}`:"";if(typeof e=="boolean")return e&&I[r]!==e?`${r}`:"";if(r==="filter"){if(!e||I[r]===e.amount)return"";let{name:t,amount:i}=e;return`${r}/${t}/${i}`}if(r==="crop"){if(!e)return"";let{dimensions:t,coords:i}=e;return`${r}/${t.join("x")}/${i.join(",")}`}return""}function ri(...r){return r.join("/-/").replace(/\/\//g,"/")}var Is=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function oe(r){return ri(...Is.filter(e=>typeof r[e]!="undefined"&&r[e]!==null).map(e=>{let t=r[e];return ks(e,t)}).filter(e=>e&&e.length>0))}function ae(r,...e){return r.replace(/\/$/g,"")+"/-/"+ri(...e.filter(t=>t&&t.length>0))+"/"}var Re=["format/auto","progressive/yes"].join("/-/");function ni(r){return{"*originalUrl":null,"*tabId":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*modalEl":r,"*networkProblems":!1,"*imageSize":null,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:V,fileType:"",showLoader:!1,uuid:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=r.shadowRoot.querySelectorAll("img");for(let t of e){let i=t.src;t.src=V,t.src=i}r.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let t=ae(r.$["*originalUrl"],oe(e),"preview");r.dispatchEvent(new CustomEvent("apply",{detail:{originalUrl:r.$["*originalUrl"],transformationsUrl:t,transformations:e}})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel"))}}}var oi=`<div class="wrapper wrapper_desktop"><uc-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><uc-icon size="20" name="sad"></uc-icon></div><div class="network_problems_text"> Network error </div></div><div class="network_problems_footer"><uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui></div></uc-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img class="image image_visible_from_editor" ref="img-el"><uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper><uc-editor-image-fader ref="fader-el"></uc-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui><div class="toolbar_content toolbar_content__editor"><uc-editor-toolbar></uc-editor-toolbar></div></div></div>`;var C={CROP:"crop",SLIDERS:"sliders",FILTERS:"filters"},Le=[C.CROP,C.SLIDERS,C.FILTERS],ai=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],li=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],ci=["rotate","mirror","flip"],H={brightness:{zero:I.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:I.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:I.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:I.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:I.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:I.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:I.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:I.enhance,range:[0,100],keypointsNumber:1},filter:{zero:I.filter,range:[0,100],keypointsNumber:1}};function j(r,e,t){let s=window.devicePixelRatio,n=Math.min(Math.ceil(e*s),3e3),o=s>=2?"lightest":"normal";return ae(r,Re,oe(t),`quality/${o}`,`stretch/off/-/resize/${n}x`)}var le=class extends d{constructor(){super(...arguments);p(this,"init$",ni(this));p(this,"_debouncedShowLoader",D(this._showLoader.bind(this),300))}_showLoader(e){this.$.showLoader=e}_loadImageFromCdn(){this._debouncedShowLoader(!0);let e=this._imageSrc(),{promise:t,cancel:i}=K(e);t.then(()=>{this.$.src=e}).catch(s=>{this.$["*networkProblems"]=!0,this._debouncedShowLoader(!1),this.$.src=e}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=i}_imageSrc(){let{width:e}=this.ref["img-container-el"].getBoundingClientRect();return j(this.$["*originalUrl"],e,{})}initCallback(){super.initCallback(),this.$["*originalUrl"]=`https://ucarecdn.com/${this.$.uuid}/`,fetch(`${this.$["*originalUrl"]}-/json/`).then(e=>e.json()).then(({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}}),this._loadImageFromCdn(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.ref["img-el"].addEventListener("load",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==V&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||V)}),this.sub("*tabId",e=>{this.ref["img-el"].className=w("image",{image_hidden_to_cropper:e===C.CROP,image_hidden_effects:e!==C.CROP})})}disconnectedCallback(){super.disconnectedCallback()}};le.template=oi;le.bindAttributes({uuid:"uuid"});var me=33.333333333333336,L=24*2+34;function Y(r,e){for(let t in e)r.setAttributeNS(null,t,e[t].toString())}function O(r,e={}){let t=document.createElementNS("http://www.w3.org/2000/svg",r);return Y(t,e),t}function hi(r,e){let{x:t,y:i,width:s,height:n}=r,o=e.includes("w")?0:1,a=e.includes("n")?0:1,l=[-1,1][o],c=[-1,1][a],u=[t+o*s+1.5*l,i+a*n+1.5*c-24*c],h=[t+o*s+1.5*l,i+a*n+1.5*c],m=[t+o*s-24*l+1.5*l,i+a*n+1.5*c];return{d:`M ${u[0]} ${u[1]} L ${h[0]} ${h[1]} L ${m[0]} ${m[1]}`,center:h}}function di(r,e){let{x:t,y:i,width:s,height:n}=r,o=["n","s"].includes(e)?.5:{w:0,e:1}[e],a=["w","e"].includes(e)?.5:{n:0,s:1}[e],l=[-1,1][o],c=[-1,1][a],u,h;["n","s"].includes(e)?(u=[t+o*s-34/2,i+a*n+1.5*c],h=[t+o*s+34/2,i+a*n+1.5*c]):(u=[t+o*s+1.5*l,i+a*n-34/2],h=[t+o*s+1.5*l,i+a*n+34/2]);let m=`M ${u[0]} ${u[1]} L ${h[0]} ${h[1]}`,f=[h[0]-(h[0]-u[0])/2,h[1]-(h[1]-u[1])/2];return{d:m,center:f}}function ui(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}function pi(r,[e,t]){return{...r,x:r.x+e,y:r.y+t}}function Oe(r,e){let{x:t}=r,{y:i}=r;return r.x<e.x?t=e.x:r.x+r.width>e.x+e.width&&(t=e.x+e.width-r.width),r.y<e.y?i=e.y:r.y+r.height>e.y+e.height&&(i=e.y+e.height-r.height),{...r,x:t,y:i}}function mi(r,[e,t],i){let{x:s,y:n,width:o,height:a}=r;return i.includes("n")&&(n+=t,a-=t),i.includes("s")&&(a+=t),i.includes("w")&&(s+=e,o-=e),i.includes("e")&&(o+=e),{x:s,y:n,width:o,height:a}}function fi(r,e){let t=Math.max(r.x,e.x),i=Math.min(r.x+r.width,e.x+e.width),s=Math.max(r.y,e.y),n=Math.min(r.y+r.height,e.y+e.height);return{x:t,y:s,width:i-t,height:n-s}}function Pe(r,[e,t],i){let{x:s,y:n,width:o,height:a}=r;if(i.includes("n")){let l=a;a=Math.max(t,a),n=n+l-a}if(i.includes("s")&&(a=Math.max(t,a)),i.includes("w")){let l=o;o=Math.max(e,o),s=s+l-o}return i.includes("e")&&(o=Math.max(e,o)),{x:s,y:n,width:o,height:a}}function gi(r,[e,t]){return r.x<=e&&e<=r.x+r.width&&r.y<=t&&t<=r.y+r.height}var pt=class extends d{constructor(){super();p(this,"init$",{dragging:!1});this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=L&&t.width<=L)return!0;let i=t.height<=L&&(e.includes("n")||e.includes("s")),s=t.width<=L&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e,o=this.ref["svg-el"],a=O("mask",{id:"backdrop-mask"}),l=O("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),c=O("rect",{x:t,y:i,width:s,height:n,fill:"black"});a.appendChild(l),a.appendChild(c);let u=O("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});o.appendChild(u),o.appendChild(a),this._backdropMask=a,this._backdropMaskInner=c}_resizeBackdrop(){!this._backdropMask||(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask.style.display="block"}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:n}=e;Y(this._backdropMaskInner,{x:t,y:i,width:s,height:n})}_updateFrame(){let e=this.$["*cropBox"];if(!e)return;for(let i of Object.values(this._frameThumbs)){let{direction:s,pathNode:n,interactionNode:o,groupNode:a}=i,l=s==="",c=s.length===2;if(l){let{x:h,y:m,width:f,height:_}=e,b=[h+f/2,m+_/2];Y(o,{r:Math.min(f,_)/3,cx:b[0],cy:b[1]})}else{let{d:h,center:m}=c?hi(e,s):di(e,s);Y(o,{cx:m[0],cy:m[1]}),Y(n,{d:h})}let u=this._shouldThumbBeDisabled(s);a.setAttribute("class",w("thumb",{"thumb--hidden":u,"thumb--visible":!u}))}let t=this._frameGuides;Y(t,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,n=O("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let o=O("circle",{r:24+1.5,fill:"transparent"}),a=O("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(a),n.appendChild(o),e[s]={direction:s,pathNode:a,interactionNode:o,groupNode:n},o.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=O("svg"),t=O("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let i=1;i<=2;i++){let s=O("line",{x1:`${me*i}%`,y1:"0%",x2:`${me*i}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}for(let i=1;i<=2;i++){let s=O("line",{x1:"0%",y1:`${me*i}%`,x2:"100%",y2:`${me*i}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:n}of Object.values(s))t.appendChild(n);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:n,y:o}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-n,l=t.y-o;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,l],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),n=e.x-i,o=e.y-s,a=n-this._dragStartPoint[0],l=o-this._dragStartPoint[1],{direction:c}=this._draggingThumb,u=this.$["*imageBox"],h=this._dragStartCrop;c===""?(h=pi(h,[a,l]),h=Oe(h,u)):(h=mi(h,[a,l],c),h=fi(h,u));let m=[Math.min(u.width,L),Math.min(u.height,L)];if(h=Pe(h,m,c),!Object.values(h).every(f=>Number.isFinite(f)&&f>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:h});return}this.$["*cropBox"]=h}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find(i=>{if(this._shouldThumbBeDisabled(i.direction))return!1;let n=i.groupNode.getBoundingClientRect(),o={x:n.x,y:n.y,width:n.width,height:n.height};return gi(o,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?ui(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",w("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{!e||(this._guidesHidden=e.height<=L||e.width<=L,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides.setAttribute("class",w({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};pt.template=`<svg class='svg' ref='svg-el'xmlns="http://www.w3.org/2000/svg"></svg>`;var X=class extends d{constructor(){super(...arguments);p(this,"init$",{active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=w({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}};X.template=`<div class="before"></div><uc-icon size="20" set="@name: icon;"></uc-icon><div class="title" ref="title-el">{{title}}</div>`;function Ls(r){let e=r+90;return e=e>=360?0:e,e}function Os(r,e){return r==="rotate"?Ls(e):["mirror","flip"].includes(r)?!e:null}var fe=class extends X{initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{!e||(this._operation=e,this.$.icon=e)}),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=Os(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}};var ge={FILTER:"filter",COLOR_OPERATION:"color_operation"},B="original",mt=class extends d{constructor(){super(...arguments);p(this,"init$",{disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?ge.FILTER:ge.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===B?void 0:this.$.value,filter:this._filter===B?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=H[this._operation],[i,s]=e;this.$.min=i,this.$.max=s,this.$.zero=t;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===ge.FILTER){let o=s;if(n){let{name:a,amount:l}=n;o=a===this._filter?l:s}this.$.value=o,this.$.defaultValue=o}if(this._controlType===ge.COLOR_OPERATION){let o=typeof n!="undefined"?n:t;this.$.value=o,this.$.defaultValue=o}}apply(){let e;this._controlType===ge.FILTER?this._filter===B?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}connectedCallback(){super.connectedCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}};mt.template=`<uc-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"></uc-slider-ui>`;var ce=class extends X{constructor(){super(...arguments);p(this,"init$",{active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s=t>=2?"lightest":"normal",n=100,o={...this.$["*editorTransformations"]};return o[this._operation]=this._filter!==B?{name:this._filter,amount:n}:void 0,ae(this._originalUrl,Re,oe(o),`quality/${s}`,`scale_crop/${i}x${i}/center`)}_observerCallback(e,t){if(e[0].isIntersecting){let s=this._previewSrc(),n=this.ref["preview-el"],{promise:o,cancel:a}=K(s);this._cancelPreload=a,o.catch(l=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:l})}).finally(()=>{n.style.backgroundImage=`url(${s})`,setTimeout(()=>{n.style.opacity="1"}),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===B,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let i=this.ref["icon-el"];i.style.opacity=t?"1":"0";let s=this.ref["preview-el"];t?s.style.opacity="0":s.style.backgroundImage&&(s.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let i=this._previewSrc(),s=this.ref["preview-el"];s.style.backgroundImage&&(s.style.backgroundImage="none",s.style.backgroundImage=`url(${i})`)}})}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0,this._cancelPreload&&this._cancelPreload()}};ce.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><uc-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>`;var _e=class extends X{constructor(){super(...arguments);p(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=H[this._operation],i=e[this._operation],s=typeof i!="undefined"?i!==t:!1;this.$.active=s})}};function _i(r,e){let t={};for(let i of e){let s=r[i];(r.hasOwnProperty(i)||s!==void 0)&&(t[i]=s)}return t}var Ne=window.ResizeObserver||class{constructor(e){this._callback=e}_flush(e){let t=e.getBoundingClientRect();JSON.stringify(t)!==JSON.stringify(this._lastRect)&&this._callback([{borderBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentRect:t,target:e}]),this._lastRect=t}observe(e){this.unobserve(),this._observeInterval=window.setInterval(()=>this._flush(e),500),this._flush(e)}unobserve(e){this._observeInterval&&window.clearInterval(this._observeInterval)}};function Ue(r,e,t){return Math.min(Math.max(r,e),t)}function be({width:r,height:e},t){let i=t/90%2!==0;return{width:i?e:r,height:i?r:e}}function Ns(r){return r?[({dimensions:t,coords:i})=>[...t,...i].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:t,coords:i})=>t.every(s=>s>0)&&i.every(s=>s>=0)].every(t=>t(r)):!0}var ft=class extends d{constructor(){super();p(this,"init$",{image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}});this._commitDebounced=D(this._commit.bind(this),300),this._handleResizeDebounced=D(this._handleResize.bind(this),10)}_handleResize(){this._initCanvas(),this._alignImage(),this._alignCrop(),this._draw()}_syncTransformations(){let e=this.$["*editorTransformations"],t=_i(e,Object.keys(this.$["*operations"])),i={...this.$["*operations"],...t};this.$["*operations"]=i}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*n,e.height=s*n,t.scale(n,n),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,n={width:this.offsetWidth,height:this.offsetHeight},o=be({width:e.naturalWidth,height:e.naturalHeight},s);if(o.width>n.width-t*2||o.height>n.height-t*2){let a=o.width/o.height,l=n.width/n.height;if(a>l){let c=n.width-t*2,u=c/a,h=0+t,m=t+(n.height-t*2)/2-u/2;this.$["*imageBox"]={x:h,y:m,width:c,height:u}}else{let c=n.height-t*2,u=c*a,h=t+(n.width-t*2)/2-u/2,m=0+t;this.$["*imageBox"]={x:h,y:m,width:u,height:c}}}else{let{width:a,height:l}=o,c=t+(n.width-t*2)/2-a/2,u=t+(n.height-t*2)/2-l/2;this.$["*imageBox"]={x:c,y:u,width:a,height:l}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,n=this.$["*editorTransformations"].crop;if(n){let{dimensions:[a,l],coords:[c,u]}=n,{width:h,x:m,y:f}=this.$["*imageBox"],{width:_}=be(this._imageSize,s),b=h/_;e={x:m+c*b,y:f+u*b,width:a*b,height:l*b}}else e={x:t.x,y:t.y,width:t.width,height:t.height};let o=[Math.min(t.width,L),Math.min(t.height,L)];e=Pe(e,o,"se"),e=Oe(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:n,rotate:o}=i,a=this._ctx,l=be({width:t.width,height:t.height},o);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(o*Math.PI*-1/180),a.scale(s?-1:1,n?-1:1),a.drawImage(e,-l.width/2,-l.height/2,l.width,l.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._alignTransition(),setTimeout(()=>{this.className=w({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1,inactive_instant:!1})}))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:o}=t,{width:a,height:l}=be(this._imageSize,s),{width:c,height:u}=e,h=n/a,m=o/l;return[Ue(Math.round(c/h),1,a),Ue(Math.round(u/m),1,l)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:n,height:o,x:a,y:l}=t,{width:c,height:u}=be(this._imageSize,s),{x:h,y:m}=e,f=n/c,_=o/u,b=this._calculateDimensions(),x={dimensions:b,coords:[Ue(Math.round((h-a)/f),0,c-b[0]),Ue(Math.round((m-l)/_),0,u-b[1])]};if(!Ns(x)){console.error("Cropper is trying to create invalid crop object",{payload:x});return}if(!(b[0]===c&&b[1]===u))return x}_commit(){let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,n=this._calculateCrop(),a={...this.$["*editorTransformations"],crop:n,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=a}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(i){console.error("Failed to activate cropper",{error:i})}}}deactivate({seamlessTransition:e=!1}={}){!this._isActive||(this._commit(),this._isActive=!1,e&&this._alignTransition(),this.className=w({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:e,inactive_instant:!e}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_alignTransition(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth-this.$["*padding"]*2,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight-this.$["*padding"]*2,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,o=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-n)/s}px, ${(this.offsetHeight/2-o)/s}px)`,this.style.transformOrigin=`${n}px ${o}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=j(e,i,t),{promise:n,cancel:o,image:a}=K(s),l=this._handleImageLoading(s);return a.addEventListener("load",l,{once:!0}),a.addEventListener("error",l,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=o,n.then(()=>a).catch(c=>(console.error("Failed to load image",{error:c}),this.$["*networProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new Ne(()=>{this._isActive&&this.$.image&&this._handleResizeDebounced()}),this._observer.observe(this),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",e=>{this.$.image&&this._commitDebounced()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0}};ft.template=`<canvas class='canvas' ref='canvas-el'></canvas><uc-crop-frame ref='frame-el'></uc-crop-frame>`;function gt(r,e,t){let i=Array(t);t--;for(let s=t;s>=0;s--)i[s]=Math.ceil((s*e+(t-s)*r)/t);return i}function Us(r){return r.reduce((e,t,i)=>i<r.length-1?[...e,[t,r[i+1]]]:e,[])}function Bs(r,e,t){let i=Us(r).find(([s,n])=>s<=e&&e<=n);return r.map(s=>{let n=Math.abs(i[0]-i[1]),o=Math.abs(e-i[0])/n;return i[0]===s?e>t?1:1-o:i[1]===s?e>=t?o:1:0})}function Ms(r,e){return r.map((t,i)=>t<e?r.length-i:i)}function bi(r,e){let t=H[r].keypointsNumber,{range:i,zero:s}=H[r];return[...new Set([...gt(i[0],s,t+1),...gt(s,i[1],t+1),s,e])].sort((n,o)=>n-o)}var vi=class extends d{constructor(){super();this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=D(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let n={...this._transformations};i&&(n[i]=t?{name:t,amount:s}:s);let o=this.offsetWidth;return j(e,o,n)}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(l=>l.value===i);if(s())return;let n=this._constructKeypoint(e,i),o=new Image;o.src=n.src;let a=this._handleImageLoading(n.src);o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),n.image=o,o.classList.add("fader-image"),o.addEventListener("load",()=>{if(s())return;let l=this._keypoints,c=l.findIndex(h=>h.value>i),u=c<l.length?l[c].image:null;!this._container||u&&!this._container.contains(u)||(l.splice(c,0,n),this._container.insertBefore(o,u),this._update(e,i))},{once:!0}),o.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){e=typeof e=="string"?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=H[e],s=this._keypoints.map(a=>a.value),n=Bs(s,t,i),o=Ms(s,i);for(let[a,l]of Object.entries(this._keypoints))l.opacity=n[a],l.zIndex=o[a];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map(c=>c.src),{images:s,promise:n,cancel:o}=pe(i);s.forEach(c=>{let u=this._handleImageLoading(c.src);c.addEventListener("load",u),c.addEventListener("error",u)}),this._cancelLastImages=()=>{o(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;await n,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((c,u)=>{let h=s[u];h.classList.add("fader-image"),c.image=h,this._container.appendChild(h)}),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let t=this._imageSrc(),i=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",i,{once:!0}),this._previewImage.addEventListener("error",i,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let o=bi(i,s).map(l=>this._imageSrc({url:e,filter:t,operation:i,value:l})),{cancel:a}=pe(o);this._cancelBatchPreload=a}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=w({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=w({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=n,typeof i!="number"&&!s){let a=this._imageSrc({operation:t,value:i});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=bi(t,i).map(a=>this._constructKeypoint(t,a)),this._update(t,i),this._initNodes()}deactivate({hide:e=!0,seamlessTransition:t=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=w({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:t,inactive_rough:!t}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var Ds=1,_t=class extends d{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>Ds?this.scrollLeft+=i:this.scrollLeft+=t})}};_t.template=`<slot></slot>`;function Fs(r){return`<uc-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;"></uc-btn-ui>`}function zs(r){return`<uc-presence-toggle class="tab-content" set="visible: presence.tabContent${r}; styles: presence.tabContentStyles"><uc-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></uc-editor-scroller></uc-presence-toggle>`}var bt=class extends d{constructor(){super();this.init$={"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*editorTransformations":{},"*currentFilter":B,"*currentOperation":null,showLoader:!1,tabId:C.CROP,filters:li,colorOperations:ai,cropOperations:ci,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,[`presence.tabContent${C.CROP}`]:!1,[`presence.tabContent${C.SLIDERS}`]:!1,[`presence.tabContent${C.FILTERS}`]:!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=D(this._showLoader.bind(this),500)}get tabId(){return this.$.tabId}_onSliderClose(){this.$["*showSlider"]=!1,this.$.tabId===C.SLIDERS&&(this.ref["tooltip-el"].className=w("filter-tooltip",{"filter-tooltip_visible":!1,"filter-tooltip_hidden":!0}))}_createOperationControl(e){let t=_e.is&&new _e;return t.operation=e,t}_createFilterControl(e){let t=ce.is&&new ce;return t.filter=e,t}_createToggleControl(e){let t=fe.is&&new fe;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();e===C.CROP?this.$.cropOperations.forEach(s=>{let n=this._createToggleControl(s);i.appendChild(n)}):e===C.FILTERS?[B,...this.$.filters].forEach(s=>{let n=this._createFilterControl(s);i.appendChild(n)}):e===C.SLIDERS&&this.$.colorOperations.forEach(s=>{let n=this._createOperationControl(s);i.appendChild(n)}),i.childNodes.forEach((s,n)=>{n===i.childNodes.length-1&&s.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}){this.$.tabId=e,e===C.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate({seamlessTransition:!0}));for(let i of Le){let s=i===e,n=this.ref[`tab-toggle-${i}`];n.active=s,s?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(i),this.$[`presence.tabContent${i}`]=s}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$.tabId}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=j(this.$["*originalUrl"],e,this.$["*editorTransformations"]);this._cancelPreload&&this._cancelPreload();let{cancel:i}=pe([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$.tabId,{fromViewer:!0})},0)}),this.sub("*currentFilter",e=>{this.$["*operationTooltip"]=this.l10n(e||B),this.ref["tooltip-el"].className=w("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e})}),this.sub("*currentOperation",e=>{this.$.tabId===C.SLIDERS&&(this.$["*operationTooltip"]=e,this.ref["tooltip-el"].className=w("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e}))}),this.sub("*tabId",e=>{e===C.FILTERS&&(this.$["*operationTooltip"]=this.$["*currentFilter"]),this.ref["tooltip-el"].className=w("filter-tooltip",{"filter-tooltip_visible":e===C.FILTERS,"filter-tooltip_hidden":e!==C.FILTERS})}),this.sub("*originalUrl",e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,s]of i.entries())if(s){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e})}};bt.template=`<uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui><div class="filter-tooltip_container"><div class="filter-tooltip_wrapper"><div ref="tooltip-el" class="filter-tooltip filter-tooltip_visible"> {{*operationTooltip}} </div></div></div><div class="toolbar-container"><uc-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row"> ${Le.map(zs).join("")} </div><div class="controls-row"><uc-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></uc-btn-ui><div class="tab-toggles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${Le.map(Fs).join("")} </div><uc-btn-ui theme="primary" icon="done" set="onclick: on.apply"></uc-btn-ui></div></uc-presence-toggle><uc-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><uc-editor-slider ref="slider-el"></uc-editor-slider></div><div class="controls-row"><uc-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></uc-btn-ui><uc-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></uc-btn-ui></div></uc-presence-toggle></div>`;var Be=class extends d{constructor(){super();this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return w("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e!=="custom"&&(this.className=e)}),this.sub("text",e=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};Be.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});Be.template=`<uc-icon size="20" set="className: iconCss; @name: icon;"></uc-icon><div class="text">{{text}}</div>`;var vt=class extends d{constructor(){super();this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};vt.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var Me={transition:"transition",visible:"visible",hidden:"hidden"},yt=class extends d{constructor(){super();this._visible=!1,this._visibleStyle=Me.visible,this._hiddenStyle=Me.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{!e||(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",si(this,{[Me.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Me.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};yt.template=`<slot></slot>`;var wt=class extends d{constructor(){super();p(this,"init$",{disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",e=>{this.$.disabled=e}),this.defineAccessor("min",e=>{this.$.min=e}),this.defineAccessor("max",e=>{this.$.max=e}),this.defineAccessor("defaultValue",e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)}),this.defineAccessor("zero",e=>{this._zero=e}),this.defineAccessor("onInput",e=>{!e||(this.$.onInput=e)}),this.defineAccessor("onChange",e=>{!e||(this.$.onChange=e)})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:i}=t.getBoundingClientRect(),s=Math.ceil(i/2),n=Math.ceil(s/15)-2;if(this._stepsCount===n)return;let o=document.createDocumentFragment(),a=document.createElement("div"),l=document.createElement("div");a.className="minor-step",l.className="border-step",o.appendChild(l);for(let u=0;u<n;u++)o.appendChild(a.cloneNode());o.appendChild(l.cloneNode());for(let u=0;u<n;u++)o.appendChild(a.cloneNode());o.appendChild(l.cloneNode());let c=document.createElement("div");c.className="zero-dot",o.appendChild(c),this._zeroDotEl=c,t.innerHTML="",t.appendChild(o),this._stepsCount=n}connectedCallback(){super.connectedCallback(),this._updateSteps(),this._observer=new Ne(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let i=this.ref["input-el"];t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}disconnectedCallback(){this._observer.unobserve(this),this._observer=void 0}};wt.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type='range' ref='input-el'tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;">`;var yi=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.CLOUD_IMG_EDIT);p(this,"init$",{uuid:null})}initCallback(){this.style.display="flex",this.style.position="relative",this.bindCssData("--cfg-pubkey"),this.sub("*currentActivity",e=>{e===d.activities.CLOUD_IMG_EDIT?this.mountEditor():this.unmountEditor()}),this.sub("*focusedEntry",e=>{!e||(this.entry=e,this.entry.subscribe("uuid",t=>{t&&(this.$.uuid=t)}))})}handleApply(e){let t=e.detail,{transformationsUrl:i}=t;this.entry.setValue("transformationsUrl",i),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let e=new le;e.classList.add("uc-cldtr-common");let t=this.$.uuid;e.setAttribute("uuid",t),e.addEventListener("apply",i=>this.handleApply(i)),e.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.style.width="100%",this.style.height="100%",this.appendChild(e)}unmountEditor(){this.style.width="0px",this.style.height="0px",this.innerHTML=""}};var G={};window.addEventListener("message",r=>{let e;try{e=JSON.parse(r.data)}catch{return}if((e==null?void 0:e.type)in G){let t=G[e.type];for(let[i,s]of t)r.source===i&&s(e)}});var wi=function(r,e,t){r in G||(G[r]=[]),G[r].push([e,t])},xi=function(r,e){r in G&&(G[r]=G[r].filter(t=>t[0]!==e))};var Vs=r=>Object.keys(r).reduce((t,i)=>{let s=r[i],n=Object.keys(s).reduce((o,a)=>{let l=s[a];return o+`${a}: ${l};`},"");return t+`${i}{${n}}`},"");function Ci({textColor:r,backgroundColor:e,linkColor:t,linkColorHover:i,shadeColor:s}){let n=`solid 1px ${s}`;return Vs({body:{color:r,"background-color":e},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:s},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:t},".bread-crumbs a:hover":{color:i},".main-content.loading":{background:`${e} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${s}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:t},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:i},".side-bar-menu a":{color:t},".side-bar-menu a:hover":{color:i},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:i},".source-vk .side-bar-menu a":{color:t},".source-vk .side-bar-menu a:hover":{color:i,background:"none"}})}var xt=class extends d{constructor(){super(...arguments);p(this,"activityType",d.activities.EXTERNAL);p(this,"init$",{counter:0,onDone:()=>{this.$["*currentActivity"]=d.activities.UPLOAD_LIST},onCancel:()=>{this.set$({"*currentActivity":d.activities.SOURCE_SELECT})}});p(this,"_iframe",null)}initCallback(){this.registerActivity(this.activityType,()=>{let{externalSourceType:e}=this.activityParams;this.set$({"*activityCaption":`${e[0].toUpperCase()}${e.slice(1)}`,"*activityIcon":e}),this.$.counter=0,this.mountIframe()}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()})}sendMessage(e){this._iframe.contentWindow.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){this.$.counter=this.$.counter+1;let{url:t,filename:i}=e;this.uploadCollection.add({externalUrl:t,fileName:i})}handleIframeLoad(e){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:Ci(e)})}remoteUrl(){let e=this.$["*--cfg-pubkey"],t="3.11.3",i=(!1).toString(),{externalSourceType:s}=this.activityParams;return`https://social.uploadcare.com/window3/${s}?lang=en&public_key=${e}&widget_version=${t}&images_only=${i}&pass_window_open=false`}mountIframe(){let e=ie({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),wi("file-selected",e.contentWindow,this.handleFileSelected.bind(this)),this._iframe=e}unmountIframe(){this._iframe&&xi("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}};xt.template=`<div ref="iframeWrapper" class="iframe-wrapper"></div><div class="toolbar"><button class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><div></div><div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div><button class="done-btn primary-btn" set="onclick: onDone"><uc-icon name="check"></uc-icon></button></div>`;var De=class extends d{setCurrentTab(e){if(!e)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(i=>{i.getAttribute("tab-ctx")===e?i.removeAttribute("hidden"):i.setAttribute("hidden","")});for(let i in this._tabMap)i===e?this._tabMap[i].setAttribute("current",""):this._tabMap[i].removeAttribute("current")}initCallback(){this._tabMap={},this.defineAccessor("tab-list",e=>{if(!e)return;e.split(",").map(i=>i.trim()).forEach(i=>{let s=ie({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(i)}}});s.textContent=this.l10n(i),this.ref.row.appendChild(s),this._tabMap[i]=s})}),this.defineAccessor("default",e=>{this.setCurrentTab(e)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};De.bindAttributes({"tab-list":null,default:null});De.template=`<div ref="row" class="tabs-row"></div><div ref="context" class="tabs-context"><slot></slot></div>`;var S=class extends d{initCallback(){let e=this.getAttribute("from");this.sub(e||S.defaultFrom,t=>{if(!t){this.innerHTML="";return}if(this.hasAttribute(S.fireEventAttrName)&&this.dispatchEvent(new CustomEvent(S.outputEventName,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(S.templateAttrName)){let i=this.getAttribute(S.templateAttrName),s="";t.forEach(n=>{let o=i;for(let a in n)o=o.split(`{{${a}}}`).join(n[a]);s+=o}),this.innerHTML=s}this.value=t,this.hasAttribute(S.formValueAttrName)&&(this._input||(this._input=document.createElement("input"),this._input.type="text",this.appendChild(this._input)),this._input.value=JSON.stringify(t)),this.hasAttribute(S.consoleAttrName)&&console.log(t)})}};S.outputEventName="data-output";S.templateAttrName="item-template";S.fireEventAttrName="fire-event";S.consoleAttrName="console";S.formValueAttrName="form-value";S.defaultFrom="*outputData";var Ct=class extends d{constructor(){super(...arguments);p(this,"init$",{"*activityCaption":void 0})}};Ct.template=`<div class="caption">{{*activityCaption}}</div>`;var Tt=class extends d{constructor(){super(...arguments);p(this,"init$",{"*activityIcon":"default"})}};Tt.template=`<uc-icon set="@name: *activityIcon"></uc-icon>`;function Hs(r){var e,t;for(let i in r){let s=[...i].reduce((n,o)=>(o.toUpperCase()===o&&(o="-"+o.toLowerCase()),n+=o),"");s.startsWith("-")&&(s=s.replace("-","")),(t=(e=r[i]).reg)==null||t.call(e,s)}}var Ti=class extends d{};Ti.template=`<uc-simple-btn></uc-simple-btn><uc-modal strokes block-body-scrolling><uc-activity-icon slot="heading"></uc-activity-icon><uc-activity-caption slot="heading"></uc-activity-caption><uc-start-from><uc-source-list wrap></uc-source-list><uc-drop-area></uc-drop-area></uc-start-from><uc-upload-list></uc-upload-list><uc-camera-source></uc-camera-source><uc-url-source></uc-url-source><uc-external-source></uc-external-source><uc-upload-details></uc-upload-details><uc-confirmation-dialog></uc-confirmation-dialog></uc-modal><uc-message-box></uc-message-box><uc-progress-bar-common></uc-progress-bar-common>`;export{Ct as ActivityCaption,Tt as ActivityIcon,d as Block,at as CameraSource,le as CloudEditor,yi as CloudImageEditor,st as ConfirmationDialog,pt as CropFrame,S as DataOutput,Gt as DropArea,Ie as EditableCanvas,fe as EditorCropButtonControl,ce as EditorFilterControl,ft as EditorImageCropper,vi as EditorImageFader,_e as EditorOperationControl,_t as EditorScroller,mt as EditorSlider,bt as EditorToolbar,xt as ExternalSource,N as FileItem,$e as Icon,vt as LineLoaderUi,et as MessageBox,it as Modal,yt as PresenceToggle,ht as ProgressBar,ct as ProgressBarCommon,Ke as SimpleBtn,wt as SliderUi,Se as SourceBtn,Wt as SourceList,Ht as StartFrom,De as Tabs,Be as UcBtnUi,lt as UploadDetails,rt as UploadList,Ti as Uploader,nt as UrlSource,Hs as registerBlocks};