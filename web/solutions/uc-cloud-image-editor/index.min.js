/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2021 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
var et=Object.defineProperty;var tt=(o,e,t)=>e in o?et(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var f=(o,e,t)=>(tt(o,typeof e!="symbol"?e+"":e,t),t);function it(o){let e=t=>{var i;for(let s in t)((i=t[s])==null?void 0:i.constructor)===Object&&(t[s]=e(t[s]));return{...t}};return e(o)}var p=class{constructor(e){this.uid=Symbol(),this.name=e.name||null,e.schema.constructor===Object?this.store=it(e.schema):(this._storeIsProxy=!0,this.store=e.schema),this.callbackMap=Object.create(null)}static warn(e,t){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+t)}read(e){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(p.warn("read",e),null):this.store[e]}has(e){return this._storeIsProxy?this.store[e]!==void 0:this.store.hasOwnProperty(e)}add(e,t,i=!0){!i&&Object.keys(this.store).includes(e)||(this.store[e]=t,this.callbackMap[e]&&this.callbackMap[e].forEach(s=>{s(this.store[e])}))}pub(e,t){if(!this._storeIsProxy&&!this.store.hasOwnProperty(e)){p.warn("publish",e);return}this.add(e,t)}multiPub(e){for(let t in e)this.pub(t,e[t])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach(t=>{t(this.store[e])})}sub(e,t,i=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(p.warn("subscribe",e),null):(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(t),i&&t(this.store[e]),{remove:()=>{this.callbackMap[e].delete(t),this.callbackMap[e].size||delete this.callbackMap[e]},callback:t})}remove(){delete p.globalStore[this.uid]}static registerLocalCtx(e){let t=new p({schema:e});return p.globalStore[t.uid]=t,t}static registerNamedCtx(e,t){let i=p.globalStore[e];return i?console.warn('State: context name "'+e+'" already in use'):(i=new p({name:e,schema:t}),p.globalStore[e]=i),i}static clearNamedCtx(e){delete p.globalStore[e]}static getNamedCtx(e,t=!0){return p.globalStore[e]||(t&&console.warn('State: wrong context name - "'+e+'"'),null)}};p.globalStore=Object.create(null);var g=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym"});var Se="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",st=Se.length-1,R=class{static generate(e="XXXXXXXXX-XXX"){let t="";for(let i=0;i<e.length;i++)t+=e[i]==="-"?e[i]:Se.charAt(Math.random()*st);return t}};function rt(o,e){if(e.shadowRoot)return;let t=[...o.querySelectorAll("slot")];if(e.initChildren.length&&t.length){let i={};t.forEach(s=>{let r=s.getAttribute("name");r?i[r]={slot:s,fr:document.createDocumentFragment()}:i.__default__={slot:s,fr:document.createDocumentFragment()}}),e.initChildren.forEach(s=>{var n;let r=(n=s.getAttribute)==null?void 0:n.call(s,"slot");r?(s.removeAttribute("slot"),i[r].fr.appendChild(s)):i.__default__&&i.__default__.fr.appendChild(s)}),Object.values(i).forEach(s=>{s.slot.parentNode.insertBefore(s.fr,s.slot),s.slot.remove()})}}function ot(o,e){[...o.querySelectorAll(`[${g.EL_REF_ATTR}]`)].forEach(t=>{let i=t.getAttribute(g.EL_REF_ATTR);e.ref[i]=t,t.removeAttribute(g.EL_REF_ATTR)})}function nt(o,e){[...o.querySelectorAll(`[${g.BIND_ATTR}]`)].forEach(t=>{t.getAttribute(g.BIND_ATTR).split(";").forEach(r=>{if(!r)return;let n=r.split(":").map(y=>y.trim()),a=n[0],l;a.indexOf(g.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(g.ATTR_BIND_PRFX,""));let c=n[1].split(",").map(y=>y.trim()),h,d,m,w;if(a.includes(".")){h=!0;let y=a.split(".");w=()=>{d=t,y.forEach((_,j)=>{j<y.length-1?d=d[_]:m=_})},w()}for(let y of c)e.sub(y,_=>{l?(_==null?void 0:_.constructor)===Boolean?_?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,_):h?d?d[m]=_:window.setTimeout(()=>{w(),d[m]=_}):t[a]=_})}),t.removeAttribute(g.BIND_ATTR)})}var Q="{{",X="}}",at="skip-text";function lt(o){let e,t=[],i=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var r;return!((r=s.parentElement)!=null&&r.hasAttribute(at))&&s.textContent.includes(Q)&&s.textContent.includes(X)&&1}});for(;e=i.nextNode();)t.push(e);return t}var ht=function(o,e){lt(o).forEach(i=>{let s=[],r;for(;i.textContent.includes(X);)i.textContent.startsWith(Q)?(r=i.textContent.indexOf(X)+X.length,i.splitText(r),s.push(i)):(r=i.textContent.indexOf(Q),i.splitText(r)),i=i.nextSibling;s.forEach(n=>{let a=n.textContent.replace(Q,"").replace(X,"");e.sub(a,l=>{n.textContent=l})})})},$e=[rt,ot,nt,ht];var Ae=0,I=class extends HTMLElement{initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,(e=this.initCallback)==null||e.call(this))}render(e,t=this.renderShadow){let i;if((t||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(e==null?void 0:e.constructor)===DocumentFragment)i=e;else if((e==null?void 0:e.constructor)===String){let r=document.createElement("template");r.innerHTML=e,i=r.content.cloneNode(!0)}else this.constructor.__tpl&&(i=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(i,this)}let s=()=>{i&&(t&&this.shadowRoot.appendChild(i)||this.appendChild(i)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){t=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=s,this.shadowRoot.prepend(r)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}constructor(){super();this.init$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=R.generate(),this.style.setProperty(g.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(g.CSS_CTX_PROP,!0)}get ctxName(){var e;return((e=this.getAttribute(g.CTX_NAME_ATTR))==null?void 0:e.trim())||this.cssCtxName||this.autoCtxName}get localCtx(){return this.__localCtx||(this.__localCtx=p.registerLocalCtx({})),this.__localCtx}get nodeCtx(){return p.getNamedCtx(this.ctxName,!1)||p.registerNamedCtx(this.ctxName,{})}static __parseProp(e,t){let i,s;if(e.startsWith(g.EXT_DATA_CTX_PRFX))i=t.nodeCtx,s=e.replace(g.EXT_DATA_CTX_PRFX,"");else if(e.includes(g.NAMED_DATA_CTX_SPLTR)){let r=e.split(g.NAMED_DATA_CTX_SPLTR);i=p.getNamedCtx(r[0]),s=r[1]}else i=t.localCtx,s=e;return{ctx:i,name:s}}sub(e,t){let i=I.__parseProp(e,this);this.allSubs.add(i.ctx.sub(i.name,t))}notify(e){let t=I.__parseProp(e,this);t.ctx.notify(t.name)}has(e){let t=I.__parseProp(e,this);return t.ctx.has(t.name)}add(e,t){let i=I.__parseProp(e,this);i.ctx.add(i.name,t,!1)}add$(e){for(let t in e)this.add(t,e[t])}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(t,i,s)=>{let r=I.__parseProp(i,this);return r.ctx.pub(r.name,s),!0},get:(t,i)=>{let s=I.__parseProp(i,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(e){for(let t in e)this.$[t]=e[t]}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let t of Object.values(e))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let t in this.init$)if(t.startsWith(g.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(g.EXT_DATA_CTX_PRFX,""),this.init$[t]);else if(t.includes(g.NAMED_DATA_CTX_SPLTR)){let i=t.split(g.NAMED_DATA_CTX_SPLTR),s=i[0].trim(),r=i[1].trim();if(s&&r){let n=p.getNamedCtx(s,!1);n||(n=p.registerNamedCtx(s,{})),n.add(r,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=(e=this.getAttribute(g.CTX_NAME_ATTR))==null?void 0:e.trim();t&&this.style.setProperty(g.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this.initChildren=[...this.childNodes];for(let i of $e)this.addTemplateProcessor(i);this.pauseRender?this.__initCallback():this.render()}this.connectedOnce=!0}destroyCallback(){}disconnectedCallback(){this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e)},100))}static reg(e,t=!1){if(e||(Ae++,e=`${g.AUTO_TAG_PRFX}-${Ae}`),this.__tag=e,window.customElements.get(e)){console.warn(`${e} - is already in "customElements" registry`);return}window.customElements.define(e,t?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,t,i){if(t===i)return;let s=this.constructor.__attrDesc[e];s?this.__dataCtxInitialized?this.$[s]=i:this.init$[s]=i:this[e]=i}getCssData(e,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let i=this.__computedStyle.getPropertyValue(e).trim();i.startsWith("'")&&i.endsWith("'")&&(i=i.replace(/\'/g,'"'));try{this.__cssDataCache[e]=JSON.parse(i)}catch{!t&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}bindCssData(e,t=!0){let i=(t?g.EXT_DATA_CTX_PRFX:"")+e;return this.add(i,this.getCssData(e,!0)),i}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,t,i){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:r=>{this[s]=r,i?window.setTimeout(()=>{t==null||t(r)}):t==null||t(r)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let t=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}},H=I;f(H,"template");var Re="[Typed State] Wrong property name: ",ct="[Typed State] Wrong property type: ",ee=class{constructor(e,t){this.__typedSchema=e,this.__ctxId=t||R.generate(),this.__schema=Object.keys(e).reduce((i,s)=>(i[s]=e[s].value,i),{}),this.__data=p.registerNamedCtx(this.__ctxId,this.__schema)}get uid(){return this.__ctxId}setValue(e,t){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(Re+e);return}let i=this.__typedSchema[e];if((t==null?void 0:t.constructor)===i.type||i.nullable&&t===null){this.__data.pub(e,t);return}console.warn(ct+e)}setMultipleValues(e){for(let t in e)this.setValue(t,e[t])}getValue(e){if(!this.__typedSchema.hasOwnProperty(e)){console.warn(Re+e);return}return this.__data.read(e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){this.__data.remove()}};var te=class{constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||R.generate(),this.__data=p.registerNamedCtx(this.__ctxId,{}),this.__watchList=e.watchList||[],this.__handler=e.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set;let t=Object.create(null);this.__notifyObservers=(i,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[i]||(t[i]=new Set),t[i].add(s),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(r=>{r({...t})}),t=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var e;(e=this.__handler)==null||e.call(this,[...this.__items])})}add(e){let t=new ee(this.__typedSchema);for(let i in e)t.setValue(i,e[i]);return this.__data.add(t.uid,t),this.__watchList.forEach(i=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(i,()=>{this.__notifyObservers(i,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}read(e){return this.__data.read(e)}readProp(e,t){return this.read(e).getValue(t)}publishProp(e,t,i){this.read(e).setValue(t,i)}remove(e){this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach(e=>{this.remove(e)})}observe(e){this.__observers.add(e)}unobserve(e){this.__observers.delete(e)}findItems(e){let t=[];return this.__items.forEach(i=>{let s=this.read(i);e(s)&&t.push(i)}),t}items(){return[...this.__items]}destroy(){this.__data.remove(),this.__observers=null;for(let e in this.__subsMap)this.__subsMap[e].forEach(t=>{t.remove()}),delete this.__subsMap[e]}};var N=class{static _print(e){console.warn(e)}static setDefaultTitle(e){this.defaultTitle=e}static setRoutingMap(e){Object.assign(this.appMap,e);for(let t in this.appMap)!this.defaultRoute&&this.appMap[t].default===!0?this.defaultRoute=t:!this.errorRoute&&this.appMap[t].error===!0&&(this.errorRoute=t)}static set routingEventName(e){this.__routingEventName=e}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let e={route:null,options:{}};return window.location.search.split(this.separator).forEach(i=>{if(i.includes("?"))e.route=i.replace("?","");else if(i.includes("=")){let s=i.split("=");e.options[s[0]]=decodeURI(s[1])}else e.options[i]=!0}),e}static notify(){let e=this.readAddressBar(),t=this.appMap[e.route];if(t&&t.title&&(document.title=t.title),e.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!t&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t){this._print(`Route "${e.route}" not found...`);return}let i=new CustomEvent(N.routingEventName,{detail:{route:e.route,options:Object.assign(t||{},e.options)}});window.dispatchEvent(i)}static reflect(e,t={}){let i=this.appMap[e];if(!i){this._print("Wrong route: "+e);return}let s="?"+e;for(let n in t)t[n]===!0?s+=this.separator+n:s+=this.separator+n+`=${t[n]}`;let r=i.title||this.defaultTitle||"";window.history.pushState(null,r,s),document.title=r}static applyRoute(e,t={}){this.reflect(e,t),this.notify()}static setSeparator(e){this._separator=e}static get separator(){return this._separator||"&"}static createRouterData(e,t){this.setRoutingMap(t);let i=p.registerNamedCtx(e,{route:null,options:null,title:null});return window.addEventListener(this.routingEventName,s=>{var r;i.multiPub({route:s.detail.route,options:s.detail.options,title:((r=s.detail.options)==null?void 0:r.title)||this.defaultTitle||""})}),N.notify(),i}};N.appMap=Object.create(null);window.onpopstate=()=>{N.notify()};function Ie(o,e){[...o.querySelectorAll("[l10n]")].forEach(t=>{let i=t.getAttribute("l10n"),s="textContent";if(i.includes(":")){let n=i.split(":");s=n[0],i=n[1]}let r="l10n:"+i;e.__l10nKeys.push(r),e.add(r,i),e.sub(r,n=>{t[s]=e.l10n(n)}),t.removeAttribute("l10n")})}var V=class extends Error{constructor(e,t,i,s,r){super();this.name="UploadClientError",this.message=e,this.code=t,this.request=i,this.response=s,this.headers=r,Object.setPrototypeOf(this,V.prototype)}};var di={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,multipartMaxAttempts:3,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"};var dt=/\W|_/g;function ut(o){return o.split(dt).map((e,t)=>e.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+e.slice(1)).join("")}function ue(o){return!o||typeof o!="object"?o:Object.keys(o).reduce((e,t)=>(e[ut(t)]=typeof o[t]=="object"?ue(o[t]):o[t],e),{})}var Oe;(function(o){o.Token="token",o.FileInfo="file_info"})(Oe||(Oe={}));var ke;(function(o){o.Unknown="unknown",o.Waiting="waiting",o.Progress="progress",o.Error="error",o.Success="success"})(ke||(ke={}));var pe=class{constructor(e,{baseCDN:t,defaultEffects:i,fileName:s}){this.name=null,this.size=null,this.isStored=null,this.isImage=null,this.mimeType=null,this.cdnUrl=null,this.cdnUrlModifiers=null,this.originalUrl=null,this.originalFilename=null,this.imageInfo=null,this.videoInfo=null;let{uuid:r,s3Bucket:n}=e,a=n?`https://${n}.s3.amazonaws.com/${r}/${e.filename}`:`${t}/${r}/`,l=i?`-/${i}`:null,c=`${a}${l||""}`,h=r?a:null;this.uuid=r,this.name=s||e.filename,this.size=e.size,this.isStored=e.isStored,this.isImage=e.isImage,this.mimeType=e.mimeType,this.cdnUrl=c,this.cdnUrlModifiers=l,this.originalUrl=h,this.originalFilename=e.originalFilename,this.imageInfo=ue(e.imageInfo),this.videoInfo=ue(e.videoInfo)}};var{AbortController:ui,AbortSignal:pi}=typeof self!="undefined"?self:typeof window!="undefined"?window:void 0;var fi=window.WebSocket;var Pe=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:V,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},transformationsUrl:{type:String,value:null},fileInfo:{type:pe,value:null},isUploading:{type:Boolean,value:!1}});var Le="active",W="___ACTIVITY_IS_ACTIVE___",Ne="uc-",pt="css-src",fe=document.readyState==="complete";fe||window.addEventListener("load",()=>{fe=!0});var E=class extends H{l10n(e){return this.getCssData("--l10n-"+e,!0)||e}constructor(){super();this.activityType=null,this.addTemplateProcessor(Ie),this.__l10nKeys=[],this.__l10nUpdate=()=>{this.dropCssDataCache();for(let e of this.__l10nKeys)this.notify(e)},window.addEventListener("uc-l10n-update",this.__l10nUpdate)}applyL10nKey(e,t){this.$["l10n:"+e]=t}historyBack(){let e=this.$["*history"];e.pop();let t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e}addFiles(e){e.forEach(t=>{this.uploadCollection.add({file:t,isImage:t.type.includes("image"),mimeType:t.type,fileName:t.name,fileSize:t.size})})}connectedCallback(){let e=()=>{fe?this.connected():window.addEventListener("load",()=>{this.connected()})},t=this.getAttribute(pt);if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t,i.onload=()=>{window.requestAnimationFrame(()=>{e()})},this.shadowRoot.appendChild(i)}else e()}__bindBasicCssData(){E._cssDataBindingsList.includes(this.ctxName)||(["pubkey","store","multiple","max-files","accept","confirm-upload"].forEach(t=>{this.bindCssData(`--cfg-${t}`)}),E._cssDataBindingsList.push(this.ctxName))}initCallback(){this.__bindBasicCssData()}connected(){this.__connectedOnce?super.connectedCallback():(E._ctxConnectionsList.includes(this.ctxName)||(this.add$({"*currentActivity":"","*currentActivityParams":{},"*history":[],"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null}),E._ctxConnectionsList.push(this.ctxName)),super.connectedCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{var s,r;let t=this.ctxName+this.activityType,i=E._activityRegistry[t];if(this.activityType!==e&&this[W])this[W]=!1,this.removeAttribute(Le),(s=i==null?void 0:i.deactivateCallback)==null||s.call(i);else if(this.activityType===e&&!this[W]){this[W]=!0,this.setAttribute(Le,""),(r=i==null?void 0:i.activateCallback)==null||r.call(i);let n=this.$["*history"];n.length>10&&(n=n.slice(n.length-11,n.length-1)),n.push(this.activityType),this.$["*history"]=n}})),this.__connectedOnce=!0)}openSystemDialog(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.$["*--cfg-multiple"],this.fileInput.max=this.$["*--cfg-max-files"],this.fileInput.accept=this.$["*--cfg-accept"],this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=E.activities.UPLOAD_LIST,this.fileInput.value="",this.fileInput=null}}get doneActivity(){return this.getAttribute("done-activity")}get cancelActivity(){return this.getAttribute("cancel-activity")}get isActivityActive(){return this[W]}registerActivity(e,t,i){E._activityRegistry||(E._activityRegistry=Object.create(null));let s=this.ctxName+e;E._activityRegistry[s]={activateCallback:t,deactivateCallback:i}}get activityParams(){return this.$["*currentActivityParams"]}get uploadCollection(){if(!this.has("*uploadCollection")){let e=new te({typedSchema:Pe,watchList:["uploadProgress","uuid"],handler:t=>{this.$["*uploadList"]=t}});e.observe(t=>{if(t.uploadProgress){let i=0,s=e.findItems(r=>!r.getValue("uploadError"));s.forEach(r=>{i+=e.readProp(r,"uploadProgress")}),this.$["*commonProgress"]=i/s.length}}),this.add("*uploadCollection",e)}return this.$["*uploadCollection"]}fileSizeFmt(e,t=2){let i=["B","KB","MB","GB","TB"],s=l=>this.getCssData("--l10n-unit-"+l.toLowerCase(),!0)||l;if(e===0)return`0 ${s(i[0])}`;let r=1024,n=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(r));return parseFloat((e/r**a).toFixed(n))+" "+s(i[a])}output(){let e=[];this.uploadCollection.items().forEach(i=>{let r=p.getNamedCtx(i).store.fileInfo;e.push(r)}),this.$["*outputData"]=e}destroyCallback(){window.removeEventListener("uc-l10n-update",this.__l10nUpdate),this.__l10nKeys=null}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(Ne)?e:Ne+e)}},u=E;f(u,"_activityRegistry",Object.create(null)),f(u,"_ctxConnectionsList",[]),f(u,"_cssDataBindingsList",[]);u.activities=Object.freeze({SOURCE_SELECT:"source-select",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});u.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});u.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...u.extSrcList});var ie=class extends u{constructor(){super(...arguments);f(this,"init$",{name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)}),this.sub("path",e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path d="${e}"></path>`)}),this.sub("size",e=>{this.$.viewBox=`0 0 ${e} ${e}`})}};ie.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;ie.bindAttributes({name:"name",size:"size"});function Me(...o){return o.reduce((e,t)=>{if(typeof t=="string")return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}function b(...o){let e=Me(...o);return Object.keys(e).reduce((t,i)=>(e[i]&&t.push(i),t),[]).join(" ")}function De(o,...e){let t=Me(...e);for(let i of Object.keys(t))o.classList.toggle(i,t[i])}function A(o,e){let t,i=(...s)=>{clearTimeout(t),t=setTimeout(()=>o(...s),e)};return i.cancel=()=>{clearTimeout(t)},i}var O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function M(o){let e=new Image;return{promise:new Promise((s,r)=>{e.src=o,e.onload=s,e.onerror=r}),image:e,cancel:()=>{e.naturalWidth===0&&(e.src=O)}}}function G(o){let e=[];for(let r of o){let n=M(r);e.push(n)}let t=e.map(r=>r.image);return{promise:Promise.allSettled(e.map(r=>r.promise)),images:t,cancel:()=>{e.forEach(r=>{r.cancel()})}}}var C={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function ft(o,e){if(typeof e=="number")return C[o]!==e?`${o}/${e}`:"";if(typeof e=="boolean")return e&&C[o]!==e?`${o}`:"";if(o==="filter"){if(!e||C[o]===e.amount)return"";let{name:t,amount:i}=e;return`${o}/${t}/${i}`}if(o==="crop"){if(!e)return"";let{dimensions:t,coords:i}=e;return`${o}/${t.join("x")}/${i.join(",")}`}return""}function Ue(...o){return o.join("/-/").replace(/\/\//g,"/")}var mt=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function B(o){return Ue(...mt.filter(e=>typeof o[e]!="undefined"&&o[e]!==null).map(e=>{let t=o[e];return ft(e,t)}).filter(e=>e&&e.length>0))}function z(o,...e){return o.replace(/\/$/g,"")+"/-/"+Ue(...e.filter(t=>t&&t.length>0))+"/"}var se=["format/auto","progressive/yes"].join("/-/");function Be(o){return{"*originalUrl":null,"*tabId":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*modalEl":o,"*networkProblems":!1,"*imageSize":null,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:O,fileType:"",showLoader:!1,uuid:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let e=o.shadowRoot.querySelectorAll("img");for(let t of e){let i=t.src;t.src=O,t.src=i}o.$["*networkProblems"]=!1},"*on.apply":e=>{if(!e)return;let t=z(o.$["*originalUrl"],B(e),"preview");o.dispatchEvent(new CustomEvent("apply",{detail:{originalUrl:o.$["*originalUrl"],transformationsUrl:t,transformations:e}})),o.remove()},"*on.cancel":()=>{o.remove(),o.dispatchEvent(new CustomEvent("cancel"))}}}var ze=`<div class="wrapper wrapper_desktop"><uc-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><uc-icon size="20" name="sad"></uc-icon></div><div class="network_problems_text"> Network error </div></div><div class="network_problems_footer"><uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui></div></uc-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img class="image image_visible_from_editor" ref="img-el"><uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper><uc-editor-image-fader ref="fader-el"></uc-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui><div class="toolbar_content toolbar_content__editor"><uc-editor-toolbar></uc-editor-toolbar></div></div></div>`;var v={CROP:"crop",SLIDERS:"sliders",FILTERS:"filters"},re=[v.CROP,v.SLIDERS,v.FILTERS],Fe=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],je=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Xe=["rotate","mirror","flip"],k={brightness:{zero:C.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:C.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:C.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:C.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:C.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:C.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:C.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:C.enhance,range:[0,100],keypointsNumber:1},filter:{zero:C.filter,range:[0,100],keypointsNumber:1}};function P(o,e,t){let s=window.devicePixelRatio,r=Math.min(Math.ceil(e*s),3e3),n=s>=2?"lightest":"normal";return z(o,se,B(t),`quality/${n}`,`stretch/off/-/resize/${r}x`)}var oe=class extends u{constructor(){super(...arguments);f(this,"init$",Be(this));f(this,"_debouncedShowLoader",A(this._showLoader.bind(this),300))}_showLoader(e){this.$.showLoader=e}_loadImageFromCdn(){this._debouncedShowLoader(!0);let e=this._imageSrc(),{promise:t,cancel:i}=M(e);t.then(()=>{this.$.src=e}).catch(s=>{this.$["*networkProblems"]=!0,this._debouncedShowLoader(!1),this.$.src=e}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=i}_imageSrc(){let{width:e}=this.ref["img-container-el"].getBoundingClientRect();return P(this.$["*originalUrl"],e,{})}initCallback(){super.initCallback(),this.$["*originalUrl"]=`https://ucarecdn.com/${this.$.uuid}/`,fetch(`${this.$["*originalUrl"]}-/json/`).then(e=>e.json()).then(({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}}),this._loadImageFromCdn(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.ref["img-el"].addEventListener("load",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==O&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||O)}),this.sub("*tabId",e=>{this.ref["img-el"].className=b("image",{image_hidden_to_cropper:e===v.CROP,image_hidden_effects:e!==v.CROP})})}disconnectedCallback(){super.disconnectedCallback()}};oe.template=ze;oe.bindAttributes({uuid:"uuid"});var q=33.333333333333336,x=24*2+34;function D(o,e){for(let t in e)o.setAttributeNS(null,t,e[t].toString())}function T(o,e={}){let t=document.createElementNS("http://www.w3.org/2000/svg",o);return D(t,e),t}function He(o,e){let{x:t,y:i,width:s,height:r}=o,n=e.includes("w")?0:1,a=e.includes("n")?0:1,l=[-1,1][n],c=[-1,1][a],h=[t+n*s+1.5*l,i+a*r+1.5*c-24*c],d=[t+n*s+1.5*l,i+a*r+1.5*c],m=[t+n*s-24*l+1.5*l,i+a*r+1.5*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${m[0]} ${m[1]}`,center:d}}function Ve(o,e){let{x:t,y:i,width:s,height:r}=o,n=["n","s"].includes(e)?.5:{w:0,e:1}[e],a=["w","e"].includes(e)?.5:{n:0,s:1}[e],l=[-1,1][n],c=[-1,1][a],h,d;["n","s"].includes(e)?(h=[t+n*s-34/2,i+a*r+1.5*c],d=[t+n*s+34/2,i+a*r+1.5*c]):(h=[t+n*s+1.5*l,i+a*r-34/2],d=[t+n*s+1.5*l,i+a*r+34/2]);let m=`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]}`,w=[d[0]-(d[0]-h[0])/2,d[1]-(d[1]-h[1])/2];return{d:m,center:w}}function We(o){return o===""?"move":["e","w"].includes(o)?"ew-resize":["n","s"].includes(o)?"ns-resize":["nw","se"].includes(o)?"nwse-resize":"nesw-resize"}function Ge(o,[e,t]){return{...o,x:o.x+e,y:o.y+t}}function ne(o,e){let{x:t}=o,{y:i}=o;return o.x<e.x?t=e.x:o.x+o.width>e.x+e.width&&(t=e.x+e.width-o.width),o.y<e.y?i=e.y:o.y+o.height>e.y+e.height&&(i=e.y+e.height-o.height),{...o,x:t,y:i}}function qe(o,[e,t],i){let{x:s,y:r,width:n,height:a}=o;return i.includes("n")&&(r+=t,a-=t),i.includes("s")&&(a+=t),i.includes("w")&&(s+=e,n-=e),i.includes("e")&&(n+=e),{x:s,y:r,width:n,height:a}}function Ye(o,e){let t=Math.max(o.x,e.x),i=Math.min(o.x+o.width,e.x+e.width),s=Math.max(o.y,e.y),r=Math.min(o.y+o.height,e.y+e.height);return{x:t,y:s,width:i-t,height:r-s}}function ae(o,[e,t],i){let{x:s,y:r,width:n,height:a}=o;if(i.includes("n")){let l=a;a=Math.max(t,a),r=r+l-a}if(i.includes("s")&&(a=Math.max(t,a)),i.includes("w")){let l=n;n=Math.max(e,n),s=s+l-n}return i.includes("e")&&(n=Math.max(e,n)),{x:s,y:r,width:n,height:a}}function Ke(o,[e,t]){return o.x<=e&&e<=o.x+o.width&&o.y<=t&&t<=o.y+o.height}var ge=class extends u{constructor(){super();f(this,"init$",{dragging:!1});this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=x&&t.width<=x)return!0;let i=t.height<=x&&(e.includes("n")||e.includes("s")),s=t.width<=x&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e,n=this.ref["svg-el"],a=T("mask",{id:"backdrop-mask"}),l=T("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),c=T("rect",{x:t,y:i,width:s,height:r,fill:"black"});a.appendChild(l),a.appendChild(c);let h=T("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});n.appendChild(h),n.appendChild(a),this._backdropMask=a,this._backdropMaskInner=c}_resizeBackdrop(){!this._backdropMask||(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask.style.display="block"}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e;D(this._backdropMaskInner,{x:t,y:i,width:s,height:r})}_updateFrame(){let e=this.$["*cropBox"];if(!e)return;for(let i of Object.values(this._frameThumbs)){let{direction:s,pathNode:r,interactionNode:n,groupNode:a}=i,l=s==="",c=s.length===2;if(l){let{x:d,y:m,width:w,height:y}=e,_=[d+w/2,m+y/2];D(n,{r:Math.min(w,y)/3,cx:_[0],cy:_[1]})}else{let{d,center:m}=c?He(e,s):Ve(e,s);D(n,{cx:m[0],cy:m[1]}),D(r,{d})}let h=this._shouldThumbBeDisabled(s);a.setAttribute("class",b("thumb",{"thumb--hidden":h,"thumb--visible":!h}))}let t=this._frameGuides;D(t,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`,r=T("g");r.classList.add("thumb"),r.setAttribute("with-effects","");let n=T("circle",{r:24+1.5,fill:"transparent"}),a=T("path",{stroke:"currentColor",fill:"none","stroke-width":3});r.appendChild(a),r.appendChild(n),e[s]={direction:s,pathNode:a,interactionNode:n,groupNode:r},n.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return e}_createGuides(){let e=T("svg"),t=T("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let i=1;i<=2;i++){let s=T("line",{x1:`${q*i}%`,y1:"0%",x2:`${q*i}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}for(let i=1;i<=2;i++){let s=T("line",{x1:"0%",y1:`${q*i}%`,x2:"100%",y2:`${q*i}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(s)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:r}of Object.values(s))t.appendChild(r);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){let i=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:r,y:n}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-r,l=t.y-n;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[a,l],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:i,y:s}=t.getBoundingClientRect(),r=e.x-i,n=e.y-s,a=r-this._dragStartPoint[0],l=n-this._dragStartPoint[1],{direction:c}=this._draggingThumb,h=this.$["*imageBox"],d=this._dragStartCrop;c===""?(d=Ge(d,[a,l]),d=ne(d,h)):(d=qe(d,[a,l],c),d=Ye(d,h));let m=[Math.min(h.width,x),Math.min(h.height,x)];if(d=ae(d,m,c),!Object.values(d).every(w=>Number.isFinite(w)&&w>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:d});return}this.$["*cropBox"]=d}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find(i=>{if(this._shouldThumbBeDisabled(i.direction))return!1;let r=i.groupNode.getBoundingClientRect(),n={x:r.x,y:r.y,width:r.width,height:r.height};return Ke(n,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?We(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",b("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{!e||(this._guidesHidden=e.height<=x||e.width<=x,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides.setAttribute("class",b({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};ge.template=`<svg class='svg' ref='svg-el'xmlns="http://www.w3.org/2000/svg"></svg>`;var L=class extends u{constructor(){super(...arguments);f(this,"init$",{active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=b({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}};L.template=`<div class="before"></div><uc-icon size="20" set="@name: icon;"></uc-icon><div class="title" ref="title-el">{{title}}</div>`;function gt(o){let e=o+90;return e=e>=360?0:e,e}function bt(o,e){return o==="rotate"?gt(e):["mirror","flip"].includes(o)?!e:null}var Y=class extends L{initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{!e||(this._operation=e,this.$.icon=e)}),this.$["on.click"]=e=>{let t=this.$["*cropperEl"].getValue(this._operation),i=bt(this._operation,t);this.$["*cropperEl"].setValue(this._operation,i)}}};var K={FILTER:"filter",COLOR_OPERATION:"color_operation"},$="original",be=class extends u{constructor(){super(...arguments);f(this,"init$",{disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?K.FILTER:K.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===$?void 0:this.$.value,filter:this._filter===$?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=k[this._operation],[i,s]=e;this.$.min=i,this.$.max=s,this.$.zero=t;let r=this.$["*editorTransformations"][this._operation];if(this._controlType===K.FILTER){let n=s;if(r){let{name:a,amount:l}=r;n=a===this._filter?l:s}this.$.value=n,this.$.defaultValue=n}if(this._controlType===K.COLOR_OPERATION){let n=typeof r!="undefined"?r:t;this.$.value=n,this.$.defaultValue=n}}apply(){let e;this._controlType===K.FILTER?this._filter===$?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}connectedCallback(){super.connectedCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}};be.template=`<uc-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"></uc-slider-ui>`;var F=class extends L{constructor(){super(...arguments);f(this,"init$",{active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s=t>=2?"lightest":"normal",r=100,n={...this.$["*editorTransformations"]};return n[this._operation]=this._filter!==$?{name:this._filter,amount:r}:void 0,z(this._originalUrl,se,B(n),`quality/${s}`,`scale_crop/${i}x${i}/center`)}_observerCallback(e,t){if(e[0].isIntersecting){let s=this._previewSrc(),r=this.ref["preview-el"],{promise:n,cancel:a}=M(s);this._cancelPreload=a,n.catch(l=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:l})}).finally(()=>{r.style.backgroundImage=`url(${s})`,setTimeout(()=>{r.style.opacity="1"}),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===$,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let i=this.ref["icon-el"];i.style.opacity=t?"1":"0";let s=this.ref["preview-el"];t?s.style.opacity="0":s.style.backgroundImage&&(s.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let i=this._previewSrc(),s=this.ref["preview-el"];s.style.backgroundImage&&(s.style.backgroundImage="none",s.style.backgroundImage=`url(${i})`)}})}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0,this._cancelPreload&&this._cancelPreload()}};F.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><uc-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>`;var J=class extends L{constructor(){super(...arguments);f(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=k[this._operation],i=e[this._operation],s=typeof i!="undefined"?i!==t:!1;this.$.active=s})}};function Je(o,e){let t={};for(let i of e){let s=o[i];(o.hasOwnProperty(i)||s!==void 0)&&(t[i]=s)}return t}var le=window.ResizeObserver||class{constructor(e){this._callback=e}_flush(e){let t=e.getBoundingClientRect();JSON.stringify(t)!==JSON.stringify(this._lastRect)&&this._callback([{borderBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentBoxSize:[{inlineSize:t.width,blockSize:t.height}],contentRect:t,target:e}]),this._lastRect=t}observe(e){this.unobserve(),this._observeInterval=window.setInterval(()=>this._flush(e),500),this._flush(e)}unobserve(e){this._observeInterval&&window.clearInterval(this._observeInterval)}};function he(o,e,t){return Math.min(Math.max(o,e),t)}function Z({width:o,height:e},t){let i=t/90%2!==0;return{width:i?e:o,height:i?o:e}}function wt(o){return o?[({dimensions:t,coords:i})=>[...t,...i].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:t,coords:i})=>t.every(s=>s>0)&&i.every(s=>s>=0)].every(t=>t(o)):!0}var ve=class extends u{constructor(){super();f(this,"init$",{image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}});this._commitDebounced=A(this._commit.bind(this),300),this._handleResizeDebounced=A(this._handleResize.bind(this),10)}_handleResize(){this._initCanvas(),this._alignImage(),this._alignCrop(),this._draw()}_syncTransformations(){let e=this.$["*editorTransformations"],t=Je(e,Object.keys(this.$["*operations"])),i={...this.$["*operations"],...t};this.$["*operations"]=i}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,r=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*r,e.height=s*r,t.scale(r,r),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],i=this.$["*operations"],{rotate:s}=i,r={width:this.offsetWidth,height:this.offsetHeight},n=Z({width:e.naturalWidth,height:e.naturalHeight},s);if(n.width>r.width-t*2||n.height>r.height-t*2){let a=n.width/n.height,l=r.width/r.height;if(a>l){let c=r.width-t*2,h=c/a,d=0+t,m=t+(r.height-t*2)/2-h/2;this.$["*imageBox"]={x:d,y:m,width:c,height:h}}else{let c=r.height-t*2,h=c*a,d=t+(r.width-t*2)/2-h/2,m=0+t;this.$["*imageBox"]={x:d,y:m,width:h,height:c}}}else{let{width:a,height:l}=n,c=t+(r.width-t*2)/2-a/2,h=t+(r.height-t*2)/2-l/2;this.$["*imageBox"]={x:c,y:h,width:a,height:l}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,r=this.$["*editorTransformations"].crop;if(r){let{dimensions:[a,l],coords:[c,h]}=r,{width:d,x:m,y:w}=this.$["*imageBox"],{width:y}=Z(this._imageSize,s),_=d/y;e={x:m+c*_,y:w+h*_,width:a*_,height:l*_}}else e={x:t.x,y:t.y,width:t.width,height:t.height};let n=[Math.min(t.width,x),Math.min(t.height,x)];e=ae(e,n,"se"),e=ne(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],i=this.$["*operations"],{mirror:s,flip:r,rotate:n}=i,a=this._ctx,l=Z({width:t.width,height:t.height},n);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(n*Math.PI*-1/180),a.scale(s?-1:1,r?-1:1),a.drawImage(e,-l.width/2,-l.height/2,l.width,l.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._alignTransition(),setTimeout(()=>{this.className=b({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1,inactive_instant:!1})}))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n}=t,{width:a,height:l}=Z(this._imageSize,s),{width:c,height:h}=e,d=r/a,m=n/l;return[he(Math.round(c/d),1,a),he(Math.round(h/m),1,l)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],i=this.$["*operations"],{rotate:s}=i,{width:r,height:n,x:a,y:l}=t,{width:c,height:h}=Z(this._imageSize,s),{x:d,y:m}=e,w=r/c,y=n/h,_=this._calculateDimensions(),j={dimensions:_,coords:[he(Math.round((d-a)/w),0,c-_[0]),he(Math.round((m-l)/y),0,h-_[1])]};if(!wt(j)){console.error("Cropper is trying to create invalid crop object",{payload:j});return}if(!(_[0]===c&&_[1]===h))return j}_commit(){let e=this.$["*operations"],{rotate:t,mirror:i,flip:s}=e,r=this._calculateCrop(),a={...this.$["*editorTransformations"],crop:r,rotate:t,mirror:i,flip:s};this.$["*editorTransformations"]=a}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(i){console.error("Failed to activate cropper",{error:i})}}}deactivate({seamlessTransition:e=!1}={}){!this._isActive||(this._commit(),this._isActive=!1,e&&this._alignTransition(),this.className=b({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:e,inactive_instant:!e}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_alignTransition(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth-this.$["*padding"]*2,e[0])/this.$["*cropBox"].width,i=Math.min(this.offsetHeight-this.$["*padding"]*2,e[1])/this.$["*cropBox"].height,s=Math.min(t,i),r=this.$["*cropBox"].x+this.$["*cropBox"].width/2,n=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${s}) translate(${(this.offsetWidth/2-r)/s}px, ${(this.offsetHeight/2-n)/s}px)`,this.style.transformOrigin=`${r}px ${n}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=P(e,i,t),{promise:r,cancel:n,image:a}=M(s),l=this._handleImageLoading(s);return a.addEventListener("load",l,{once:!0}),a.addEventListener("error",l,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=n,r.then(()=>a).catch(c=>(console.error("Failed to load image",{error:c}),this.$["*networProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this._observer=new le(()=>{this._isActive&&this.$.image&&this._handleResizeDebounced()}),this._observer.observe(this),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",e=>{this.$.image&&this._commitDebounced()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this._observer=void 0}};ve.template=`<canvas class='canvas' ref='canvas-el'></canvas><uc-crop-frame ref='frame-el'></uc-crop-frame>`;function we(o,e,t){let i=Array(t);t--;for(let s=t;s>=0;s--)i[s]=Math.ceil((s*e+(t-s)*o)/t);return i}function yt(o){return o.reduce((e,t,i)=>i<o.length-1?[...e,[t,o[i+1]]]:e,[])}function Ct(o,e,t){let i=yt(o).find(([s,r])=>s<=e&&e<=r);return o.map(s=>{let r=Math.abs(i[0]-i[1]),n=Math.abs(e-i[0])/r;return i[0]===s?e>t?1:1-n:i[1]===s?e>=t?n:1:0})}function xt(o,e){return o.map((t,i)=>t<e?o.length-i:i)}function Ze(o,e){let t=k[o].keypointsNumber,{range:i,zero:s}=k[o];return[...new Set([...we(i[0],s,t+1),...we(s,i[1],t+1),s,e])].sort((r,n)=>r-n)}var Qe=class extends u{constructor(){super();this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=A(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];return i.get(t)||i.set(t,new Map),i.get(t).get(e)||(i.set(t,i.get(t).set(e,!0)),this.$["*loadingOperations"]=i),()=>{var s;(s=i==null?void 0:i.get(t))!=null&&s.has(e)&&(i.get(t).delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter,operation:i,value:s}={}){let r={...this._transformations};i&&(r[i]=t?{name:t,amount:s}:s);let n=this.offsetWidth;return P(e,n,r)}_constructKeypoint(e,t){return{src:this._imageSrc({operation:e,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}_addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(l=>l.value===i);if(s())return;let r=this._constructKeypoint(e,i),n=new Image;n.src=r.src;let a=this._handleImageLoading(r.src);n.addEventListener("load",a,{once:!0}),n.addEventListener("error",a,{once:!0}),r.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(s())return;let l=this._keypoints,c=l.findIndex(d=>d.value>i),h=c<l.length?l[c].image:null;!this._container||h&&!this._container.contains(h)||(l.splice(c,0,r),this._container.insertBefore(n,h),this._update(e,i))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){e=typeof e=="string"?parseInt(e,10):e,this._update(this._operation,e),this._addKeypointDebounced(this._operation,this._filter,e)}_update(e,t){this._operation=e,this._value=t;let{zero:i}=k[e],s=this._keypoints.map(a=>a.value),r=Ct(s,t,i),n=xt(s,i);for(let[a,l]of Object.entries(this._keypoints))l.opacity=r[a],l.zIndex=n[a];this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("fader-image","fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&e.appendChild(this._previewImage);let t=document.createElement("div");e.appendChild(t);let i=this._keypoints.map(c=>c.src),{images:s,promise:r,cancel:n}=G(i);s.forEach(c=>{let h=this._handleImageLoading(c.src);c.addEventListener("load",h),c.addEventListener("error",h)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;await r,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((c,h)=>{let d=s[h];d.classList.add("fader-image"),c.image=d,this._container.appendChild(d)}),this.appendChild(e),this._flush())}setTransformations(e){if(this._transformations=e,this._previewImage){let t=this._imageSrc(),i=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",i,{once:!0}),this._previewImage.addEventListener("error",i,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:e,filter:t,operation:i,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=Ze(i,s).map(l=>this._imageSrc({url:e,filter:t,operation:i,value:l})),{cancel:a}=G(n);this._cancelBatchPreload=a}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=b({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=b({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1,inactive_rough:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:e,operation:t,value:i,filter:s,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t||"initial",this._value=i,this._filter=s,this._fromViewer=r,typeof i!="number"&&!s){let a=this._imageSrc({operation:t,value:i});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=Ze(t,i).map(a=>this._constructKeypoint(t,a)),this._update(t,i),this._initNodes()}deactivate({hide:e=!0,seamlessTransition:t=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=b({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:t,inactive_rough:!t}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var Tt=1,ye=class extends u{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>Tt?this.scrollLeft+=i:this.scrollLeft+=t})}};ye.template=`<slot></slot>`;function Et(o){return`<uc-btn-ui theme="boring" ref="tab-toggle-${o}" data-id="${o}" icon="${o}" tabindex="0" set="onclick: on.clickTab;"></uc-btn-ui>`}function St(o){return`<uc-presence-toggle class="tab-content" set="visible: presence.tabContent${o}; styles: presence.tabContentStyles"><uc-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${o}"></div></div></uc-editor-scroller></uc-presence-toggle>`}var Ce=class extends u{constructor(){super();this.init$={"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*editorTransformations":{},"*currentFilter":$,"*currentOperation":null,showLoader:!1,tabId:v.CROP,filters:je,colorOperations:Fe,cropOperations:Xe,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,[`presence.tabContent${v.CROP}`]:!1,[`presence.tabContent${v.SLIDERS}`]:!1,[`presence.tabContent${v.FILTERS}`]:!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=A(this._showLoader.bind(this),500)}get tabId(){return this.$.tabId}_onSliderClose(){this.$["*showSlider"]=!1,this.$.tabId===v.SLIDERS&&(this.ref["tooltip-el"].className=b("filter-tooltip",{"filter-tooltip_visible":!1,"filter-tooltip_hidden":!0}))}_createOperationControl(e){let t=J.is&&new J;return t.operation=e,t}_createFilterControl(e){let t=F.is&&new F;return t.filter=e,t}_createToggleControl(e){let t=Y.is&&new Y;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();e===v.CROP?this.$.cropOperations.forEach(s=>{let r=this._createToggleControl(s);i.appendChild(r)}):e===v.FILTERS?[$,...this.$.filters].forEach(s=>{let r=this._createFilterControl(s);i.appendChild(r)}):e===v.SLIDERS&&this.$.colorOperations.forEach(s=>{let r=this._createOperationControl(s);i.appendChild(r)}),i.childNodes.forEach((s,r)=>{r===i.childNodes.length-1&&s.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}){this.$.tabId=e,e===v.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate({seamlessTransition:!0}));for(let i of re){let s=i===e,r=this.ref[`tab-toggle-${i}`];r.active=s,s?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(i),this.$[`presence.tabContent${i}`]=s}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$.tabId}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=P(this.$["*originalUrl"],e,this.$["*editorTransformations"]);this._cancelPreload&&this._cancelPreload();let{cancel:i}=G([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$.tabId,{fromViewer:!0})},0)}),this.sub("*currentFilter",e=>{this.$["*operationTooltip"]=this.l10n(e||$),this.ref["tooltip-el"].className=b("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e})}),this.sub("*currentOperation",e=>{this.$.tabId===v.SLIDERS&&(this.$["*operationTooltip"]=e,this.ref["tooltip-el"].className=b("filter-tooltip",{"filter-tooltip_visible":e,"filter-tooltip_hidden":!e}))}),this.sub("*tabId",e=>{e===v.FILTERS&&(this.$["*operationTooltip"]=this.$["*currentFilter"]),this.ref["tooltip-el"].className=b("filter-tooltip",{"filter-tooltip_visible":e===v.FILTERS,"filter-tooltip_hidden":e!==v.FILTERS})}),this.sub("*originalUrl",e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,s]of i.entries())if(s){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e})}};Ce.template=`<uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui><div class="filter-tooltip_container"><div class="filter-tooltip_wrapper"><div ref="tooltip-el" class="filter-tooltip filter-tooltip_visible"> {{*operationTooltip}} </div></div></div><div class="toolbar-container"><uc-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row"> ${re.map(St).join("")} </div><div class="controls-row"><uc-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></uc-btn-ui><div class="tab-toggles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${re.map(Et).join("")} </div><uc-btn-ui theme="primary" icon="done" set="onclick: on.apply"></uc-btn-ui></div></uc-presence-toggle><uc-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><uc-editor-slider ref="slider-el"></uc-editor-slider></div><div class="controls-row"><uc-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></uc-btn-ui><uc-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></uc-btn-ui></div></uc-presence-toggle></div>`;var ce=class extends u{constructor(){super();this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return b("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e!=="custom"&&(this.className=e)}),this.sub("text",e=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};ce.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});ce.template=`<uc-icon size="20" set="className: iconCss; @name: icon;"></uc-icon><div class="text">{{text}}</div>`;var xe=class extends u{constructor(){super();this._active=!1,this._handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",e=>{typeof e=="boolean"&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};xe.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var de={transition:"transition",visible:"visible",hidden:"hidden"},Te=class extends u{constructor(){super();this._visible=!1,this._visibleStyle=de.visible,this._hiddenStyle=de.hidden,this._externalTransitions=!1,this.defineAccessor("styles",e=>{!e||(this._externalTransitions=!0,this._visibleStyle=e.visible,this._hiddenStyle=e.hidden)}),this.defineAccessor("visible",e=>{typeof e=="boolean"&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",De(this,{[de.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(de.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};Te.template=`<slot></slot>`;var Ee=class extends u{constructor(){super();f(this,"init$",{disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",e=>{this.$.disabled=e}),this.defineAccessor("min",e=>{this.$.min=e}),this.defineAccessor("max",e=>{this.$.max=e}),this.defineAccessor("defaultValue",e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)}),this.defineAccessor("zero",e=>{this._zero=e}),this.defineAccessor("onInput",e=>{!e||(this.$.onInput=e)}),this.defineAccessor("onChange",e=>{!e||(this.$.onChange=e)})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),r=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${r}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),r=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${r}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:i}=t.getBoundingClientRect(),s=Math.ceil(i/2),r=Math.ceil(s/15)-2;if(this._stepsCount===r)return;let n=document.createDocumentFragment(),a=document.createElement("div"),l=document.createElement("div");a.className="minor-step",l.className="border-step",n.appendChild(l);for(let h=0;h<r;h++)n.appendChild(a.cloneNode());n.appendChild(l.cloneNode());for(let h=0;h<r;h++)n.appendChild(a.cloneNode());n.appendChild(l.cloneNode());let c=document.createElement("div");c.className="zero-dot",n.appendChild(c),this._zeroDotEl=c,t.innerHTML="",t.appendChild(n),this._stepsCount=r}connectedCallback(){super.connectedCallback(),this._updateSteps(),this._observer=new le(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let i=this.ref["input-el"];t?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}disconnectedCallback(){this._observer.unobserve(this),this._observer=void 0}};Ee.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type='range' ref='input-el' tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;">`;export{oe as CloudEditor,ge as CropFrame,Y as EditorCropButtonControl,F as EditorFilterControl,ve as EditorImageCropper,Qe as EditorImageFader,J as EditorOperationControl,ye as EditorScroller,be as EditorSlider,Ce as EditorToolbar,ie as Icon,xe as LineLoaderUi,Te as PresenceToggle,Ee as SliderUi,ce as UcBtnUi};
